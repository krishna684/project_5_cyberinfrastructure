{"entries":[{"timestamp":1764888671506,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":89575,"diffs":[[1,"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":1,"length1":13002,"diffs":[[1,""]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":113,"length1":117,"diffs":[[1,"        \"microphone\": \"*\"\n"]]},{"start1":230,"length1":31,"diffs":[[1,"    \"additionalFilePaths\": []\n"]]}]}]},{"timestamp":1764889238871,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":91,"diffs":[[1,"\n// ====== Radio setup ======\nconst RADIO_GROUP = 17;           // set any group; same on all bots\n"]]},{"start1":128,"length1":47,"diffs":[[1,"radio.setTransmitPower(7);        // max power for consistent RSSI\n"]]},{"start1":196,"length1":43,"diffs":[[1,"const myId = control.deviceSerialNumber(); // unique per micro:bit\n"]]},{"start1":264,"length1":31,"diffs":[[1,"// ====== Message types (for multi-action behaviors) ======\n"]]},{"start1":380,"length1":25,"diffs":[[1,"const MSG_DONE = \"DONE\"; // optional end-of-response marker\n"]]},{"start1":441,"length1":261,"diffs":[[1,"// ====== Motion/scan settings ======\nconst TURN_SPEED = 40;     // pivot speed (0..100) for initial scan\nconst SCAN_MS = 600;       // sample time per side during initial scan\nconst SEEK_MS = 400;       // time to align toward chosen side (initial)\nconst SETTLE_MS = 150;     // pause between actions\n"]]},{"start1":744,"length1":254,"diffs":[[1,"// ====== Approach (with periodic re-scan) settings ======\nconst SLOW_FORWARD_SPEED = 25;     // approach forward speed\nconst SOUND_APPROACH_THRESH = 60;  // continue forward while sound ≥ this\nconst APPROACH_MAX_MS = 3000;      // safety cap on approach duration\nconst QUIET_STOP_MS = 400;         // stop if quiet for this long\n"]]},{"start1":1075,"length1":187,"diffs":[[1,"// Re-scan loop parameters\nconst RESCAN_PERIOD_MS = 800;      // re-scan every 0.8s while approaching\nconst SCAN_MS_SHORT = 300;         // short re-scan duration per side\nconst SEEK_MS_SHORT = 250;         // short correction turn time\nconst APPROACH_TURN_SPEED = 35;    // pivot speed during re-scan corrections\n"]]},{"start1":1390,"length1":136,"diffs":[[1,"// Weigh microphone loudness vs. radio RSSI when deciding direction\nconst SOUND_WEIGHT = 0.7;\nconst RSSI_WEIGHT = 0.3;\n"]]},{"start1":1510,"length1":68,"diffs":[[1,"// ====== Lift/flip detection thresholds ======\nconst LIFT_ACCEL_THRESH = 1300; // mg spike for lift/bump\nlet alertCooldown = false;\n"]]},{"start1":1665,"length1":0,"diffs":[[1,"\n// ====== Target tracking (RSSI from source beacons) ======\nlet targetId = 0;                     // sender we're following\nlet currentRSSI = -128;               // updated on each beacon\nlet lastBeaconTime = 0;               // ms of last beacon\nconst BEACON_TIMEOUT_MS = 3000;       // stale window for RSSI\n\n// ====== LED helpers (with animations) ======\n"]]},{"start1":2053,"length1":117,"diffs":[[1,"function calmLights() {\n    scanningAnimationStop();\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00); // green\n    basic.showIcon(IconNames.Happy);\n}\n"]]},{"start1":2212,"length1":182,"diffs":[[1,"function sadLights() {\n    scanningAnimationStop();\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xff0000); // red\n    basic.showIcon(IconNames.Sad);\n}\n"]]},{"start1":2366,"length1":154,"diffs":[[1,"function scanningLights() {\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xffff00); // yellow\n    scanningAnimationStart();\n}\n"]]},{"start1":2494,"length1":426,"diffs":[[1,"function scanningAnimationStart() {\n    if (scanningAnimOn) return;\n    scanningAnimOn = true;\n    control.runInParallel(function () {\n        const frames: Image[] = [\n            images.createImage(`\n                . . . . .\n                . . # . .\n                . # . # .\n                . . . . .\n                . . . . .\n            `),\n            images.createImage(`\n                . . . . .\n                . . . . .\n                . . # . .\n                . . . . .\n                . . . . .\n            `),\n            images.createImage(`\n                . . . . .\n                . . . . .\n                . # . # .\n                . . # . .\n                . . . . .\n            `),\n            images.createImage(`\n                . . . . .\n                . . . . .\n                . . . . .\n                . . # . .\n                . . . . .\n            `)\n        ];\n        let idx = 0;\n        while (scanningAnimOn) {\n            frames[idx].showImage(0);\n            idx = (idx + 1) % frames.length;\n            basic.pause(120);\n"]]},{"start1":3566,"length1":0,"diffs":[[1,"        basic.clearScreen();\n"]]},{"start1":3606,"length1":180,"diffs":[[1,"function scanningAnimationStop() {\n    scanningAnimOn = false;\n}\n"]]},{"start1":3672,"length1":0,"diffs":[[1,"// ====== Normalize helpers ======\n// Microphone: soundLevel() ≈ 0..255\nfunction normSound(v: number): number {\n    if (v < 0) v = 0;\n    if (v > 255) v = 255;\n    return Math.round(v * 100 / 255); // 0..100\n}\n// RSSI: typical micro:bit radio RSSI ≈ -95..-45 dBm\nfunction normRssi(rssi: number): number {\n    const MIN = -95, MAX = -45;\n    if (rssi < MIN) rssi = MIN;\n    if (rssi > MAX) rssi = MAX;\n    return Math.round((rssi - MIN) * 100 / (MAX - MIN)); // 0..100\n}\n\n// ====== Send alert + start periodic beacons ======\nfunction triggerAlert(reason: string) {\n    if (alertCooldown) return;\n    alertCooldown = true;\n\n"]]},{"start1":4311,"length1":38,"diffs":[[1,"    soundExpression.sad.play();\n    radio.sendValue(MSG_ALERT, myId); // one-shot alert\n"]]},{"start1":4400,"length1":32,"diffs":[[1,"    // Keep beacons flowing for others to sample RSSI while scanning\n    startBeacon(4000, 200); // duration, interval\n\n    // cooldown: return to calm after a bit\n"]]},{"start1":4604,"length1":170,"diffs":[[1,"        basic.pause(1500);\n        calmLights();\n        alertCooldown = false;\n    });\n}\n"]]},{"start1":4695,"length1":179,"diffs":[[1,"function startBeacon(durationMs: number, intervalMs: number) {\n    control.runInParallel(function () {\n        const t0 = input.runningTime();\n        while (input.runningTime() - t0 < durationMs) {\n            radio.sendValue(MSG_BEACON, myId);\n            basic.pause(intervalMs);\n"]]},{"start1":4988,"length1":0,"diffs":[[1,"        radio.sendValue(MSG_DONE, myId);\n"]]},{"start1":5040,"length1":705,"diffs":[[1,"// ====== Radio receive handlers ======\n"]]},{"start1":5280,"length1":93,"diffs":[[1,"        if (senderId != myId) {\n"]]},{"start1":5360,"length1":142,"diffs":[[1,"    } else if (name == MSG_BEACON) {\n        const senderId = value;\n        if (targetId == 0 || senderId == targetId) {\n"]]},{"start1":5574,"length1":0,"diffs":[[1,"    } else if (name == MSG_DONE) {\n        // optional end-of-beacon handling\n"]]},{"start1":5658,"length1":239,"diffs":[[1,""]]},{"start1":5663,"length1":0,"diffs":[[1,"// ====== Combined audio + RSSI scanning, turn, and approach ======\n"]]},{"start1":5775,"length1":0,"diffs":[[1,"    if (scanning) return; // prevent overlapping scans\n"]]},{"start1":5876,"length1":0,"diffs":[[1,"\n    // 1) Indicate scanning\n"]]},{"start1":5927,"length1":22,"diffs":[[1,"    basic.pause(200); // short pause to let beacons start\n"]]},{"start1":5986,"length1":108,"diffs":[[1,"    // Track maxima per side while pivoting\n    let leftSoundMax = 0;\n    let rightSoundMax = 0;\n    let leftRssiMax = -128;\n    let rightRssiMax = -128;\n\n    // ---- Scan LEFT ----\n    cuteBot.motors(-TURN_SPEED, TURN_SPEED); // pivot left\n    const leftStart = input.runningTime();\n    while (input.runningTime() - leftStart < SCAN_MS) {\n        const s = input.soundLevel();\n        if (s > leftSoundMax) leftSoundMax = s;\n\n        if (input.runningTime() - lastBeaconTime <= BEACON_TIMEOUT_MS) {\n            if (currentRSSI > leftRssiMax) leftRssiMax = currentRSSI;\n        }\n        basic.pause(15);\n    }\n    cuteBot.stopcar();\n"]]},{"start1":6648,"length1":65,"diffs":[[1,"\n    // ---- Scan RIGHT ----\n    cuteBot.motors(TURN_SPEED, -TURN_SPEED); // pivot right\n    const rightStart = input.runningTime();\n    while (input.runningTime() - rightStart < SCAN_MS) {\n        const s = input.soundLevel();\n        if (s > rightSoundMax) rightSoundMax = s;\n\n        if (input.runningTime() - lastBeaconTime <= BEACON_TIMEOUT_MS) {\n            if (currentRSSI > rightRssiMax) rightRssiMax = currentRSSI;\n        }\n        basic.pause(15);\n    }\n    cuteBot.stopcar();\n"]]},{"start1":7165,"length1":31,"diffs":[[1,"    // ---- Combine cues ----\n    const leftScore = SOUND_WEIGHT * normSound(leftSoundMax) + RSSI_WEIGHT * normRssi(leftRssiMax);\n    const rightScore = SOUND_WEIGHT * normSound(rightSoundMax) + RSSI_WEIGHT * normRssi(rightRssiMax);\n\n    // ---- Turn toward the stronger/louder side ----\n"]]},{"start1":7566,"length1":13,"diffs":[[1,"    } else if (rightScore > leftScore) {\n"]]},{"start1":7716,"length1":33,"diffs":[[1,"    // 3) Play sad sound to empathize\n"]]},{"start1":7803,"length1":0,"diffs":[[1,"\n    // 4) Approach the source: drive forward slowly while loud; stop when quiet\n"]]},{"start1":7920,"length1":16,"diffs":[[1,"    // Reset state\n"]]},{"start1":8029,"length1":227,"diffs":[[1,"// === Brief re-scan used during approach (yellow animation on/off) ===\nfunction briefRescanAndAdjust() {\n    scanningLights();\n"]]},{"start1":8158,"length1":86,"diffs":[[1,"    let leftSoundMax = 0;\n    let rightSoundMax = 0;\n    let leftRssiMax = -128;\n    let rightRssiMax = -128;\n\n    // Scan LEFT (short)\n    cuteBot.motors(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED);\n    const leftStart = input.runningTime();\n    while (input.runningTime() - leftStart < SCAN_MS_SHORT) {\n"]]},{"start1":8500,"length1":40,"diffs":[[1,"        if (s > leftSoundMax) leftSoundMax = s;\n"]]},{"start1":8549,"length1":134,"diffs":[[1,"        if (input.runningTime() - lastBeaconTime <= BEACON_TIMEOUT_MS) {\n            if (currentRSSI > leftRssiMax) leftRssiMax = currentRSSI;\n"]]},{"start1":8702,"length1":25,"diffs":[[1,"        basic.pause(15);\n"]]},{"start1":8756,"length1":0,"diffs":[[1,"    basic.pause(SETTLE_MS);\n"]]},{"start1":8785,"length1":85,"diffs":[[1,"    // Scan RIGHT (short)\n    cuteBot.motors(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED);\n    const rightStart = input.runningTime();\n    while (input.runningTime() - rightStart < SCAN_MS_SHORT) {\n        const s = input.soundLevel();\n        if (s > rightSoundMax) rightSoundMax = s;\n\n        if (input.runningTime() - lastBeaconTime <= BEACON_TIMEOUT_MS) {\n            if (currentRSSI > rightRssiMax) rightRssiMax = currentRSSI;\n        }\n        basic.pause(15);\n    }\n    cuteBot.stopcar();\n    basic.pause(SETTLE_MS);\n\n    // Combine and adjust heading\n    const leftScore = SOUND_WEIGHT * normSound(leftSoundMax) + RSSI_WEIGHT * normRssi(leftRssiMax);\n    const rightScore = SOUND_WEIGHT * normSound(rightSoundMax) + RSSI_WEIGHT * normRssi(rightRssiMax);\n\n    if (leftScore > rightScore) {\n        cuteBot.motors(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED);\n        basic.pause(SEEK_MS_SHORT);\n    } else if (rightScore > leftScore) {\n        cuteBot.motors(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED);\n        basic.pause(SEEK_MS_SHORT);\n    }\n    cuteBot.stopcar();\n\n    scanningAnimationStop();\n"]]},{"start1":9889,"length1":48,"diffs":[[1,"// === Approach with periodic re-scan loop ===\n"]]},{"start1":9977,"length1":40,"diffs":[[1,"    const t0 = input.runningTime();\n"]]},{"start1":10080,"length1":0,"diffs":[[1,"    // Start forward motion\n"]]},{"start1":10169,"length1":233,"diffs":[[1,"    while (input.runningTime() - t0 < APPROACH_MAX_MS) {\n"]]},{"start1":10264,"length1":0,"diffs":[[1,"\n        // Quiet detection for stopping\n"]]},{"start1":10347,"length1":28,"diffs":[[1,"            quietStart = 0; // loud again: keep moving\n"]]},{"start1":10486,"length1":74,"diffs":[[1,"            if (input.runningTime() - quietStart >= QUIET_STOP_MS) {\n                break; // quiet long enough—stop approaching\n            }\n"]]},{"start1":10641,"length1":37,"diffs":[[1,"        // Periodic brief re-scan to correct heading\n"]]},{"start1":10829,"length1":0,"diffs":[[1,"            // Resume forward motion\n"]]},{"start1":10990,"length1":56,"diffs":[[1,""]]},{"start1":10991,"length1":518,"diffs":[[1,"        basic.pause(30);\n"]]},{"start1":11022,"length1":0,"diffs":[[1,"\n"]]},{"start1":11046,"length1":17,"diffs":[[1,""]]},{"start1":11049,"length1":356,"diffs":[[1,"// ====================================================================\n// === COMPATIBILITY (enum-safe) FLIP DETECTION via sensors ===========\n// ====================================================================\n"]]},{"start1":11266,"length1":176,"diffs":[[1,"// Heuristic orientation checks using accelerometer Z and pitch.\n// Positive Z with small pitch → screen up; negative Z → screen down.\nfunction isScreenUpBySensor(): boolean {\n    const z = input.acceleration(Dimension.Z);\n    const pitch = input.rotation(Rotation.Pitch); // ~0 when flat\n    return z > 200 && Math.abs(pitch) < 45;\n"]]},{"start1":11601,"length1":144,"diffs":[[1,"function isScreenDownBySensor(): boolean {\n    const z = input.acceleration(Dimension.Z);\n    const pitch = input.rotation(Rotation.Pitch);\n    return z < -200 && Math.abs(pitch) < 45;\n"]]},{"start1":11788,"length1":117,"diffs":[[1,""]]},{"start1":11789,"length1":591,"diffs":[[1,"// Poll orientation and trigger flip alerts without referencing enums.\nfunction setupFlipDetectionBySensors() {\n    control.inBackground(function () {\n        let lastUp = isScreenUpBySensor();\n        while (true) {\n            const nowUp = isScreenUpBySensor();\n            const nowDown = isScreenDownBySensor();\n\n            if (nowUp && !lastUp) {\n                triggerAlert(\"flip-up(sensor)\");\n                lastUp = true;\n            } else if (nowDown && lastUp) {\n                triggerAlert(\"flip-down(sensor)\");\n                lastUp = false;\n            }\n"]]},{"start1":12404,"length1":29,"diffs":[[1,""]]},{"start1":12414,"length1":65,"diffs":[[1,""]]},{"start1":12415,"length1":63,"diffs":[[1,"// ====== Universal gesture: SHAKE (safe to reference) ======\ninput.onGesture(Gesture.Shake, function () {\n    triggerAlert(\"shake\");\n});\n\n// ====== Background: detect lift/bump via acceleration strength ======\ncontrol.inBackground(function () {\n    while (true) {\n        const strength = input.acceleration(Dimension.Strength);\n        if (strength > LIFT_ACCEL_THRESH) {\n            triggerAlert(\"lift/bump\");\n            basic.pause(1000);\n        }\n        basic.pause(50);\n    }\n});\n\n// ====== Startup ======\nsetupFlipDetectionBySensors(); // enum-safe flip detection\ncalmLights();\n"]]}]}]},{"timestamp":1764915520876,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":64630,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"-Z,4a-e%xNA0#6|qTj9N\">scanningAnimOn</variable><variable id=\"J)I8g*gvB(_K*8}d[*-j\">v</variable><variable id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</variable><variable id=\"T5T^}eOsq?]ibB?ne(,y\">MAX</variable><variable id=\"qU${p6I_m:1=jBjy)9^i\">rssi</variable><variable id=\"gxCd{DZG.@S;:.ke4fo^\">alertCooldown</variable><variable id=\"`aQ84*,ix6xoK)iV}R9c\">MSG_ALERT</variable><variable id=\"FNnb#.[J:HaTsd!6sF],\">myId</variable><variable id=\"EMnV~ul.WwEzQ!Xlvc34\">MSG_BEACON</variable><variable id=\"fW(4qbl,Qlb3.hv;GZi4\">MSG_DONE</variable><variable id=\"?HLF0lX{$S83wL2dP^[,\">senderId</variable><variable id=\"[y`Z)1dFQ6UKDzBRU%hU\">senderId2</variable><variable id=\"k=J=!{Nx:|6s2g[3CQ,)\">targetId</variable><variable id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</variable><variable id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</variable><variable id=\"OM?cv1-tsyk#OMh:-{bx\">scanning</variable><variable id=\"r{)GYlBG6Om6+0l34,v{\">leftRssiMax</variable><variable id=\"/relD1s6YQbqNn-3m.vo\">rightRssiMax</variable><variable id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</variable><variable id=\"%~fT~.3Fk:Hy{LCgAY-F\">leftStart</variable><variable id=\"wT!.DQnAB3=]W~^k!263\">SCAN_MS</variable><variable id=\"m^S4St$L|2:`%@v6yT/H\">s</variable><variable id=\"Q|sM-1j(+oZ}f:Geer4[\">leftSoundMax</variable><variable id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</variable><variable id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</variable><variable id=\"{!=)M:W`.s~x65bsf+h#\">rightStart</variable><variable id=\"}y_7+AqV)2)k:LP.3HMr\">t</variable><variable id=\"-Z|rg/RWnmU,%VUoCUo=\">rightSoundMax</variable><variable id=\"Yn])m[:YGhf9$#M#-~4a\">leftScore</variable><variable id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</variable><variable id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</variable><variable id=\"-.=u$`9s4*B%MySH*Y2]\">rightScore</variable><variable id=\"!nolpoU?hzfs;RcU_e#C\">SEEK_MS</variable><variable id=\"h{%JbJ3i!sg,e-2O]OT/\">leftRssiMax2</variable><variable id=\"(Pe?IzWi7vjGmVjy6#xA\">rightRssiMax2</variable><variable id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</variable><variable id=\"C2*giTM;V`iXUfRT/JWn\">leftStart2</variable><variable id=\"qd;nwtv2[F+ixX7P.osU\">SCAN_MS_SHORT</variable><variable id=\"t+6^uPDpJk?(B++Zms4O\">u</variable><variable id=\"k4kPk6AYGbWx@EG{-5o}\">leftSoundMax2</variable><variable id=\"ZR8dC?WNhO5fdn*ct.H+\">rightStart2</variable><variable id=\"%*Vm5EcwK-tmw@TC%L~b\">rightSoundMax2</variable><variable id=\"NwqHhd|ls^]a@.U7/(jb\">leftScore2</variable><variable id=\"tVa+F0GWr4me~LciH!(4\">rightScore2</variable><variable id=\"9wMvQ+KFD_nv]qUHFemz\">SEEK_MS_SHORT</variable><variable id=\"AEz9|ALWrQ-$spDMYI1~\">t02</variable><variable id=\"qczk{/|pPm8._CED+;Kd\">lastRescan</variable><variable id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</variable><variable id=\"V,lUgU.jBe_Qc/04^JzL\">APPROACH_MAX_MS</variable><variable id=\"93f0j|C|lxs|h/Tt;31E\">w</variable><variable id=\"XJ7j!u+_(y[h}WOK5,}t\">SOUND_APPROACH_THRESH</variable><variable id=\"a+hb[x{4o@#;OGcn8[Jd\">quietStart</variable><variable id=\"KZ*Zy@nmhCRE$M,CRmUg\">QUIET_STOP_MS</variable><variable id=\"CR3g38QgGU:$(PX)KL/f\">RESCAN_PERIOD_MS</variable><variable id=\"4gscC;?*]XI3pOeF9}PV\">z</variable><variable id=\"ZY.XCdOZ:uk}P[Pp{u]!\">pitch</variable><variable id=\"T(lkrrgs0fRJpc=TCUo5\">z2</variable><variable id=\"m|?8=XQ%aA.S2Jrf[tx:\">pitch2</variable><variable id=\"oW(^(c~~;fs#7`bL=*}2\">strength</variable><variable id=\"1N6Y*5q!NJbf=BUxOLQ7\">LIFT_ACCEL_THRESH</variable><variable id=\"?f0wz(j/abJw,}YR:k?|\">RADIO_GROUP</variable></variables><comment x=\"20\" y=\"4871\" w=\"480\" h=\"120\">\n====== Target tracking (RSSI from source beacons) ======\n</comment><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"briefRescanAndAdjust\" functionid=\";}8;sWF`0NN~t[[p=!)z\"></mutation><field name=\"function_name\">briefRescanAndAdjust</field><comment pinned=\"false\" h=\"80\" w=\"160\">=== Brief re-scan used during approach (yellow animation on/off) ===</comment><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningLights\" functionid=\"/0rtS)UcmD4N~#!:T]f~\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\"h{%JbJ3i!sg,e-2O]OT/\">leftRssiMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"(Pe?IzWi7vjGmVjy6#xA\">rightRssiMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Scan LEFT (short)</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"C2*giTM;V`iXUfRT/JWn\">leftStart2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"C2*giTM;V`iXUfRT/JWn\">leftStart2</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qd;nwtv2[F+ixX7P.osU\">SCAN_MS_SHORT</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"t+6^uPDpJk?(B++Zms4O\">u</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"t+6^uPDpJk?(B++Zms4O\">u</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"k4kPk6AYGbWx@EG{-5o}\">leftSoundMax2</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"k4kPk6AYGbWx@EG{-5o}\">leftSoundMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"t+6^uPDpJk?(B++Zms4O\">u</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"h{%JbJ3i!sg,e-2O]OT/\">leftRssiMax2</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"h{%JbJ3i!sg,e-2O]OT/\">leftRssiMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value></block></statement></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">15</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</field></block></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Scan RIGHT (short)</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"ZR8dC?WNhO5fdn*ct.H+\">rightStart2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ZR8dC?WNhO5fdn*ct.H+\">rightStart2</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qd;nwtv2[F+ixX7P.osU\">SCAN_MS_SHORT</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"J)I8g*gvB(_K*8}d[*-j\">v</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"J)I8g*gvB(_K*8}d[*-j\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"%*Vm5EcwK-tmw@TC%L~b\">rightSoundMax2</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"%*Vm5EcwK-tmw@TC%L~b\">rightSoundMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"J)I8g*gvB(_K*8}d[*-j\">v</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"(Pe?IzWi7vjGmVjy6#xA\">rightRssiMax2</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"(Pe?IzWi7vjGmVjy6#xA\">rightRssiMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value></block></statement></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">15</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"NwqHhd|ls^]a@.U7/(jb\">leftScore2</field><comment pinned=\"false\" h=\"80\" w=\"160\">Combine and adjust heading</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normSound\" functionid=\"9d^z^*5%*W2W+}MVn*~3\"><arg name=\"v\" id=\"uskzyisnlovwxfrtyyl4h\" type=\"number\"></arg></mutation><value name=\"uskzyisnlovwxfrtyyl4h\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"k4kPk6AYGbWx@EG{-5o}\">leftSoundMax2</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normRssi\" functionid=\"F/ko;ht.|Lgo4+23~Jig\"><arg name=\"rssi\" id=\"oorcc2427v0nof69ldroj\" type=\"number\"></arg></mutation><value name=\"oorcc2427v0nof69ldroj\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"h{%JbJ3i!sg,e-2O]OT/\">leftRssiMax2</field></block></value></block></value></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"tVa+F0GWr4me~LciH!(4\">rightScore2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normSound\" functionid=\"9d^z^*5%*W2W+}MVn*~3\"><arg name=\"v\" id=\"uskzyisnlovwxfrtyyl4h\" type=\"number\"></arg></mutation><value name=\"uskzyisnlovwxfrtyyl4h\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"%*Vm5EcwK-tmw@TC%L~b\">rightSoundMax2</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normRssi\" functionid=\"F/ko;ht.|Lgo4+23~Jig\"><arg name=\"rssi\" id=\"oorcc2427v0nof69ldroj\" type=\"number\"></arg></mutation><value name=\"oorcc2427v0nof69ldroj\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"(Pe?IzWi7vjGmVjy6#xA\">rightRssiMax2</field></block></value></block></value></block></value></block></value><next><block type=\"controls_if\"><mutation elseif=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"NwqHhd|ls^]a@.U7/(jb\">leftScore2</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"tVa+F0GWr4me~LciH!(4\">rightScore2</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"9wMvQ+KFD_nv]qUHFemz\">SEEK_MS_SHORT</field></block></value></block></next></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"tVa+F0GWr4me~LciH!(4\">rightScore2</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"NwqHhd|ls^]a@.U7/(jb\">leftScore2</field></block></value></block></value><statement name=\"DO1\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"9wMvQ+KFD_nv]qUHFemz\">SEEK_MS_SHORT</field></block></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"|k!E-.DXcEX}_v/{-PhM\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"approachWhileLoudWithRescan\" functionid=\"O6^r^Y`z`6#:sw)iH@bj\"></mutation><field name=\"function_name\">approachWhileLoudWithRescan</field><comment pinned=\"false\" h=\"80\" w=\"160\">=== Approach with periodic re-scan loop ===</comment><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"AEz9|ALWrQ-$spDMYI1~\">t02</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"qczk{/|pPm8._CED+;Kd\">lastRescan</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Start forward motion</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</field></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"AEz9|ALWrQ-$spDMYI1~\">t02</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"V,lUgU.jBe_Qc/04^JzL\">APPROACH_MAX_MS</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"93f0j|C|lxs|h/Tt;31E\">w</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Quiet detection for stopping</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"93f0j|C|lxs|h/Tt;31E\">w</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"XJ7j!u+_(y[h}WOK5,}t\">SOUND_APPROACH_THRESH</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+hb[x{4o@#;OGcn8[Jd\">quietStart</field><comment pinned=\"false\" h=\"80\" w=\"160\">loud again: keep moving</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a+hb[x{4o@#;OGcn8[Jd\">quietStart</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+hb[x{4o@#;OGcn8[Jd\">quietStart</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a+hb[x{4o@#;OGcn8[Jd\">quietStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"KZ*Zy@nmhCRE$M,CRmUg\">QUIET_STOP_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"break_keyword\"><comment pinned=\"false\" h=\"80\" w=\"160\">quiet long enough—stop approaching</comment></block></statement></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Periodic brief re-scan to correct heading</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qczk{/|pPm8._CED+;Kd\">lastRescan</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"CR3g38QgGU:$(PX)KL/f\">RESCAN_PERIOD_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"briefRescanAndAdjust\" functionid=\";}8;sWF`0NN~t[[p=!)z\"></mutation><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Resume forward motion</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"qczk{/|pPm8._CED+;Kd\">lastRescan</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></next></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">30</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"isScreenUpBySensor\" functionid=\"7+QpZ.+;Ce`aMA|^c8jo\"></mutation><field name=\"function_name\">isScreenUpBySensor</field><comment pinned=\"false\" h=\"80\" w=\"160\">Heuristic orientation checks using accelerometer Z and pitch.\nPositive Z with small pitch → screen up; negative Z → screen down.</comment><data>0</data><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"4gscC;?*]XI3pOeF9}PV\">z</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_acceleration\"><field name=\"NAME\">Dimension.Z</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"ZY.XCdOZ:uk}P[Pp{u]!\">pitch</field><comment pinned=\"false\" h=\"80\" w=\"160\">~0 when flat</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_rotation\"><field name=\"NAME\">Rotation.Pitch</field></block></value><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"4gscC;?*]XI3pOeF9}PV\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_op3\"><value name=\"x\"><block type=\"variables_get\"><field name=\"VAR\" id=\"ZY.XCdOZ:uk}P[Pp{u]!\">pitch</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">45</field></shadow></value></block></value></block></value></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"isScreenDownBySensor\" functionid=\"uG+1]$XBxjDGy%Z)36E?\"></mutation><field name=\"function_name\">isScreenDownBySensor</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"T(lkrrgs0fRJpc=TCUo5\">z2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_acceleration\"><field name=\"NAME\">Dimension.Z</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m|?8=XQ%aA.S2Jrf[tx:\">pitch2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_rotation\"><field name=\"NAME\">Rotation.Pitch</field></block></value><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"T(lkrrgs0fRJpc=TCUo5\">z2</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-200</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_op3\"><value name=\"x\"><block type=\"variables_get\"><field name=\"VAR\" id=\"m|?8=XQ%aA.S2Jrf[tx:\">pitch2</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">45</field></shadow></value></block></value></block></value></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"setupFlipDetectionBySensors\" functionid=\"X6qag/wRC)tgP#hM6oRV\"></mutation><field name=\"function_name\">setupFlipDetectionBySensors</field><comment pinned=\"false\" h=\"80\" w=\"160\">Poll orientation and trigger flip alerts without referencing enums.</comment><statement name=\"STACK\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.inBackground(function () {\" line1=\"        let lastUp = isScreenUpBySensor();\" line2=\"        while (true) {\" line3=\"            const nowUp = isScreenUpBySensor();\" line4=\"            const nowDown = isScreenDownBySensor();\" line5=\"\" line6=\"            if (nowUp &amp;&amp; !lastUp) {\" line7=\"                triggerAlert(&quot;flip-up(sensor)&quot;);\" line8=\"                lastUp = true;\" line9=\"            } else if (nowDown &amp;&amp; lastUp) {\" line10=\"                triggerAlert(&quot;flip-down(sensor)&quot;);\" line11=\"                lastUp = false;\" line12=\"            }\" line13=\"            basic.pause(120);\" line14=\"        }\" line15=\"    });\" numlines=\"16\"></mutation></block></statement></block><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let scanningAnimOn = false\" numlines=\"1\" declaredvars=\"scanningAnimOn\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== LED helpers (with animations) ======</comment><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let alertCooldown = false\" numlines=\"1\" declaredvars=\"alertCooldown\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\"?f0wz(j/abJw,}YR:k?|\">RADIO_GROUP</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Radio setup ======\nset any group; same on all bots</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">17</field></shadow></value><next><block type=\"radio_set_group\"><value name=\"ID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"255\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"?f0wz(j/abJw,}YR:k?|\">RADIO_GROUP</field></block></value><next><block type=\"radio_set_transmit_power\"><comment pinned=\"false\" h=\"80\" w=\"160\">max power for consistent RSSI</comment><value name=\"power\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"7\" precision=\"0\"></mutation><field name=\"SLIDER\">7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"FNnb#.[J:HaTsd!6sF],\">myId</field><comment pinned=\"false\" h=\"80\" w=\"160\">unique per micro:bit</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_device_serial_number\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"`aQ84*,ix6xoK)iV}R9c\">MSG_ALERT</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Message types (for multi-action behaviors) ======</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">ALERT</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"EMnV~ul.WwEzQ!Xlvc34\">MSG_BEACON</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">BEACON</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"fW(4qbl,Qlb3.hv;GZi4\">MSG_DONE</field><comment pinned=\"false\" h=\"80\" w=\"160\">optional end-of-response marker</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">DONE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Motion/scan settings ======\npivot speed (0..100) for initial scan</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">40</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"wT!.DQnAB3=]W~^k!263\">SCAN_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">sample time per side during initial scan</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">600</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"!nolpoU?hzfs;RcU_e#C\">SEEK_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">time to align toward chosen side (initial)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">400</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">pause between actions</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">150</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Approach (with periodic re-scan) settings ======\napproach forward speed</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">25</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"XJ7j!u+_(y[h}WOK5,}t\">SOUND_APPROACH_THRESH</field><comment pinned=\"false\" h=\"80\" w=\"160\">continue forward while sound ≥ this</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">60</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"V,lUgU.jBe_Qc/04^JzL\">APPROACH_MAX_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">safety cap on approach duration</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">3000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"KZ*Zy@nmhCRE$M,CRmUg\">QUIET_STOP_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">stop if quiet for this long</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">400</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"CR3g38QgGU:$(PX)KL/f\">RESCAN_PERIOD_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Re-scan loop parameters\nre-scan every 0.8s while approaching</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">800</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"qd;nwtv2[F+ixX7P.osU\">SCAN_MS_SHORT</field><comment pinned=\"false\" h=\"80\" w=\"160\">short re-scan duration per side</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">300</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"9wMvQ+KFD_nv]qUHFemz\">SEEK_MS_SHORT</field><comment pinned=\"false\" h=\"80\" w=\"160\">short correction turn time</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">250</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field><comment pinned=\"false\" h=\"80\" w=\"160\">pivot speed during re-scan corrections</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</field><comment pinned=\"false\" h=\"80\" w=\"160\">Weigh microphone loudness vs. radio RSSI when deciding direction</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.3</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"1N6Y*5q!NJbf=BUxOLQ7\">LIFT_ACCEL_THRESH</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Lift/flip detection thresholds ======\nmg spike for lift/bump</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1300</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field><comment pinned=\"false\" h=\"80\" w=\"160\">sender we're following\nupdated on each beacon</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">ms of last beacon\nstale window for RSSI</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">3000</field></shadow></value><next><block type=\"function_call\"><mutation name=\"setupFlipDetectionBySensors\" functionid=\"X6qag/wRC)tgP#hM6oRV\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== Startup ======\nenum-safe flip detection</comment><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"Iga}tH/,N!*f9X8fMa%N\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"control_in_background\" x=\"545\" y=\"20\"><comment pinned=\"false\" h=\"80\" w=\"160\">====== Background: detect lift/bump via acceleration strength ======</comment><statement name=\"HANDLER\"><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"oW(^(c~~;fs#7`bL=*}2\">strength</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_acceleration\"><field name=\"NAME\">Dimension.Strength</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"oW(^(c~~;fs#7`bL=*}2\">strength</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"1N6Y*5q!NJbf=BUxOLQ7\">LIFT_ACCEL_THRESH</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"triggerAlert\" functionid=\"o_Ot1|9.;SaBqE2tc=Md\"><arg name=\"reason\" id=\"vp9im044187fuz3wcbud\" type=\"string\"></arg></mutation><value name=\"vp9im044187fuz3wcbud\"><shadow type=\"text\"><field name=\"TEXT\">lift/bump</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value></block></next></block></next></block></statement></block></statement></block><block type=\"device_gesture_event\" x=\"1155\" y=\"20\"><field name=\"NAME\">Gesture.Shake</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Universal gesture: SHAKE (safe to reference) ======</comment><statement name=\"HANDLER\"><block type=\"function_call\"><mutation name=\"triggerAlert\" functionid=\"o_Ot1|9.;SaBqE2tc=Md\"><arg name=\"reason\" id=\"vp9im044187fuz3wcbud\" type=\"string\"></arg></mutation><value name=\"vp9im044187fuz3wcbud\"><shadow type=\"text\"><field name=\"TEXT\">shake</field></shadow></value></block></statement></block><block type=\"radio_on_value_drag\" x=\"2293\" y=\"20\"><comment pinned=\"false\" h=\"80\" w=\"160\">====== Radio receive handlers ======</comment><value name=\"HANDLER_DRAG_PARAM_name\"><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"HANDLER_DRAG_PARAM_value\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qU${p6I_m:1=jBjy)9^i\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"radio_received_packet\"><value name=\"type\"><shadow type=\"radio_packet_property\"><field name=\"note\">RadioPacketProperty.SignalStrength</field></shadow></value></block></value><next><block type=\"controls_if\"><mutation elseif=\"2\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">optional end-of-beacon handling</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"`aQ84*,ix6xoK)iV}R9c\">MSG_ALERT</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"?HLF0lX{$S83wL2dP^[,\">senderId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">NEQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"?HLF0lX{$S83wL2dP^[,\">senderId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"FNnb#.[J:HaTsd!6sF],\">myId</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"respondToAlert\" functionid=\"wpc1;#!@Dcx@|)d!F%)h\"><arg name=\"senderId\" id=\"3bo0uqxm9ydvw0toy8x1\" type=\"number\"></arg></mutation><value name=\"3bo0uqxm9ydvw0toy8x1\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"?HLF0lX{$S83wL2dP^[,\">senderId</field></block></value></block></statement></block></next></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"EMnV~ul.WwEzQ!Xlvc34\">MSG_BEACON</field></block></value></block></value><statement name=\"DO1\"><block type=\"variables_set\"><field name=\"VAR\" id=\"[y`Z)1dFQ6UKDzBRU%hU\">senderId2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"k=J=!{Nx:|6s2g[3CQ,)\">targetId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"[y`Z)1dFQ6UKDzBRU%hU\">senderId2</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"k=J=!{Nx:|6s2g[3CQ,)\">targetId</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qU${p6I_m:1=jBjy)9^i\">rssi</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></statement></block></next></block></statement><value name=\"IF2\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"fW(4qbl,Qlb3.hv;GZi4\">MSG_DONE</field></block></value></block></value></block></next></block></statement></block><block type=\"function_definition\" x=\"3164\" y=\"20\"><mutation name=\"calmLights\" functionid=\"Iga}tH/,N!*f9X8fMa%N\"></mutation><field name=\"function_name\">calmLights</field><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"|k!E-.DXcEX}_v/{-PhM\"></mutation><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">green</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"3595\" y=\"20\"><mutation name=\"sadLights\" functionid=\"qh:k4i.0rG6wwh=2{9Us\"></mutation><field name=\"function_name\">sadLights</field><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"|k!E-.DXcEX}_v/{-PhM\"></mutation><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">red</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xff0000</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"4026\" y=\"20\"><mutation name=\"scanningLights\" functionid=\"/0rtS)UcmD4N~#!:T]f~\"></mutation><field name=\"function_name\">scanningLights</field><statement name=\"STACK\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">yellow</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xffff00</field></shadow></value><next><block type=\"function_call\"><mutation name=\"scanningAnimationStart\" functionid=\"+mWzE(|qbJZh*DL$/!3j\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></statement></block><block type=\"function_definition\" x=\"4456\" y=\"20\"><mutation name=\"scanningAnimationStart\" functionid=\"+mWzE(|qbJZh*DL$/!3j\"></mutation><field name=\"function_name\">scanningAnimationStart</field><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-Z,4a-e%xNA0#6|qTj9N\">scanningAnimOn</field></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"-Z,4a-e%xNA0#6|qTj9N\">scanningAnimOn</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        const frames: Image[] = [\" line2=\"            images.createImage(`\" line3=\"                . . . . .\" line4=\"                . . # . .\" line5=\"                . # . # .\" line6=\"                . . . . .\" line7=\"                . . . . .\" line8=\"            `),\" line9=\"            images.createImage(`\" line10=\"                . . . . .\" line11=\"                . . . . .\" line12=\"                . . # . .\" line13=\"                . . . . .\" line14=\"                . . . . .\" line15=\"            `),\" line16=\"            images.createImage(`\" line17=\"                . . . . .\" line18=\"                . . . . .\" line19=\"                . # . # .\" line20=\"                . . # . .\" line21=\"                . . . . .\" line22=\"            `),\" line23=\"            images.createImage(`\" line24=\"                . . . . .\" line25=\"                . . . . .\" line26=\"                . . . . .\" line27=\"                . . # . .\" line28=\"                . . . . .\" line29=\"            `)\" line30=\"        ];\" line31=\"        let idx = 0;\" line32=\"        while (scanningAnimOn) {\" line33=\"            frames[idx].showImage(0);\" line34=\"            idx = (idx + 1) % frames.length;\" line35=\"            basic.pause(120);\" line36=\"        }\" line37=\"        basic.clearScreen();\" line38=\"    });\" numlines=\"39\"></mutation></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"20\" y=\"1906\"><mutation name=\"scanningAnimationStop\" functionid=\"|k!E-.DXcEX}_v/{-PhM\"></mutation><field name=\"function_name\">scanningAnimationStop</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"-Z,4a-e%xNA0#6|qTj9N\">scanningAnimOn</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value></block></statement></block><block type=\"function_definition\" x=\"450\" y=\"1906\"><mutation name=\"normSound\" functionid=\"9d^z^*5%*W2W+}MVn*~3\"><arg name=\"v\" id=\"uskzyisnlovwxfrtyyl4h\" type=\"number\"></arg></mutation><field name=\"function_name\">normSound</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Normalize helpers ======\nMicrophone: soundLevel() ≈ 0..255</comment><value name=\"uskzyisnlovwxfrtyyl4h\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"J)I8g*gvB(_K*8}d[*-j\">v</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"J)I8g*gvB(_K*8}d[*-j\">v</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">0..100</comment><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></value></block></value></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"1035\" y=\"1906\"><mutation name=\"normRssi\" functionid=\"F/ko;ht.|Lgo4+23~Jig\"><arg name=\"rssi\" id=\"oorcc2427v0nof69ldroj\" type=\"number\"></arg></mutation><field name=\"function_name\">normRssi</field><comment pinned=\"false\" h=\"80\" w=\"160\">RSSI: typical micro:bit radio RSSI ≈ -95..-45 dBm</comment><value name=\"oorcc2427v0nof69ldroj\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-95</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"T5T^}eOsq?]ibB?ne(,y\">MAX</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-45</field></shadow></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qU${p6I_m:1=jBjy)9^i\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"T5T^}eOsq?]ibB?ne(,y\">MAX</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qU${p6I_m:1=jBjy)9^i\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"T5T^}eOsq?]ibB?ne(,y\">MAX</field></block></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">0..100</comment><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"T5T^}eOsq?]ibB?ne(,y\">MAX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</field></block></value></block></value></block></value></block></value></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"1930\" y=\"1906\"><mutation name=\"triggerAlert\" functionid=\"o_Ot1|9.;SaBqE2tc=Md\"><arg name=\"reason\" id=\"vp9im044187fuz3wcbud\" type=\"string\"></arg></mutation><field name=\"function_name\">triggerAlert</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Send alert + start periodic beacons ======</comment><value name=\"vp9im044187fuz3wcbud\"><block type=\"argument_reporter_string\"><field name=\"VALUE\">reason</field></block></value><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"gxCd{DZG.@S;:.ke4fo^\">alertCooldown</field></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"gxCd{DZG.@S;:.ke4fo^\">alertCooldown</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"function_call\"><mutation name=\"sadLights\" functionid=\"qh:k4i.0rG6wwh=2{9Us\"></mutation><next><block type=\"SoundExpression_play\"><field name=\"this\">soundExpression.sad</field><next><block type=\"radio_datagram_send_value\"><comment pinned=\"false\" h=\"80\" w=\"160\">one-shot alert</comment><value name=\"name\"><block type=\"variables_get\"><field name=\"VAR\" id=\"`aQ84*,ix6xoK)iV}R9c\">MSG_ALERT</field></block></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"FNnb#.[J:HaTsd!6sF],\">myId</field></block></value><next><block type=\"function_call\"><mutation name=\"startBeacon\" functionid=\"QE[j@3L+J9HRoX6yQUO@\"><arg name=\"durationMs\" id=\"3wbkhsmmxt897zqzk7ctf\" type=\"number\"></arg><arg name=\"intervalMs\" id=\"hhsqf6m8vsmwvj273qtxj\" type=\"number\"></arg></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Keep beacons flowing for others to sample RSSI while scanning\nduration, interval</comment><value name=\"3wbkhsmmxt897zqzk7ctf\"><shadow type=\"math_number\"><field name=\"NUM\">4000</field></shadow></value><value name=\"hhsqf6m8vsmwvj273qtxj\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        basic.pause(1500);\" line2=\"        calmLights();\" line3=\"        alertCooldown = false;\" line4=\"    });\" numlines=\"5\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2407\" y=\"1906\"><mutation name=\"startBeacon\" functionid=\"QE[j@3L+J9HRoX6yQUO@\"><arg name=\"durationMs\" id=\"3wbkhsmmxt897zqzk7ctf\" type=\"number\"></arg><arg name=\"intervalMs\" id=\"hhsqf6m8vsmwvj273qtxj\" type=\"number\"></arg></mutation><field name=\"function_name\">startBeacon</field><value name=\"3wbkhsmmxt897zqzk7ctf\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">durationMs</field></block></value><value name=\"hhsqf6m8vsmwvj273qtxj\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">intervalMs</field></block></value><statement name=\"STACK\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        const t0 = input.runningTime();\" line2=\"        while (input.runningTime() - t0 &lt; durationMs) {\" line3=\"            radio.sendValue(MSG_BEACON, myId);\" line4=\"            basic.pause(intervalMs);\" line5=\"        }\" line6=\"        radio.sendValue(MSG_DONE, myId);\" line7=\"    });\" numlines=\"8\"></mutation></block></statement></block><block type=\"function_definition\" x=\"2968\" y=\"1906\"><mutation name=\"respondToAlert\" functionid=\"wpc1;#!@Dcx@|)d!F%)h\"><arg name=\"senderId\" id=\"3bo0uqxm9ydvw0toy8x1\" type=\"number\"></arg></mutation><field name=\"function_name\">respondToAlert</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Combined audio + RSSI scanning, turn, and approach ======\nTrack maxima per side while pivoting</comment><value name=\"3bo0uqxm9ydvw0toy8x1\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">senderId</field></block></value><statement name=\"STACK\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">prevent overlapping scans</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"OM?cv1-tsyk#OMh:-{bx\">scanning</field></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"OM?cv1-tsyk#OMh:-{bx\">scanning</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"k=J=!{Nx:|6s2g[3CQ,)\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">senderId</field></block></value><next><block type=\"function_call\"><mutation name=\"scanningLights\" functionid=\"/0rtS)UcmD4N~#!:T]f~\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">1) Indicate scanning</comment><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">short pause to let beacons start</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"r{)GYlBG6Om6+0l34,v{\">leftRssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/relD1s6YQbqNn-3m.vo\">rightRssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">---- Scan LEFT ----\npivot left</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"%~fT~.3Fk:Hy{LCgAY-F\">leftStart</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"%~fT~.3Fk:Hy{LCgAY-F\">leftStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"wT!.DQnAB3=]W~^k!263\">SCAN_MS</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"m^S4St$L|2:`%@v6yT/H\">s</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m^S4St$L|2:`%@v6yT/H\">s</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Q|sM-1j(+oZ}f:Geer4[\">leftSoundMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Q|sM-1j(+oZ}f:Geer4[\">leftSoundMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m^S4St$L|2:`%@v6yT/H\">s</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"r{)GYlBG6Om6+0l34,v{\">leftRssiMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"r{)GYlBG6Om6+0l34,v{\">leftRssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value></block></statement></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">15</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</field></block></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">---- Scan RIGHT ----\npivot right</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"{!=)M:W`.s~x65bsf+h#\">rightStart</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{!=)M:W`.s~x65bsf+h#\">rightStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"wT!.DQnAB3=]W~^k!263\">SCAN_MS</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"}y_7+AqV)2)k:LP.3HMr\">t</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"}y_7+AqV)2)k:LP.3HMr\">t</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-Z|rg/RWnmU,%VUoCUo=\">rightSoundMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"-Z|rg/RWnmU,%VUoCUo=\">rightSoundMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"}y_7+AqV)2)k:LP.3HMr\">t</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/relD1s6YQbqNn-3m.vo\">rightRssiMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"/relD1s6YQbqNn-3m.vo\">rightRssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value></block></statement></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">15</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Yn])m[:YGhf9$#M#-~4a\">leftScore</field><comment pinned=\"false\" h=\"80\" w=\"160\">---- Combine cues ----</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normSound\" functionid=\"9d^z^*5%*W2W+}MVn*~3\"><arg name=\"v\" id=\"uskzyisnlovwxfrtyyl4h\" type=\"number\"></arg></mutation><value name=\"uskzyisnlovwxfrtyyl4h\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Q|sM-1j(+oZ}f:Geer4[\">leftSoundMax</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normRssi\" functionid=\"F/ko;ht.|Lgo4+23~Jig\"><arg name=\"rssi\" id=\"oorcc2427v0nof69ldroj\" type=\"number\"></arg></mutation><value name=\"oorcc2427v0nof69ldroj\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"r{)GYlBG6Om6+0l34,v{\">leftRssiMax</field></block></value></block></value></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"-.=u$`9s4*B%MySH*Y2]\">rightScore</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normSound\" functionid=\"9d^z^*5%*W2W+}MVn*~3\"><arg name=\"v\" id=\"uskzyisnlovwxfrtyyl4h\" type=\"number\"></arg></mutation><value name=\"uskzyisnlovwxfrtyyl4h\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-Z|rg/RWnmU,%VUoCUo=\">rightSoundMax</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normRssi\" functionid=\"F/ko;ht.|Lgo4+23~Jig\"><arg name=\"rssi\" id=\"oorcc2427v0nof69ldroj\" type=\"number\"></arg></mutation><value name=\"oorcc2427v0nof69ldroj\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/relD1s6YQbqNn-3m.vo\">rightRssiMax</field></block></value></block></value></block></value></block></value><next><block type=\"controls_if\"><mutation elseif=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">---- Turn toward the stronger/louder side ----</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Yn])m[:YGhf9$#M#-~4a\">leftScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-.=u$`9s4*B%MySH*Y2]\">rightScore</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!nolpoU?hzfs;RcU_e#C\">SEEK_MS</field></block></value></block></next></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-.=u$`9s4*B%MySH*Y2]\">rightScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Yn])m[:YGhf9$#M#-~4a\">leftScore</field></block></value></block></value><statement name=\"DO1\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!nolpoU?hzfs;RcU_e#C\">SEEK_MS</field></block></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"sadLights\" functionid=\"qh:k4i.0rG6wwh=2{9Us\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">3) Play sad sound to empathize</comment><next><block type=\"SoundExpression_play\"><field name=\"this\">soundExpression.sad</field><next><block type=\"function_call\"><mutation name=\"approachWhileLoudWithRescan\" functionid=\"O6^r^Y`z`6#:sw)iH@bj\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">4) Approach the source: drive forward slowly while loud; stop when quiet</comment><next><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"|k!E-.DXcEX}_v/{-PhM\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Reset state</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"OM?cv1-tsyk#OMh:-{bx\">scanning</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"k=J=!{Nx:|6s2g[3CQ,)\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"Iga}tH/,N!*f9X8fMa%N\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>"]]}]}]},{"timestamp":1764915699426,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":946,"diffs":[[1,"// ====== Radio setup ======\nconst RADIO_GROUP = 17;           // Must be same on all bots\nradio.setGroup(RADIO_GROUP);\nradio.setTransmitPower(7);        // Max power\n"]]},{"start1":168,"length1":1806,"diffs":[[1,"const myId = control.deviceSerialNumber();\n\n// ====== Message types ======\nconst MSG_ALERT = \"ALERT\";\nconst MSG_BEACON = \"BEACON\";\nconst MSG_DONE = \"DONE\";\n\n// ====== Motion/Scan Constants ======\nconst TURN_SPEED = 40;     // Speed for initial scan\nconst SCAN_MS = 600;       // Duration to listen per side\nconst SEEK_MS = 400;       // Duration to turn towards target\nconst SETTLE_MS = 100;     // Pause to stabilize\n\n// ====== Approach Constants ======\nconst SLOW_FORWARD_SPEED = 25;\nconst SOUND_APPROACH_THRESH = 60;  // Stop if quieter than this\nconst APPROACH_MAX_MS = 5000;      // Give up after 5 seconds\nconst QUIET_STOP_MS = 500;         // Stop if quiet for 0.5s\n\n// ====== Re-scan Constants ======\nconst RESCAN_PERIOD_MS = 800;      // Re-check heading every 0.8s\nconst SCAN_MS_SHORT = 300;\nconst SEEK_MS_SHORT = 250;\nconst APPROACH_TURN_SPEED = 35;\n\n// ====== Sensor Weights (0.0 to 1.0) ======\nconst SOUND_WEIGHT = 0.7; // Trust ears more\nconst RSSI_WEIGHT = 0.3;  // Trust radio less\n\n// ====== Global State Variables ======\nlet isDistressMode = false;\nlet scanning = false;\nlet scanningAnimOn = false;\n\n// Target tracking\nlet targetId = 0;\nlet currentRSSI = -128;\nlet lastBeaconTime = 0;\nconst BEACON_TIMEOUT_MS = 2000;\n\n// =========================================================\n// === PART 1: FAST FLIP DETECTION (THE VICTIM) ===========\n// =========================================================\n\nfunction monitorOrientation() {\n"]]},{"start1":2188,"length1":558,"diffs":[[1,"\nfunction enterDistressMode() {\n    if (isDistressMode) return;\n    isDistressMode = true;\n    scanning = false; // Stop trying to rescue others if I am hurt\n    cuteBot.stopcar();\n\n    sadLights();\n    radio.sendValue(MSG_ALERT, myId);\n\n    // Continuous Distress Loop\n    control.runInParallel(function () {\n        while (isDistressMode) {\n            // Broadcast beacon for RSSI tracking\n            radio.sendValue(MSG_BEACON, myId);\n            soundExpression.sad.play();\n\n            // Randomly re-send ALERT packet\n            if (Math.randomBoolean()) {\n                radio.sendValue(MSG_ALERT, myId);\n            }\n            basic.pause(600);\n        }\n    });\n"]]},{"start1":2868,"length1":24,"diffs":[[1,"\nfunction exitDistressMode() {\n    isDistressMode = false;\n    radio.sendValue(MSG_DONE, myId);\n    calmLights();\n}\n\n// Manual Shake Trigger\n"]]},{"start1":3054,"length1":57,"diffs":[[1,"    if (!isDistressMode) {\n        enterDistressMode();\n        // Force sadness for at least 3 seconds on shake\n"]]},{"start1":3386,"length1":118,"diffs":[[1,"});\n\n// =========================================================\n// === PART 2: THE RESCUER LOGIC ==========================\n// =========================================================\n\nradio.onReceivedValue(function (name: string, value: number) {\n    const rssi = radio.receivedPacket(RadioPacketProperty.SignalStrength);\n\n"]]},{"start1":3742,"length1":159,"diffs":[[1,"        const senderId = value;\n        if (senderId != myId && !isDistressMode && !scanning) {\n            // Start Rescue!\n            respondToAlert(senderId);\n"]]},{"start1":3915,"length1":88,"diffs":[[1,"    }\n    else if (name == MSG_BEACON) {\n        // Only track the robot we are looking for\n"]]},{"start1":4057,"length1":80,"diffs":[[1,"            currentRSSI = rssi;\n            lastBeaconTime = input.runningTime();\n"]]},{"start1":4149,"length1":35,"diffs":[[1,"    }\n    else if (name == MSG_DONE) {\n"]]},{"start1":4221,"length1":153,"diffs":[[1,"            // Victim is happy, stop rescue\n            scanning = false;\n            targetId = 0;\n            cuteBot.stopcar();\n            calmLights();\n"]]},{"start1":4394,"length1":453,"diffs":[[1,"});\n\nfunction respondToAlert(senderId: number) {\n    scanning = true;\n    targetId = senderId;\n    scanningLights();\n    basic.pause(200);\n\n    // 1. Scan Left/Right to find direction\n    let leftScore = scanSide(-TURN_SPEED, TURN_SPEED, SCAN_MS);\n    basic.pause(SETTLE_MS);\n    let rightScore = scanSide(TURN_SPEED, -TURN_SPEED, SCAN_MS);\n    basic.pause(SETTLE_MS);\n\n    // 2. Pivot towards winner\n"]]},{"start1":4829,"length1":80,"diffs":[[1,"        cuteBot.motors(-TURN_SPEED, TURN_SPEED);\n        basic.pause(SEEK_MS);\n"]]},{"start1":4921,"length1":80,"diffs":[[1,"        cuteBot.motors(TURN_SPEED, -TURN_SPEED);\n        basic.pause(SEEK_MS);\n"]]},{"start1":5006,"length1":235,"diffs":[[1,"    cuteBot.stopcar();\n\n    // 3. Empathize and Approach\n    sadLights();\n    soundExpression.sad.play();\n    approachWhileLoudWithRescan();\n\n    // 4. Reset\n    scanningAnimationStop();\n    scanning = false;\n    targetId = 0;\n    calmLights();\n"]]},{"start1":5253,"length1":114,"diffs":[[1,"\n// Helper to scan one direction and return max score\nfunction scanSide(leftSpeed: number, rightSpeed: number, duration: number): number {\n    cuteBot.motors(leftSpeed, rightSpeed);\n    let soundMax = 0;\n    let rssiMax = -128;\n\n    const t0 = input.runningTime();\n    while (input.runningTime() - t0 < duration) {\n        const s = input.soundLevel();\n        if (s > soundMax) soundMax = s;\n\n        if (input.runningTime() - lastBeaconTime < BEACON_TIMEOUT_MS) {\n            if (currentRSSI > rssiMax) rssiMax = currentRSSI;\n        }\n        basic.pause(10);\n    }\n    cuteBot.stopcar();\n\n    return (SOUND_WEIGHT * normSound(soundMax)) + (RSSI_WEIGHT * normRssi(rssiMax));\n"]]},{"start1":5933,"length1":395,"diffs":[[1,"\n// === Approach Loop with Wiggle Correction ===\nfunction approachWhileLoudWithRescan() {\n    const tStart = input.runningTime();\n    let quietStart = 0;\n    let lastRescan = input.runningTime();\n\n    cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED);\n\n"]]},{"start1":6252,"length1":56,"diffs":[[1,"        // Safety: stop if we get flipped during rescue\n"]]},{"start1":6338,"length1":49,"diffs":[[1,"            cuteBot.stopcar();\n            return;\n"]]},{"start1":6399,"length1":124,"diffs":[[1,"\n        // Volume Check\n        const s = input.soundLevel();\n        if (s >= SOUND_APPROACH_THRESH) {\n            quietStart = 0;\n"]]},{"start1":6549,"length1":204,"diffs":[[1,"            if (quietStart == 0) quietStart = input.runningTime();\n            if (input.runningTime() - quietStart >= QUIET_STOP_MS) break;\n"]]},{"start1":6700,"length1":37,"diffs":[[1,"\n        // Periodic Re-Scan (Wiggle)\n"]]},{"start1":6806,"length1":177,"diffs":[[1,"            cuteBot.stopcar();\n            briefRescanAndAdjust();\n            cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED);\n            lastRescan = input.runningTime();\n"]]},{"start1":6997,"length1":24,"diffs":[[1,"        basic.pause(20);\n"]]},{"start1":7028,"length1":22,"diffs":[[1,"    cuteBot.stopcar();\n"]]},{"start1":7053,"length1":103,"diffs":[[1,"\nfunction briefRescanAndAdjust() {\n    scanningLights();\n    // Quick Left/Right check\n    let left = scanSide(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED, SCAN_MS_SHORT);\n    basic.pause(50);\n    let right = scanSide(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED, SCAN_MS_SHORT);\n\n    if (left > right) {\n        cuteBot.motors(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED);\n        basic.pause(SEEK_MS_SHORT);\n    } else {\n        cuteBot.motors(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED);\n        basic.pause(SEEK_MS_SHORT);\n"]]},{"start1":7578,"length1":78,"diffs":[[1,"    cuteBot.stopcar();\n    sadLights();\n"]]},{"start1":7620,"length1":1904,"diffs":[[1,"\n// ====== Normalization Helpers ======\nfunction normSound(v: number): number {\n    if (v < 0) v = 0; if (v > 255) v = 255;\n    return Math.round(v * 100 / 255);\n}\nfunction normRssi(rssi: number): number {\n    const MIN = -95, MAX = -45;\n    if (rssi < MIN) rssi = MIN; if (rssi > MAX) rssi = MAX;\n    return Math.round((rssi - MIN) * 100 / (MAX - MIN));\n}\n\n// ====== LED Control ======\nfunction calmLights() {\n    scanningAnimationStop();\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00);\n    basic.showIcon(IconNames.Happy);\n}\nfunction sadLights() {\n    scanningAnimationStop();\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xff0000);\n    basic.showIcon(IconNames.Sad);\n}\nfunction scanningLights() {\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xffff00);\n    scanningAnimationStart();\n}\n\nfunction scanningAnimationStart() {\n    if (scanningAnimOn) return;\n    scanningAnimOn = true;\n    control.runInParallel(function () {\n        const frames = [\n            images.createImage(`. . . . . \\n . . # . . \\n . # . # . \\n . . . . . \\n . . . . .`),\n            images.createImage(`. . . . . \\n . . . . . \\n . . # . . \\n . . . . . \\n . . . . .`),\n            images.createImage(`. . . . . \\n . . . . . \\n . # . # . \\n . . # . . \\n . . . . .`),\n        ];\n        let i = 0;\n        while (scanningAnimOn) {\n            frames[i].showImage(0);\n            i = (i + 1) % frames.length;\n            basic.pause(120);\n        }\n        basic.clearScreen();\n    });\n}\nfunction scanningAnimationStop() {\n    scanningAnimOn = false;\n}\n\n// ====== Main Entry ======\nmonitorOrientation();\ncalmLights();"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":294,"length1":39,"diffs":[[1,"        \"README.md\"\n"]]},{"start1":321,"length1":35,"diffs":[[1,"    \"preferredEditor\": \"tsprj\"\n"]]}]},{"type":"added","filename":"main.py","value":"# ============== Radio setup ==============\nRADIO_GROUP = 17\n# Must be same on all bots\nradio.set_group(RADIO_GROUP)\nradio.set_transmit_power(7)\n# Max power\nmyId = control.device_serial_number()\n# ============== Message types ==============\nMSG_ALERT = \"ALERT\"\nMSG_BEACON = \"BEACON\"\nMSG_DONE = \"DONE\"\n# ============== Motion / Scan Constants ==============\nTURN_SPEED = 40\n# Speed for initial scan\nSCAN_MS = 600\n# Duration to listen per side (ms)\nSEEK_MS = 400\n# Duration to turn towards target (ms)\nSETTLE_MS = 100\n# Pause to stabilize (ms)\n# ============== Approach Constants ==============\nSLOW_FORWARD_SPEED = 25\nSOUND_APPROACH_THRESH = 60\n# Stop if quieter than this\nAPPROACH_MAX_MS = 5000\n# Give up after 5 seconds\nQUIET_STOP_MS = 500\n# Stop if quiet for 0.5s\n# ============== Re-scan Constants ==============\nRESCAN_PERIOD_MS = 800\n# Re-check heading every 0.8s\nSCAN_MS_SHORT = 300\nSEEK_MS_SHORT = 250\nAPPROACH_TURN_SPEED = 35\n# ============== Sensor Weights (0–100 scaled) ==============\nSOUND_WEIGHT = 0.7\n# Trust ears more\nRSSI_WEIGHT = 0.3\n# Trust radio less\n# ============== Global State Variables ==============\nisDistressMode = False\nscanning = False\nscanningAnimOn = False\n# Target tracking\ntargetId = 0\ncurrentRSSI = -128\nlastBeaconTime = 0\nBEACON_TIMEOUT_MS = 2000\n# =============================================\n# =========== PART 1: DISTRESS MODE ===========\n# =============================================\n# Orientation monitor – runs forever\n\ndef on_forever():\n    global isDistressMode\n    accelZ = input.acceleration(Dimension.Z)\n    # Flip down → distress\n    # Flip back up → exit distress\n    if accelZ < -600 and not isDistressMode:\n        enterDistressMode()\n    elif accelZ > 200 and isDistressMode:\n        exitDistressMode()\n    basic.pause(50)\nbasic.forever(on_forever)\n\ndef enterDistressMode():\n    global isDistressMode, scanning\n    if isDistressMode:\n        return\n    isDistressMode = True\n    scanning = False\n    # Stop rescuing others if I am hurt\n    cuteBot.stopcar()\n    sadLights()\n    radio.send_value(MSG_ALERT, myId)\n    # Continuous distress loop in background\n    \n    def on_in_background():\n        while isDistressMode:\n            # Broadcast beacon for RSSI tracking\n            radio.send_value(MSG_BEACON, myId)\n            # Play sad sound (non-blocking is nicer, but play is okay)\n            soundExpression.sad.play()\n            # Randomly re-send ALERT packet\n            if Math.random_boolean():\n                radio.send_value(MSG_ALERT, myId)\n            basic.pause(600)\n    control.in_background(on_in_background)\n    \ndef exitDistressMode():\n    global isDistressMode\n    isDistressMode = False\n    radio.send_value(MSG_DONE, myId)\n    calmLights()\n# Manual shake trigger\n\ndef on_gesture_shake():\n    global isDistressMode\n    if not isDistressMode:\n        enterDistressMode()\n        # Force sadness for at least 3 seconds on shake\n        \n        def on_in_background2():\n            basic.pause(3000)\n            if isDistressMode and input.acceleration(Dimension.Z) > -200:\n                exitDistressMode()\n        control.in_background(on_in_background2)\n        \ninput.on_gesture(Gesture.SHAKE, on_gesture_shake)\n\n# =============================================\n# =========== PART 2: RESCUER LOGIC ===========\n# =============================================\n\ndef on_received_value(name, value):\n    global isDistressMode, scanning, currentRSSI, lastBeaconTime, targetId\n    rssi = radio.received_packet(RadioPacketProperty.SIGNAL_STRENGTH)\n    if name == MSG_ALERT:\n        senderId = value\n        if senderId != myId and not isDistressMode and not scanning:\n            # Start rescue!\n            respondToAlert(senderId)\n    elif name == MSG_BEACON:\n        # Only track the robot we are looking for\n        if targetId == 0 or value == targetId:\n            currentRSSI = rssi\n            lastBeaconTime = input.running_time()\n    elif name == MSG_DONE:\n        if value == targetId:\n            # Victim is happy, stop rescue\n            scanning = False\n            targetId = 0\n            cuteBot.stopcar()\n            calmLights()\nradio.on_received_value(on_received_value)\n\ndef respondToAlert(senderId2: number):\n    global scanning, targetId, TURN_SPEED\n    scanning = True\n    targetId = senderId2\n    scanningLights()\n    basic.pause(200)\n    # 1. Scan left/right to find direction\n    leftScore = scanSide(-TURN_SPEED, TURN_SPEED, SCAN_MS)\n    basic.pause(SETTLE_MS)\n    rightScore = scanSide(TURN_SPEED, -TURN_SPEED, SCAN_MS)\n    basic.pause(SETTLE_MS)\n    # 2. Pivot towards winner\n    if leftScore > rightScore:\n        cuteBot.motors(-TURN_SPEED, TURN_SPEED)\n        basic.pause(SEEK_MS)\n    else:\n        cuteBot.motors(TURN_SPEED, -TURN_SPEED)\n        basic.pause(SEEK_MS)\n    cuteBot.stopcar()\n    # 3. Empathize and approach\n    sadLights()\n    soundExpression.sad.play()\n    approachWhileLoudWithRescan()\n    # 4. Reset\n    scanningAnimationStop()\n    scanning = False\n    targetId = 0\n    calmLights()\n# Scan one direction and return a score combining sound & RSSI\ndef scanSide(leftSpeed: number, rightSpeed: number, duration: number):\n    cuteBot.motors(leftSpeed, rightSpeed)\n    soundMax = 0\n    rssiMax = -128\n    t0 = input.running_time()\n    while input.running_time() - t0 < duration:\n        s = input.sound_level()\n        if s > soundMax:\n            soundMax = s\n        if input.running_time() - lastBeaconTime < BEACON_TIMEOUT_MS:\n            if currentRSSI > rssiMax:\n                rssiMax = currentRSSI\n        basic.pause(10)\n    cuteBot.stopcar()\n    soundScore = normSound(soundMax)\n    rssiScore = normRssi(rssiMax)\n    return SOUND_WEIGHT * soundScore + RSSI_WEIGHT * rssiScore\n# Approach loop with periodic re-scan (\"wiggle\")\ndef approachWhileLoudWithRescan():\n    tStart = input.running_time()\n    quietStart = 0\n    lastRescan = input.running_time()\n    cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED)\n    while input.running_time() - tStart < APPROACH_MAX_MS:\n        # Safety: if we get flipped during rescue, enter distress\n        if isDistressMode:\n            cuteBot.stopcar()\n            return\n        # Volume check\n        t = input.sound_level()\n        if t >= SOUND_APPROACH_THRESH:\n            quietStart = 0\n        else:\n            if quietStart == 0:\n                quietStart = input.running_time()\n            if input.running_time() - quietStart >= QUIET_STOP_MS:\n                break\n        # Periodic re-scan to adjust heading\n        if input.running_time() - lastRescan >= RESCAN_PERIOD_MS:\n            cuteBot.stopcar()\n            briefRescanAndAdjust()\n            cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED)\n            lastRescan = input.running_time()\n        basic.pause(20)\n    cuteBot.stopcar()\ndef briefRescanAndAdjust():\n    global APPROACH_TURN_SPEED\n    scanningLights()\n    # Quick left/right check\n    left = scanSide(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED, SCAN_MS_SHORT)\n    basic.pause(50)\n    right = scanSide(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED, SCAN_MS_SHORT)\n    if left > right:\n        cuteBot.motors(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED)\n        basic.pause(SEEK_MS_SHORT)\n    else:\n        cuteBot.motors(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED)\n        basic.pause(SEEK_MS_SHORT)\n    cuteBot.stopcar()\n    sadLights()\n# ============== Normalization Helpers ==============\ndef normSound(v: number):\n    if v < 0:\n        v = 0\n    if v > 255:\n        v = 255\n    return Math.round(v * 100 / 255)\ndef normRssi(rssi2: number):\n    MIN = -95\n    MAX = -45\n    if rssi2 < MIN:\n        rssi2 = MIN\n    if rssi2 > MAX:\n        rssi2 = MAX\n    return Math.round((rssi2 - MIN) * 100 / (MAX - MIN))\n# ============== LED / Display Control ==============\ndef calmLights():\n    scanningAnimationStop()\n    cuteBot.color_light(cuteBot.RGBLights.ALL, 0x00ff00)\n    basic.show_icon(IconNames.HAPPY)\ndef sadLights():\n    scanningAnimationStop()\n    cuteBot.color_light(cuteBot.RGBLights.ALL, 0xff0000)\n    basic.show_icon(IconNames.SAD)\ndef scanningLights():\n    cuteBot.color_light(cuteBot.RGBLights.ALL, 0xffff00)\n    scanningAnimationStart()\ndef scanningAnimationStart():\n    global scanningAnimOn\n    if scanningAnimOn:\n        return\n    scanningAnimOn = True\n    \n    def on_in_background3():\n        frames = [images.create_image(\"\"\"\n                . . . . .\n                . . # . .\n                . # . # .\n                . . . . .\n                . . . . .\n                \"\"\"),\n            images.create_image(\"\"\"\n                . . . . .\n                . . . . .\n                . . # . .\n                . . . . .\n                . . . . .\n                \"\"\"),\n            images.create_image(\"\"\"\n                . . . . .\n                . . . . .\n                . # . # .\n                . . # . .\n                . . . . .\n                \"\"\")]\n        i = 0\n        while scanningAnimOn:\n            frames[i].show_image(0)\n            i = (i + 1) % len(frames)\n            basic.pause(120)\n        basic.clear_screen()\n    control.in_background(on_in_background3)\n    \ndef scanningAnimationStop():\n    global scanningAnimOn\n    scanningAnimOn = False\n# ============== Main startup ==============\ncalmLights()"}]},{"timestamp":1764916227902,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":167,"diffs":[[1,"/**\n * =========================================================\n */\n/**\n * =========================================================\n * \n * === PART 2: THE RESCUER LOGIC ==========================\n */\n/**\n * Target tracking\n */\nfunction exitDistressMode () {\n    isDistressMode = false\n    radio.sendValue(MSG_DONE, myId)\n    calmLights()\n}\nfunction sadLights () {\n    scanningAnimationStop()\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xff0000)\n    basic.showIcon(IconNames.Sad)\n}\nfunction enterDistressMode () {\n    if (isDistressMode) {\n        return\n    }\n    isDistressMode = true\n    // Stop trying to rescue others if I am hurt\n    scanning = false\n    cuteBot.stopcar()\n    sadLights()\n    radio.sendValue(MSG_ALERT, myId)\n    control.runInParallel(function () {\n        while (isDistressMode) {\n            // Broadcast beacon for RSSI tracking\n            radio.sendValue(MSG_BEACON, myId);\n            soundExpression.sad.play();\n"]]},{"start1":947,"length1":1451,"diffs":[[1,"            // Randomly re-send ALERT packet\n            if (Math.randomBoolean()) {\n                radio.sendValue(MSG_ALERT, myId);\n            }\n            basic.pause(600);\n        }\n    });\n}\nfunction normRssi (rssi: number) {\n    MIN = -95\n    MAX = -45\n    if (rssi < MIN) {\n        rssi = MIN\n    }\n    if (rssi > MAX) {\n        rssi = MAX\n    }\n    return Math.round((rssi - MIN) * 100 / (MAX - MIN))\n}\nfunction scanningAnimationStart () {\n    if (scanningAnimOn) {\n        return\n    }\n    scanningAnimOn = true\n    control.runInParallel(function () {\n        const frames = [\n            images.createImage(`. . . . . \\n . . # . . \\n . # . # . \\n . . . . . \\n . . . . .`),\n            images.createImage(`. . . . . \\n . . . . . \\n . . # . . \\n . . . . . \\n . . . . .`),\n            images.createImage(`. . . . . \\n . . . . . \\n . # . # . \\n . . # . . \\n . . . . .`),\n        ];\n        let i = 0;\n        while (scanningAnimOn) {\n            frames[i].showImage(0);\n            i = (i + 1) % frames.length;\n            basic.pause(120);\n        }\n        basic.clearScreen();\n    });\n}\n// Helper to scan one direction and return max score\nfunction scanSide (leftSpeed: number, rightSpeed: number, duration: number) {\n    cuteBot.motors(leftSpeed, rightSpeed)\n    rssiMax = -128\n    t0 = input.runningTime()\n    while (input.runningTime() - t0 < duration) {\n        s = input.soundLevel()\n        if (s > soundMax) {\n            soundMax = s\n        }\n        if (input.runningTime() - lastBeaconTime < BEACON_TIMEOUT_MS) {\n            if (currentRSSI > rssiMax) {\n                rssiMax = currentRSSI\n            }\n        }\n        basic.pause(10)\n    }\n    cuteBot.stopcar()\n    return SOUND_WEIGHT * normSound(soundMax) + RSSI_WEIGHT * normRssi(rssiMax)\n}\nfunction monitorOrientation () {\n"]]},{"start1":3322,"length1":678,"diffs":[[1,"function briefRescanAndAdjust () {\n    scanningLights()\n    // Quick Left/Right check\n    left = scanSide(0 - APPROACH_TURN_SPEED, APPROACH_TURN_SPEED, SCAN_MS_SHORT)\n    basic.pause(50)\n    right = scanSide(APPROACH_TURN_SPEED, 0 - APPROACH_TURN_SPEED, SCAN_MS_SHORT)\n    if (left > right) {\n        cuteBot.motors(0 - APPROACH_TURN_SPEED, APPROACH_TURN_SPEED)\n        basic.pause(SEEK_MS_SHORT)\n    } else {\n        cuteBot.motors(APPROACH_TURN_SPEED, 0 - APPROACH_TURN_SPEED)\n        basic.pause(SEEK_MS_SHORT)\n    }\n    cuteBot.stopcar()\n    sadLights()\n"]]},{"start1":3882,"length1":141,"diffs":[[1,"// Manual Shake Trigger\n"]]},{"start1":3951,"length1":113,"diffs":[[1,"    if (!(isDistressMode)) {\n        enterDistressMode()\n"]]},{"start1":4227,"length1":327,"diffs":[[1,"})\nradio.onReceivedValue(function (name, value) {\n    rssi = radio.receivedPacket(RadioPacketProperty.SignalStrength)\n"]]},{"start1":4374,"length1":163,"diffs":[[1,"        senderId = value\n        if (senderId != myId && !(isDistressMode) && !(scanning)) {\n            // Start Rescue!\n            respondToAlert(senderId)\n"]]},{"start1":4543,"length1":92,"diffs":[[1,"    } else if (name == MSG_BEACON) {\n        // Only track the robot we are looking for\n"]]},{"start1":4681,"length1":82,"diffs":[[1,"            currentRSSI = rssi\n            lastBeaconTime = input.runningTime()\n"]]},{"start1":4771,"length1":39,"diffs":[[1,"    } else if (name == MSG_DONE) {\n"]]},{"start1":4839,"length1":157,"diffs":[[1,"            // Victim is happy, stop rescue\n            scanning = false\n            targetId = 0\n            cuteBot.stopcar()\n            calmLights()\n"]]},{"start1":5008,"length1":401,"diffs":[[1,"})\nfunction scanningAnimationStop () {\n    scanningAnimOn = false\n}\nfunction respondToAlert (senderId: number) {\n    scanning = true\n    targetId = senderId\n    scanningLights()\n    basic.pause(200)\n    // 1. Scan Left/Right to find direction\n    leftScore = scanSide(0 - TURN_SPEED, TURN_SPEED, SCAN_MS)\n    basic.pause(SETTLE_MS)\n    rightScore = scanSide(TURN_SPEED, 0 - TURN_SPEED, SCAN_MS)\n    basic.pause(SETTLE_MS)\n    // 2. Pivot towards winner\n"]]},{"start1":5495,"length1":79,"diffs":[[1,"        cuteBot.motors(0 - TURN_SPEED, TURN_SPEED)\n        basic.pause(SEEK_MS)\n"]]},{"start1":5588,"length1":79,"diffs":[[1,"        cuteBot.motors(TURN_SPEED, 0 - TURN_SPEED)\n        basic.pause(SEEK_MS)\n"]]},{"start1":5674,"length1":245,"diffs":[[1,"    cuteBot.stopcar()\n    // 3. Empathize and Approach\n    sadLights()\n    soundExpression.sad.play()\n    approachWhileLoudWithRescan()\n    // 4. Reset\n    scanningAnimationStop()\n    scanning = false\n    targetId = 0\n    calmLights()\n"]]},{"start1":5911,"length1":678,"diffs":[[1,"function scanningLights () {\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xffff00)\n    scanningAnimationStart()\n"]]},{"start1":6027,"length1":258,"diffs":[[1,"// ====== LED Control ======\nfunction calmLights () {\n    scanningAnimationStop()\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00)\n    basic.showIcon(IconNames.Happy)\n}\n// === Approach Loop with Wiggle Correction ===\nfunction approachWhileLoudWithRescan () {\n    tStart = input.runningTime()\n    lastRescan = input.runningTime()\n    cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED)\n"]]},{"start1":6483,"length1":56,"diffs":[[1,"        // Safety: stop if we get flipped during rescue\n"]]},{"start1":6569,"length1":51,"diffs":[[1,"            cuteBot.stopcar()\n            return\n"]]},{"start1":6628,"length1":133,"diffs":[[1,"        // Volume Check\n        t = input.soundLevel()\n        if (t >= SOUND_APPROACH_THRESH) {\n            quietStart = 0\n"]]},{"start1":6769,"length1":141,"diffs":[[1,"            if (quietStart == 0) {\n                quietStart = input.runningTime()\n            }\n            if (input.runningTime() - quietStart >= QUIET_STOP_MS) {\n                break;\n            }\n"]]},{"start1":6983,"length1":38,"diffs":[[1,"        // Periodic Re-Scan (Wiggle)\n"]]},{"start1":7088,"length1":181,"diffs":[[1,"            cuteBot.stopcar()\n            briefRescanAndAdjust()\n            cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED)\n            lastRescan = input.runningTime()\n"]]},{"start1":7275,"length1":25,"diffs":[[1,"        basic.pause(20)\n"]]},{"start1":7305,"length1":23,"diffs":[[1,"    cuteBot.stopcar()\n"]]},{"start1":7329,"length1":519,"diffs":[[1,"// ====== Normalization Helpers ======\nfunction normSound (v: number) {\n    if (v < 0) {\n        v = 0\n"]]},{"start1":7438,"length1":40,"diffs":[[1,"    if (v > 255) {\n        v = 255\n    }\n    return Math.round(v * 100 / 255)\n"]]},{"start1":7518,"length1":1599,"diffs":[[1,"let v = 0\nlet quietStart = 0\nlet t = 0\nlet lastRescan = 0\nlet tStart = 0\nlet rightScore = 0\nlet leftScore = 0\nlet targetId = 0\nlet senderId = 0\nlet right = 0\nlet left = 0\nlet lastBeaconTime = 0\nlet soundMax = 0\nlet s = 0\nlet t0 = 0\nlet rssiMax = 0\nlet rssi = 0\nlet MAX = 0\nlet MIN = 0\nlet scanning = false\nlet BEACON_TIMEOUT_MS = 0\nlet currentRSSI = 0\nlet RSSI_WEIGHT = 0\nlet SOUND_WEIGHT = 0\nlet APPROACH_TURN_SPEED = 0\nlet SEEK_MS_SHORT = 0\nlet SCAN_MS_SHORT = 0\nlet RESCAN_PERIOD_MS = 0\nlet QUIET_STOP_MS = 0\nlet APPROACH_MAX_MS = 0\nlet SOUND_APPROACH_THRESH = 0\nlet SLOW_FORWARD_SPEED = 0\nlet SETTLE_MS = 0\nlet SEEK_MS = 0\nlet SCAN_MS = 0\nlet TURN_SPEED = 0\nlet MSG_DONE = \"\"\nlet MSG_BEACON = \"\"\nlet MSG_ALERT = \"\"\nlet myId = 0\nlet scanningAnimOn = false\n// ====== Global State Variables ======\nlet isDistressMode = false\n// ====== Radio setup ======\n// Must be same on all bots\nlet RADIO_GROUP = 17\nradio.setGroup(RADIO_GROUP)\n// Max power\nradio.setTransmitPower(7)\nmyId = control.deviceSerialNumber()\n// ====== Message types ======\nMSG_ALERT = \"ALERT\"\nMSG_BEACON = \"BEACON\"\nMSG_DONE = \"DONE\"\n// ====== Motion/Scan Constants ======\n// Speed for initial scan\nTURN_SPEED = 40\n// Duration to listen per side\nSCAN_MS = 600\n// Duration to turn towards target\nSEEK_MS = 400\n// Pause to stabilize\nSETTLE_MS = 100\n// ====== Approach Constants ======\nSLOW_FORWARD_SPEED = 25\n// Stop if quieter than this\nSOUND_APPROACH_THRESH = 60\n// Give up after 5 seconds\nAPPROACH_MAX_MS = 5000\n// Stop if quiet for 0.5s\nQUIET_STOP_MS = 500\n// ====== Re-scan Constants ======\n// Re-check heading every 0.8s\nRESCAN_PERIOD_MS = 800\nSCAN_MS_SHORT = 300\nSEEK_MS_SHORT = 250\nAPPROACH_TURN_SPEED = 35\n// ====== Sensor Weights (0.0 to 1.0) ======\n// Trust ears more\nSOUND_WEIGHT = 0.7\n// Trust radio less\nRSSI_WEIGHT = 0.3\ncurrentRSSI = -128\nBEACON_TIMEOUT_MS = 2000\n// ====== Main Entry ======\nmonitorOrientation()\ncalmLights()\n"]]}]}]},{"timestamp":1764917576352,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":340,"length1":31,"diffs":[[1,"    \"preferredEditor\": \"blocksprj\"\n"]]}]}]},{"timestamp":1764917576593,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1913,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</variable><variable id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</variable><variable id=\"^j%oFTI0/$TbCv_zOML5\">MSG_ALERT</variable><variable id=\"jf`~oRe.#J`a@InuozSt\">myId</variable><variable id=\"jf$`u?l),0}^SVzOLf:D\">MSG_DONE</variable><variable id=\":s0#vocc2*9?#P^3nu`q\">rssi</variable><variable id=\"sp`5#c{[W6=1s*I*Hnw4\">MSG_BEACON</variable><variable id=\"nJfq+;#[}QkfzJ]t_FfX\">senderId</variable><variable id=\"/r6OB-%U!^STyZR5XY4H\">targetId</variable><variable id=\"m4]mq*CkgYrTE,{sC_Q-\">currentRSSI</variable><variable id=\"R~[E/Q~CT?p#Edsdj3uh\">lastBeaconTime</variable><variable id=\"A$KqR@Z8o+N32d=lf-:_\">leftScore</variable><variable id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</variable><variable id=\"liklD]!o^2z}(nl{|/Ri\">SCAN_MS</variable><variable id=\"/{.{gesL4}[+ScsFHTZ/\">SETTLE_MS</variable><variable id=\"]7o$z,jX.rE-+H/#O,#Q\">rightScore</variable><variable id=\"J:1.z!NNy8EbE$@BYrrJ\">SEEK_MS</variable><variable id=\"Z/1@,w-_3GJbT4=[.s3.\">rssiMax</variable><variable id=\"sRB]W+3kZ6S{s?a%VtRK\">t0</variable><variable id=\")qaQ2;%;g7PTDC+tpsQ?\">s</variable><variable id=\"7+Mi49Vi(r@b$HLC,=~1\">soundMax</variable><variable id=\"|z#Bi3#k=-$LEoj~.DOG\">BEACON_TIMEOUT_MS</variable><variable id=\")INkiCZ/jx!V{N|j0^[`\">SOUND_WEIGHT</variable><variable id=\";_HxxO.~Vn:4GYeO*vls\">RSSI_WEIGHT</variable><variable id=\"$BhYb^(i{2A#-Z/2+8Gi\">tStart</variable><variable id=\"^hGx2bJ_MaXJ?W`Im5FE\">lastRescan</variable><variable id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</variable><variable id=\"L{]I27XkQqE_8SF{_Fd(\">APPROACH_MAX_MS</variable><variable id=\"j2]1oHtc]7tM;JA4Zf%(\">t</variable><variable id=\"=/qz$L4$5LE^Ewh)(X?_\">SOUND_APPROACH_THRESH</variable><variable id=\"Jvy%1=fCd8!%Bu{Zm@u,\">quietStart</variable><variable id=\"bl|Itb[pR8Bx@)g1(E_3\">QUIET_STOP_MS</variable><variable id=\"Pk6w*/HWMmeO=5jMY*#|\">RESCAN_PERIOD_MS</variable><variable id=\"8]etx+BF3R?1.f@lr8py\">left</variable><variable id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</variable><variable id=\"`ZtNo]rEI3)e2u8)ija4\">SCAN_MS_SHORT</variable><variable id=\"BQVbdyP0BnLn1%DVJs%z\">right</variable><variable id=\"v!r$_l5kj#HbJv3zw9GT\">SEEK_MS_SHORT</variable><variable id=\"kfi#zx$?dFkn7RV,{Jx^\">v</variable><variable id=\"32VXQ{U`t0J44rf(!cMd\">MIN</variable><variable id=\"f?|JGAT!0iW,::B}YoM7\">MAX</variable><variable id=\"i3QI.ZPW|rY@#gr;l9(Z\">scanningAnimOn</variable><variable id=\"4oqX@Sm5hsjr5L@q1q]8\">RADIO_GROUP</variable></variables><comment x=\"0\" y=\"0\" w=\"480\" h=\"120\">\n=========================================================\n</comment><comment x=\"0\" y=\"0\" w=\"480\" h=\"120\">\n=========================================================\n=== PART 2: THE RESCUER LOGIC ==========================\n"]]},{"start1":2810,"length1":51058,"diffs":[[1,"Target tracking\n</comment><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"monitorOrientation\" functionid=\"_g5CT4D-l:BIuas8Z6q@\"></mutation><field name=\"function_name\">monitorOrientation</field><data>0</data><statement name=\"STACK\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.inBackground(function () {\" line1=\"        while (true) {\" line2=\"            const accelZ = input.acceleration(Dimension.Z);\" line3=\"\" line4=\"            // Detect Flip Down (Z &lt; -600)\" line5=\"            if (accelZ &lt; -600 &amp;&amp; !isDistressMode) {\" line6=\"                enterDistressMode();\" line7=\"            }\" line8=\"            // Detect Flip Up (Z &gt; 200)\" line9=\"            else if (accelZ &gt; 200 &amp;&amp; isDistressMode) {\" line10=\"                // Only exit if we are truly upright, not just shaken\" line11=\"                exitDistressMode();\" line12=\"            }\" line13=\"            basic.pause(50); // Check every 50ms (Fast Response)\" line14=\"        }\" line15=\"    });\" numlines=\"16\"></mutation></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"enterDistressMode\" functionid=\"$Sx$FhNOV9NznMwK2(Iw\"></mutation><field name=\"function_name\">enterDistressMode</field><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</field><comment pinned=\"false\" h=\"80\" w=\"160\">Stop trying to rescue others if I am hurt</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"cutebot_stopcar\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"function_call\"><mutation name=\"sadLights\" functionid=\"X=a:]Ue{RJTFC,RU,loN\"></mutation><next><block type=\"radio_datagram_send_value\"><value name=\"name\"><block type=\"variables_get\"><field name=\"VAR\" id=\"^j%oFTI0/$TbCv_zOML5\">MSG_ALERT</field></block></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"jf`~oRe.#J`a@InuozSt\">myId</field></block></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        while (isDistressMode) {\" line2=\"            // Broadcast beacon for RSSI tracking\" line3=\"            radio.sendValue(MSG_BEACON, myId);\" line4=\"            soundExpression.sad.play();\" line5=\"\" line6=\"            // Randomly re-send ALERT packet\" line7=\"            if (Math.randomBoolean()) {\" line8=\"                radio.sendValue(MSG_ALERT, myId);\" line9=\"            }\" line10=\"            basic.pause(600);\" line11=\"        }\" line12=\"    });\" numlines=\"13\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"exitDistressMode\" functionid=\"oap%09W(-PSB9z3O+BAR\"></mutation><field name=\"function_name\">exitDistressMode</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"radio_datagram_send_value\"><value name=\"name\"><block type=\"variables_get\"><field name=\"VAR\" id=\"jf$`u?l),0}^SVzOLf:D\">MSG_DONE</field></block></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"jf`~oRe.#J`a@InuozSt\">myId</field></block></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"k{$lQzHu4Kwc2o~gDj5B\"></mutation></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"scanSide\" functionid=\"B7ft2b2x_S}3n%ia*B]~\"><arg name=\"leftSpeed\" id=\"drqps96fb52xn70edjd2\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"kagwbea375l4c6rt6hxed\" type=\"number\"></arg><arg name=\"duration\" id=\"oldsmjr07cds6bd54ue6\" type=\"number\"></arg></mutation><field name=\"function_name\">scanSide</field><comment pinned=\"false\" h=\"80\" w=\"160\">Helper to scan one direction and return max score</comment><value name=\"drqps96fb52xn70edjd2\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">leftSpeed</field></block></value><value name=\"kagwbea375l4c6rt6hxed\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">rightSpeed</field></block></value><value name=\"oldsmjr07cds6bd54ue6\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">duration</field></block></value><statement name=\"STACK\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">leftSpeed</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rightSpeed</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Z/1@,w-_3GJbT4=[.s3.\">rssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"sRB]W+3kZ6S{s?a%VtRK\">t0</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"sRB]W+3kZ6S{s?a%VtRK\">t0</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">duration</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\")qaQ2;%;g7PTDC+tpsQ?\">s</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\")qaQ2;%;g7PTDC+tpsQ?\">s</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"7+Mi49Vi(r@b$HLC,=~1\">soundMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"7+Mi49Vi(r@b$HLC,=~1\">soundMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\")qaQ2;%;g7PTDC+tpsQ?\">s</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"R~[E/Q~CT?p#Edsdj3uh\">lastBeaconTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"|z#Bi3#k=-$LEoj~.DOG\">BEACON_TIMEOUT_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m4]mq*CkgYrTE,{sC_Q-\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Z/1@,w-_3GJbT4=[.s3.\">rssiMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Z/1@,w-_3GJbT4=[.s3.\">rssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m4]mq*CkgYrTE,{sC_Q-\">currentRSSI</field></block></value></block></statement></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">10</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\")INkiCZ/jx!V{N|j0^[`\">SOUND_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normSound\" functionid=\"/$qD{ZxSAhBsi=^v|c,l\"><arg name=\"v\" id=\"wmesznfx49nygom8tas3\" type=\"number\"></arg></mutation><value name=\"wmesznfx49nygom8tas3\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"7+Mi49Vi(r@b$HLC,=~1\">soundMax</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";_HxxO.~Vn:4GYeO*vls\">RSSI_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normRssi\" functionid=\"L3j6%NpfNt%yVYB/!{;r\"><arg name=\"rssi\" id=\"gsbsb20o5trvquels545\" type=\"number\"></arg></mutation><value name=\"gsbsb20o5trvquels545\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Z/1@,w-_3GJbT4=[.s3.\">rssiMax</field></block></value></block></value></block></value></block></value></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"approachWhileLoudWithRescan\" functionid=\"[Y1*wJmdgZ0I4c2r2@7o\"></mutation><field name=\"function_name\">approachWhileLoudWithRescan</field><comment pinned=\"false\" h=\"80\" w=\"160\">=== Approach Loop with Wiggle Correction ===</comment><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"$BhYb^(i{2A#-Z/2+8Gi\">tStart</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"^hGx2bJ_MaXJ?W`Im5FE\">lastRescan</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</field></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$BhYb^(i{2A#-Z/2+8Gi\">tStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"L{]I27XkQqE_8SF{_Fd(\">APPROACH_MAX_MS</field></block></value></block></value><statement name=\"DO\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Safety: stop if we get flipped during rescue</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2]1oHtc]7tM;JA4Zf%(\">t</field><comment pinned=\"false\" h=\"80\" w=\"160\">Volume Check</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2]1oHtc]7tM;JA4Zf%(\">t</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"=/qz$L4$5LE^Ewh)(X?_\">SOUND_APPROACH_THRESH</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Jvy%1=fCd8!%Bu{Zm@u,\">quietStart</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Jvy%1=fCd8!%Bu{Zm@u,\">quietStart</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Jvy%1=fCd8!%Bu{Zm@u,\">quietStart</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Jvy%1=fCd8!%Bu{Zm@u,\">quietStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"bl|Itb[pR8Bx@)g1(E_3\">QUIET_STOP_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"break_keyword\"></block></statement></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Periodic Re-Scan (Wiggle)</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^hGx2bJ_MaXJ?W`Im5FE\">lastRescan</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Pk6w*/HWMmeO=5jMY*#|\">RESCAN_PERIOD_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"briefRescanAndAdjust\" functionid=\"Yz$6STe._6;aWBz?9{`J\"></mutation><next><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"^hGx2bJ_MaXJ?W`Im5FE\">lastRescan</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></next></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"briefRescanAndAdjust\" functionid=\"Yz$6STe._6;aWBz?9{`J\"></mutation><field name=\"function_name\">briefRescanAndAdjust</field><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningLights\" functionid=\"?oCHj$obZ$6)YXTOP8Gg\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\"8]etx+BF3R?1.f@lr8py\">left</field><comment pinned=\"false\" h=\"80\" w=\"160\">Quick Left/Right check</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanSide\" functionid=\"B7ft2b2x_S}3n%ia*B]~\"><arg name=\"leftSpeed\" id=\"drqps96fb52xn70edjd2\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"kagwbea375l4c6rt6hxed\" type=\"number\"></arg><arg name=\"duration\" id=\"oldsmjr07cds6bd54ue6\" type=\"number\"></arg></mutation><value name=\"drqps96fb52xn70edjd2\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value></block></value><value name=\"kagwbea375l4c6rt6hxed\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value><value name=\"oldsmjr07cds6bd54ue6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"`ZtNo]rEI3)e2u8)ija4\">SCAN_MS_SHORT</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"BQVbdyP0BnLn1%DVJs%z\">right</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanSide\" functionid=\"B7ft2b2x_S}3n%ia*B]~\"><arg name=\"leftSpeed\" id=\"drqps96fb52xn70edjd2\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"kagwbea375l4c6rt6hxed\" type=\"number\"></arg><arg name=\"duration\" id=\"oldsmjr07cds6bd54ue6\" type=\"number\"></arg></mutation><value name=\"drqps96fb52xn70edjd2\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value><value name=\"kagwbea375l4c6rt6hxed\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value></block></value><value name=\"oldsmjr07cds6bd54ue6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"`ZtNo]rEI3)e2u8)ija4\">SCAN_MS_SHORT</field></block></value></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"8]etx+BF3R?1.f@lr8py\">left</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"BQVbdyP0BnLn1%DVJs%z\">right</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"v!r$_l5kj#HbJv3zw9GT\">SEEK_MS_SHORT</field></block></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"v!r$_l5kj#HbJv3zw9GT\">SEEK_MS_SHORT</field></block></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"sadLights\" functionid=\"X=a:]Ue{RJTFC,RU,loN\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let scanningAnimOn = false\" numlines=\"1\" declaredvars=\"scanningAnimOn\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let isDistressMode = false\" numlines=\"1\" declaredvars=\"isDistressMode\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== Global State Variables ======</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"4oqX@Sm5hsjr5L@q1q]8\">RADIO_GROUP</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Radio setup ======\nMust be same on all bots</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">17</field></shadow></value><next><block type=\"radio_set_group\"><value name=\"ID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"255\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"4oqX@Sm5hsjr5L@q1q]8\">RADIO_GROUP</field></block></value><next><block type=\"radio_set_transmit_power\"><comment pinned=\"false\" h=\"80\" w=\"160\">Max power</comment><value name=\"power\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"7\" precision=\"0\"></mutation><field name=\"SLIDER\">7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"jf`~oRe.#J`a@InuozSt\">myId</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_device_serial_number\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"^j%oFTI0/$TbCv_zOML5\">MSG_ALERT</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Message types ======</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">ALERT</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"sp`5#c{[W6=1s*I*Hnw4\">MSG_BEACON</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">BEACON</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"jf$`u?l),0}^SVzOLf:D\">MSG_DONE</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">DONE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Motion/Scan Constants ======\nSpeed for initial scan</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">40</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"liklD]!o^2z}(nl{|/Ri\">SCAN_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Duration to listen per side</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">600</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"J:1.z!NNy8EbE$@BYrrJ\">SEEK_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Duration to turn towards target</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">400</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/{.{gesL4}[+ScsFHTZ/\">SETTLE_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Pause to stabilize</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Approach Constants ======</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">25</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"=/qz$L4$5LE^Ewh)(X?_\">SOUND_APPROACH_THRESH</field><comment pinned=\"false\" h=\"80\" w=\"160\">Stop if quieter than this</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">60</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"L{]I27XkQqE_8SF{_Fd(\">APPROACH_MAX_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Give up after 5 seconds</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">5000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"bl|Itb[pR8Bx@)g1(E_3\">QUIET_STOP_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Stop if quiet for 0.5s</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">500</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Pk6w*/HWMmeO=5jMY*#|\">RESCAN_PERIOD_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Re-scan Constants ======\nRe-check heading every 0.8s</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">800</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"`ZtNo]rEI3)e2u8)ija4\">SCAN_MS_SHORT</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">300</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"v!r$_l5kj#HbJv3zw9GT\">SEEK_MS_SHORT</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">250</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\")INkiCZ/jx!V{N|j0^[`\">SOUND_WEIGHT</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Sensor Weights (0.0 to 1.0) ======\nTrust ears more</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\";_HxxO.~Vn:4GYeO*vls\">RSSI_WEIGHT</field><comment pinned=\"false\" h=\"80\" w=\"160\">Trust radio less</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.3</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m4]mq*CkgYrTE,{sC_Q-\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"|z#Bi3#k=-$LEoj~.DOG\">BEACON_TIMEOUT_MS</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">2000</field></shadow></value><next><block type=\"function_call\"><mutation name=\"monitorOrientation\" functionid=\"_g5CT4D-l:BIuas8Z6q@\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== Main Entry ======</comment><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"k{$lQzHu4Kwc2o~gDj5B\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"device_gesture_event\" x=\"1155\" y=\"20\"><field name=\"NAME\">Gesture.Shake</field><comment pinned=\"false\" h=\"80\" w=\"160\">Manual Shake Trigger</comment><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"enterDistressMode\" functionid=\"$Sx$FhNOV9NznMwK2(Iw\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"            basic.pause(3000);\" line2=\"            if (isDistressMode &amp;&amp; input.acceleration(Dimension.Z) &gt; -200) {\" line3=\"                exitDistressMode();\" line4=\"            }\" line5=\"        });\" numlines=\"6\"></mutation></block></next></block></statement></block></statement></block><block type=\"radio_on_value_drag\" x=\"2293\" y=\"20\"><data>1</data><value name=\"HANDLER_DRAG_PARAM_name\"><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"HANDLER_DRAG_PARAM_value\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\":s0#vocc2*9?#P^3nu`q\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"radio_received_packet\"><value name=\"type\"><shadow type=\"radio_packet_property\"><field name=\"note\">RadioPacketProperty.SignalStrength</field></shadow></value></block></value><next><block type=\"controls_if\"><mutation elseif=\"2\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^j%oFTI0/$TbCv_zOML5\">MSG_ALERT</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"nJfq+;#[}QkfzJ]t_FfX\">senderId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">NEQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"nJfq+;#[}QkfzJ]t_FfX\">senderId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"jf`~oRe.#J`a@InuozSt\">myId</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"respondToAlert\" functionid=\"RsD/h=JDqX]s98,0$Ul;\"><arg name=\"senderId\" id=\"whyiryu2kkiomfi66j2qb\" type=\"number\"></arg></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Start Rescue!</comment><value name=\"whyiryu2kkiomfi66j2qb\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"nJfq+;#[}QkfzJ]t_FfX\">senderId</field></block></value></block></statement></block></next></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"sp`5#c{[W6=1s*I*Hnw4\">MSG_BEACON</field></block></value></block></value><statement name=\"DO1\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Only track the robot we are looking for</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"m4]mq*CkgYrTE,{sC_Q-\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":s0#vocc2*9?#P^3nu`q\">rssi</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"R~[E/Q~CT?p#Edsdj3uh\">lastBeaconTime</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></statement></block></statement><value name=\"IF2\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"jf$`u?l),0}^SVzOLf:D\">MSG_DONE</field></block></value></block></value><statement name=\"DO2\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</field><comment pinned=\"false\" h=\"80\" w=\"160\">Victim is happy, stop rescue</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"k{$lQzHu4Kwc2o~gDj5B\"></mutation></block></next></block></next></block></next></block></statement></block></statement></block></next></block></statement></block><block type=\"function_definition\" x=\"3164\" y=\"20\"><mutation name=\"calmLights\" functionid=\"k{$lQzHu4Kwc2o~gDj5B\"></mutation><field name=\"function_name\">calmLights</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== LED Control ======</comment><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"Mamdo$!Y;4_v3%)jMUPp\"></mutation><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"3595\" y=\"20\"><mutation name=\"sadLights\" functionid=\"X=a:]Ue{RJTFC,RU,loN\"></mutation><field name=\"function_name\">sadLights</field><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"Mamdo$!Y;4_v3%)jMUPp\"></mutation><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xff0000</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"4026\" y=\"20\"><mutation name=\"scanningLights\" functionid=\"?oCHj$obZ$6)YXTOP8Gg\"></mutation><field name=\"function_name\">scanningLights</field><statement name=\"STACK\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xffff00</field></shadow></value><next><block type=\"function_call\"><mutation name=\"scanningAnimationStart\" functionid=\"{Sn0TTI*Qvd%8G8:AR*X\"></mutation></block></next></block></statement></block><block type=\"function_definition\" x=\"4456\" y=\"20\"><mutation name=\"scanningAnimationStart\" functionid=\"{Sn0TTI*Qvd%8G8:AR*X\"></mutation><field name=\"function_name\">scanningAnimationStart</field><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i3QI.ZPW|rY@#gr;l9(Z\">scanningAnimOn</field></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i3QI.ZPW|rY@#gr;l9(Z\">scanningAnimOn</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        const frames = [\" line2=\"            images.createImage(`. . . . . \\n . . # . . \\n . # . # . \\n . . . . . \\n . . . . .`),\" line3=\"            images.createImage(`. . . . . \\n . . . . . \\n . . # . . \\n . . . . . \\n . . . . .`),\" line4=\"            images.createImage(`. . . . . \\n . . . . . \\n . # . # . \\n . . # . . \\n . . . . .`),\" line5=\"        ];\" line6=\"        let i = 0;\" line7=\"        while (scanningAnimOn) {\" line8=\"            frames[i].showImage(0);\" line9=\"            i = (i + 1) % frames.length;\" line10=\"            basic.pause(120);\" line11=\"        }\" line12=\"        basic.clearScreen();\" line13=\"    });\" numlines=\"14\"></mutation></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"20\" y=\"1906\"><mutation name=\"scanningAnimationStop\" functionid=\"Mamdo$!Y;4_v3%)jMUPp\"></mutation><field name=\"function_name\">scanningAnimationStop</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"i3QI.ZPW|rY@#gr;l9(Z\">scanningAnimOn</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value></block></statement></block><block type=\"function_definition\" x=\"450\" y=\"1906\"><mutation name=\"normSound\" functionid=\"/$qD{ZxSAhBsi=^v|c,l\"><arg name=\"v\" id=\"wmesznfx49nygom8tas3\" type=\"number\"></arg></mutation><field name=\"function_name\">normSound</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Normalization Helpers ======</comment><value name=\"wmesznfx49nygom8tas3\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"kfi#zx$?dFkn7RV,{Jx^\">v</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"kfi#zx$?dFkn7RV,{Jx^\">v</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></value></block></value></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"1035\" y=\"1906\"><mutation name=\"normRssi\" functionid=\"L3j6%NpfNt%yVYB/!{;r\"><arg name=\"rssi\" id=\"gsbsb20o5trvquels545\" type=\"number\"></arg></mutation><field name=\"function_name\">normRssi</field><value name=\"gsbsb20o5trvquels545\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"32VXQ{U`t0J44rf(!cMd\">MIN</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-95</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"f?|JGAT!0iW,::B}YoM7\">MAX</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-45</field></shadow></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"32VXQ{U`t0J44rf(!cMd\">MIN</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\":s0#vocc2*9?#P^3nu`q\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"32VXQ{U`t0J44rf(!cMd\">MIN</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"f?|JGAT!0iW,::B}YoM7\">MAX</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\":s0#vocc2*9?#P^3nu`q\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"f?|JGAT!0iW,::B}YoM7\">MAX</field></block></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"32VXQ{U`t0J44rf(!cMd\">MIN</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"f?|JGAT!0iW,::B}YoM7\">MAX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"32VXQ{U`t0J44rf(!cMd\">MIN</field></block></value></block></value></block></value></block></value></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2968\" y=\"1906\"><mutation name=\"respondToAlert\" functionid=\"RsD/h=JDqX]s98,0$Ul;\"><arg name=\"senderId\" id=\"whyiryu2kkiomfi66j2qb\" type=\"number\"></arg></mutation><field name=\"function_name\">respondToAlert</field><value name=\"whyiryu2kkiomfi66j2qb\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">senderId</field></block></value><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">senderId</field></block></value><next><block type=\"function_call\"><mutation name=\"scanningLights\" functionid=\"?oCHj$obZ$6)YXTOP8Gg\"></mutation><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"A$KqR@Z8o+N32d=lf-:_\">leftScore</field><comment pinned=\"false\" h=\"80\" w=\"160\">1. Scan Left/Right to find direction</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanSide\" functionid=\"B7ft2b2x_S}3n%ia*B]~\"><arg name=\"leftSpeed\" id=\"drqps96fb52xn70edjd2\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"kagwbea375l4c6rt6hxed\" type=\"number\"></arg><arg name=\"duration\" id=\"oldsmjr07cds6bd54ue6\" type=\"number\"></arg></mutation><value name=\"drqps96fb52xn70edjd2\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value></block></value><value name=\"kagwbea375l4c6rt6hxed\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value><value name=\"oldsmjr07cds6bd54ue6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"liklD]!o^2z}(nl{|/Ri\">SCAN_MS</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/{.{gesL4}[+ScsFHTZ/\">SETTLE_MS</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"]7o$z,jX.rE-+H/#O,#Q\">rightScore</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanSide\" functionid=\"B7ft2b2x_S}3n%ia*B]~\"><arg name=\"leftSpeed\" id=\"drqps96fb52xn70edjd2\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"kagwbea375l4c6rt6hxed\" type=\"number\"></arg><arg name=\"duration\" id=\"oldsmjr07cds6bd54ue6\" type=\"number\"></arg></mutation><value name=\"drqps96fb52xn70edjd2\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value><value name=\"kagwbea375l4c6rt6hxed\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value></block></value><value name=\"oldsmjr07cds6bd54ue6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"liklD]!o^2z}(nl{|/Ri\">SCAN_MS</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/{.{gesL4}[+ScsFHTZ/\">SETTLE_MS</field></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">2. Pivot towards winner</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"A$KqR@Z8o+N32d=lf-:_\">leftScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"]7o$z,jX.rE-+H/#O,#Q\">rightScore</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"J:1.z!NNy8EbE$@BYrrJ\">SEEK_MS</field></block></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"J:1.z!NNy8EbE$@BYrrJ\">SEEK_MS</field></block></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"sadLights\" functionid=\"X=a:]Ue{RJTFC,RU,loN\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">3. Empathize and Approach</comment><next><block type=\"SoundExpression_play\"><field name=\"this\">soundExpression.sad</field><next><block type=\"function_call\"><mutation name=\"approachWhileLoudWithRescan\" functionid=\"[Y1*wJmdgZ0I4c2r2@7o\"></mutation><next><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"Mamdo$!Y;4_v3%)jMUPp\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">4. Reset</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"k{$lQzHu4Kwc2o~gDj5B\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":138,"diffs":[[1,"// ====== Radio setup ======\nconst RADIO_GROUP = 17;           // Must be same on all bots\nradio.setGroup(RADIO_GROUP);\nradio.setTransmitPower(7);        // Max power\n"]]},{"start1":168,"length1":72,"diffs":[[1,"const myId = control.deviceSerialNumber();\n"]]},{"start1":212,"length1":262,"diffs":[[1,"// ====== Message types ======\nconst MSG_ALERT = \"ALERT\";\nconst MSG_BEACON = \"BEACON\";\nconst MSG_DONE = \"DONE\";\n"]]},{"start1":325,"length1":148,"diffs":[[1,"// ====== Motion/Scan Constants ======\nconst TURN_SPEED = 40;     // Speed for initial scan\nconst SCAN_MS = 600;       // Duration to listen per side\nconst SEEK_MS = 400;       // Duration to turn towards target\nconst SETTLE_MS = 100;     // Pause to stabilize\n"]]},{"start1":587,"length1":160,"diffs":[[1,"// ====== Approach Constants ======\nconst SLOW_FORWARD_SPEED = 25;\nconst SOUND_APPROACH_THRESH = 60;  // Stop if quieter than this\nconst APPROACH_MAX_MS = 5000;      // Give up after 5 seconds\nconst QUIET_STOP_MS = 500;         // Stop if quiet for 0.5s\n"]]},{"start1":842,"length1":86,"diffs":[[1,"// ====== Re-scan Constants ======\nconst RESCAN_PERIOD_MS = 800;      // Re-check heading every 0.8s\nconst SCAN_MS_SHORT = 300;\nconst SEEK_MS_SHORT = 250;\nconst APPROACH_TURN_SPEED = 35;\n"]]},{"start1":1030,"length1":100,"diffs":[[1,"// ====== Sensor Weights (0.0 to 1.0) ======\nconst SOUND_WEIGHT = 0.7; // Trust ears more\nconst RSSI_WEIGHT = 0.3;  // Trust radio less\n"]]},{"start1":1167,"length1":0,"diffs":[[1,"// ====== Global State Variables ======\nlet isDistressMode = false;\nlet scanning = false;\nlet scanningAnimOn = false;\n"]]},{"start1":1286,"length1":138,"diffs":[[1,"// Target tracking\nlet targetId = 0;\nlet currentRSSI = -128;\nlet lastBeaconTime = 0;\nconst BEACON_TIMEOUT_MS = 2000;\n"]]},{"start1":1404,"length1":164,"diffs":[[1,"// =========================================================\n// === PART 1: FAST FLIP DETECTION (THE VICTIM) ===========\n// =========================================================\n"]]},{"start1":1587,"length1":83,"diffs":[[1,"function monitorOrientation() {\n    control.inBackground(function () {\n        while (true) {\n            const accelZ = input.acceleration(Dimension.Z);\n"]]},{"start1":1742,"length1":201,"diffs":[[1,"            // Detect Flip Down (Z < -600)\n            if (accelZ < -600 && !isDistressMode) {\n                enterDistressMode();\n            }\n            // Detect Flip Up (Z > 200)\n            else if (accelZ > 200 && isDistressMode) {\n                // Only exit if we are truly upright, not just shaken\n                exitDistressMode();\n            }\n            basic.pause(50); // Check every 50ms (Fast Response)\n"]]},{"start1":2178,"length1":392,"diffs":[[1,"    });\n}\n"]]},{"start1":2189,"length1":622,"diffs":[[1,"function enterDistressMode() {\n    if (isDistressMode) return;\n"]]},{"start1":2279,"length1":48,"diffs":[[1,"    scanning = false; // Stop trying to rescue others if I am hurt\n"]]},{"start1":2370,"length1":114,"diffs":[[1,"    sadLights();\n    radio.sendValue(MSG_ALERT, myId);\n"]]},{"start1":2426,"length1":125,"diffs":[[1,"    // Continuous Distress Loop\n"]]},{"start1":2531,"length1":137,"diffs":[[1,"            // Broadcast beacon for RSSI tracking\n            radio.sendValue(MSG_BEACON, myId);\n"]]},{"start1":2669,"length1":74,"diffs":[[1,"            // Randomly re-send ALERT packet\n"]]},{"start1":2754,"length1":53,"diffs":[[1,"                radio.sendValue(MSG_ALERT, myId);\n"]]},{"start1":2818,"length1":51,"diffs":[[1,"            basic.pause(600);\n"]]},{"start1":2869,"length1":24,"diffs":[[1,"function exitDistressMode() {\n"]]},{"start1":2927,"length1":84,"diffs":[[1,"    radio.sendValue(MSG_DONE, myId);\n    calmLights();\n"]]},{"start1":2985,"length1":0,"diffs":[[1,"// Manual Shake Trigger\ninput.onGesture(Gesture.Shake, function () {\n    if (!isDistressMode) {\n        enterDistressMode();\n        // Force sadness for at least 3 seconds on shake\n        control.runInParallel(function () {\n            basic.pause(3000);\n            if (isDistressMode && input.acceleration(Dimension.Z) > -200) {\n                exitDistressMode();\n            }\n        });\n    }\n});\n"]]},{"start1":3391,"length1":138,"diffs":[[1,"// =========================================================\n// === PART 2: THE RESCUER LOGIC ==========================\n// =========================================================\n"]]},{"start1":3574,"length1":55,"diffs":[[1,"radio.onReceivedValue(function (name: string, value: number) {\n    const rssi = radio.receivedPacket(RadioPacketProperty.SignalStrength);\n"]]},{"start1":3713,"length1":531,"diffs":[[1,"    if (name == MSG_ALERT) {\n        const senderId = value;\n        if (senderId != myId && !isDistressMode && !scanning) {\n            // Start Rescue!\n            respondToAlert(senderId);\n        }\n"]]},{"start1":3921,"length1":0,"diffs":[[1,"    else if (name == MSG_BEACON) {\n        // Only track the robot we are looking for\n        if (targetId == 0 || value == targetId) {\n            currentRSSI = rssi;\n            lastBeaconTime = input.runningTime();\n        }\n    }\n    else if (name == MSG_DONE) {\n        if (value == targetId) {\n            // Victim is happy, stop rescue\n            scanning = false;\n            targetId = 0;\n            cuteBot.stopcar();\n            calmLights();\n        }\n    }\n});\n"]]},{"start1":4399,"length1":120,"diffs":[[1,"function respondToAlert(senderId: number) {\n    scanning = true;\n    targetId = senderId;\n    scanningLights();\n"]]},{"start1":4533,"length1":81,"diffs":[[1,""]]},{"start1":4534,"length1":48,"diffs":[[1,"    // 1. Scan Left/Right to find direction\n    let leftScore = scanSide(-TURN_SPEED, TURN_SPEED, SCAN_MS);\n    basic.pause(SETTLE_MS);\n    let rightScore = scanSide(TURN_SPEED, -TURN_SPEED, SCAN_MS);\n    basic.pause(SETTLE_MS);\n\n    // 2. Pivot towards winner\n"]]},{"start1":4829,"length1":72,"diffs":[[1,"        cuteBot.motors(-TURN_SPEED, TURN_SPEED);\n        basic.pause(SEEK_MS);\n"]]},{"start1":4921,"length1":73,"diffs":[[1,"        cuteBot.motors(TURN_SPEED, -TURN_SPEED);\n        basic.pause(SEEK_MS);\n"]]},{"start1":5030,"length1":77,"diffs":[[1,"    // 3. Empathize and Approach\n    sadLights();\n    soundExpression.sad.play();\n    approachWhileLoudWithRescan();\n"]]},{"start1":5148,"length1":59,"diffs":[[1,"    // 4. Reset\n    scanningAnimationStop();\n    scanning = false;\n    targetId = 0;\n    calmLights();\n"]]},{"start1":5254,"length1":190,"diffs":[[1,"// Helper to scan one direction and return max score\nfunction scanSide(leftSpeed: number, rightSpeed: number, duration: number): number {\n    cuteBot.motors(leftSpeed, rightSpeed);\n    let soundMax = 0;\n    let rssiMax = -128;\n"]]},{"start1":5482,"length1":245,"diffs":[[1,"    const t0 = input.runningTime();\n    while (input.runningTime() - t0 < duration) {\n        const s = input.soundLevel();\n        if (s > soundMax) soundMax = s;\n"]]},{"start1":5647,"length1":290,"diffs":[[1,"        if (input.runningTime() - lastBeaconTime < BEACON_TIMEOUT_MS) {\n            if (currentRSSI > rssiMax) rssiMax = currentRSSI;\n"]]},{"start1":5791,"length1":0,"diffs":[[1,"        basic.pause(10);\n    }\n    cuteBot.stopcar();\n"]]},{"start1":5846,"length1":192,"diffs":[[1,"    return (SOUND_WEIGHT * normSound(soundMax)) + (RSSI_WEIGHT * normRssi(rssiMax));\n}\n"]]},{"start1":5934,"length1":118,"diffs":[[1,"// === Approach Loop with Wiggle Correction ===\nfunction approachWhileLoudWithRescan() {\n    const tStart = input.runningTime();\n    let quietStart = 0;\n    let lastRescan = input.runningTime();\n"]]},{"start1":6130,"length1":179,"diffs":[[1,"    cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED);\n"]]},{"start1":6191,"length1":299,"diffs":[[1,"    while (input.runningTime() - tStart < APPROACH_MAX_MS) {\n        // Safety: stop if we get flipped during rescue\n        if (isDistressMode) {\n            cuteBot.stopcar();\n            return;\n"]]},{"start1":6400,"length1":164,"diffs":[[1,"        // Volume Check\n        const s = input.soundLevel();\n        if (s >= SOUND_APPROACH_THRESH) {\n            quietStart = 0;\n        } else {\n            if (quietStart == 0) quietStart = input.runningTime();\n            if (input.runningTime() - quietStart >= QUIET_STOP_MS) break;\n"]]},{"start1":6701,"length1":25,"diffs":[[1,"        // Periodic Re-Scan (Wiggle)\n        if (input.runningTime() - lastRescan >= RESCAN_PERIOD_MS) {\n            cuteBot.stopcar();\n            briefRescanAndAdjust();\n            cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED);\n            lastRescan = input.runningTime();\n        }\n        basic.pause(20);\n"]]},{"start1":7054,"length1":51,"diffs":[[1,"function briefRescanAndAdjust() {\n    scanningLights();\n    // Quick Left/Right check\n    let left = scanSide(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED, SCAN_MS_SHORT);\n    basic.pause(50);\n    let right = scanSide(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED, SCAN_MS_SHORT);\n"]]},{"start1":7329,"length1":362,"diffs":[[1,"    if (left > right) {\n        cuteBot.motors(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED);\n        basic.pause(SEEK_MS_SHORT);\n    } else {\n        cuteBot.motors(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED);\n        basic.pause(SEEK_MS_SHORT);\n"]]},{"start1":7578,"length1":938,"diffs":[[1,""]]},{"start1":7601,"length1":446,"diffs":[[1,"    sadLights();\n"]]},{"start1":7621,"length1":109,"diffs":[[1,"// ====== Normalization Helpers ======\nfunction normSound(v: number): number {\n    if (v < 0) v = 0; if (v > 255) v = 255;\n    return Math.round(v * 100 / 255);\n"]]},{"start1":7784,"length1":0,"diffs":[[1,"function normRssi(rssi: number): number {\n    const MIN = -95, MAX = -45;\n    if (rssi < MIN) rssi = MIN; if (rssi > MAX) rssi = MAX;\n    return Math.round((rssi - MIN) * 100 / (MAX - MIN));\n}\n"]]},{"start1":7978,"length1":0,"diffs":[[1,"// ====== LED Control ======\n"]]},{"start1":8031,"length1":66,"diffs":[[1,"    scanningAnimationStop();\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00);\n"]]},{"start1":8156,"length1":0,"diffs":[[1,"function sadLights() {\n    scanningAnimationStop();\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xff0000);\n    basic.showIcon(IconNames.Sad);\n}\nfunction scanningLights() {\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xffff00);\n    scanningAnimationStart();\n}\n\nfunction scanningAnimationStart() {\n    if (scanningAnimOn) return;\n    scanningAnimOn = true;\n    control.runInParallel(function () {\n        const frames = [\n            images.createImage(`. . . . . \\n . . # . . \\n . # . # . \\n . . . . . \\n . . . . .`),\n            images.createImage(`. . . . . \\n . . . . . \\n . . # . . \\n . . . . . \\n . . . . .`),\n            images.createImage(`. . . . . \\n . . . . . \\n . # . # . \\n . . # . . \\n . . . . .`),\n        ];\n        let i = 0;\n        while (scanningAnimOn) {\n            frames[i].showImage(0);\n            i = (i + 1) % frames.length;\n            basic.pause(120);\n        }\n        basic.clearScreen();\n    });\n}\nfunction scanningAnimationStop() {\n    scanningAnimOn = false;\n}\n\n// ====== Main Entry ======\nmonitorOrientation();\ncalmLights();"]]}]}]},{"timestamp":1764917879979,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":524,"length1":0,"diffs":[[1,"// These will be adjusted dynamically in startRescueRoutine()\n"]]},{"start1":784,"length1":71,"diffs":[[1,""]]},{"start1":1176,"length1":170,"diffs":[[1,"    // If I am the victim, I ignore all radio input.\n    if (isDistressMode) {\n"]]},{"start1":1278,"length1":133,"diffs":[[1,"    const incomingRSSI = radio.receivedPacket(RadioPacketProperty.SignalStrength);\n"]]},{"start1":1362,"length1":264,"diffs":[[1,"    if (name == \"ALERT\") {\n        // Only start rescue if I'm not already busy\n        if (!isRescuing) {\n            targetId = value; // Lock onto this specific ID\n            startRescueRoutine();\n        }\n    } else if (name == \"BEACON\") {\n"]]},{"start1":1658,"length1":71,"diffs":[[1,"        if (targetId == 0 || value == targetId) {\n"]]},{"start1":1808,"length1":37,"diffs":[[1,"    } else if (name == \"SAFE\") {\n"]]},{"start1":1885,"length1":52,"diffs":[[1,"        if (value == targetId) {\n"]]},{"start1":1961,"length1":280,"diffs":[[1,""]]},{"start1":2106,"length1":0,"diffs":[[1,"// Monitor orientation in background (fast reaction)\n"]]},{"start1":2265,"length1":0,"diffs":[[1,"        // Flip detected (upside down) -> become victim\n"]]},{"start1":2402,"length1":0,"diffs":[[1,"        // Flipped back up -> become safe\n"]]},{"start1":2615,"length1":42,"diffs":[[1,"    isRescuing = false; // Stop everything else\n"]]},{"start1":2687,"length1":57,"diffs":[[1,"    // Visuals\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xff0000); // RED\n"]]},{"start1":2802,"length1":37,"diffs":[[1,"    // RADIO: send initial ALERT\n"]]},{"start1":2877,"length1":33,"diffs":[[1,"    // BACKGROUND LOOP: continuous BEACON & sound\n"]]},{"start1":3000,"length1":0,"diffs":[[1,"            // 1. Send BEACON (for others to track RSSI)\n"]]},{"start1":3107,"length1":0,"diffs":[[1,"\n            // 2. Make noise\n"]]},{"start1":3178,"length1":97,"diffs":[[1,"            // 3. Occasionally re-send ALERT (in case rescuers missed it)\n            if (Math.randomBoolean()) {\n                radio.sendValue(\"ALERT\", MY_SERIAL);\n            }\n\n            basic.pause(500); // Pulse every 0.5s\n"]]},{"start1":3483,"length1":69,"diffs":[[1,"    radio.sendValue(\"SAFE\", MY_SERIAL); // Tell rescuers to stop\n"]]},{"start1":3766,"length1":244,"diffs":[[1,"    // Acknowledge phase\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xffff00); // YELLOW\n"]]},{"start1":3896,"length1":22,"diffs":[[1,"    basic.pause(500); // Listen briefly to get initial RSSI\n"]]},{"start1":3957,"length1":53,"diffs":[[1,"    // Dynamically adjust weights based on how strong initial RSSI is\n"]]},{"start1":4091,"length1":0,"diffs":[[1,"        // Already close -> trust sound more for scan\n"]]},{"start1":4203,"length1":0,"diffs":[[1,"        // Far away -> trust radio more for scan\n"]]},{"start1":4304,"length1":64,"diffs":[[1,"    // --- STEP 1: SCAN (Left vs Right using hybrid score) ---\n    let leftScore = scanDirection(-35, 35); // Turn left\n"]]},{"start1":4446,"length1":45,"diffs":[[1,"    let rightScore = scanDirection(35, -35); // Turn right\n"]]},{"start1":4528,"length1":0,"diffs":[[1,"    // Turn towards the better scored direction\n"]]},{"start1":4610,"length1":33,"diffs":[[1,"        cuteBot.motors(-35, 35); // Turn left\n"]]},{"start1":4695,"length1":33,"diffs":[[1,"        cuteBot.motors(35, -35); // Turn right\n"]]},{"start1":4798,"length1":24,"diffs":[[1,"    // --- STEP 2: APPROACH (Hybrid: radio + sound) ---\n"]]},{"start1":4876,"length1":0,"diffs":[[1,"    // Done (either success or timeout)\n"]]},{"start1":5008,"length1":85,"diffs":[[1,"    cuteBot.motors(25, 25); // Slow approach\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x0000ff); // BLUE (Driving)\n"]]},{"start1":5193,"length1":0,"diffs":[[1,"        // Safety: if I accidentally flip while driving, stop immediately & become victim\n"]]},{"start1":5421,"length1":46,"diffs":[[1,"        // CHECK 1: Are we there yet? (strong radio + strong sound)\n"]]},{"start1":5676,"length1":54,"diffs":[[1,"        // CHECK 2: Radio says \"very close\" but sound is low -> do a local rescan\n"]]},{"start1":5869,"length1":0,"diffs":[[1,"            // Local small re-scan, giving sound more weight now\n"]]},{"start1":6406,"length1":36,"diffs":[[1,"            cuteBot.motors(25, 25); // Resume forward motion\n"]]},{"start1":6478,"length1":35,"diffs":[[1,"        // CHECK 3: If both radio & sound are very weak, assume we lost the trail\n"]]},{"start1":6684,"length1":1,"diffs":[[1,""]]},{"start1":6762,"length1":0,"diffs":[[1,"    // Extra confirmation step:\n    // If sound isn't loud enough here, we might be fooled by multipath RSSI.\n"]]},{"start1":6920,"length1":66,"diffs":[[1,"        // Back off slightly and try again with a fresh rescue routine\n"]]},{"start1":7078,"length1":75,"diffs":[[1,"        startRescueRoutine();\n"]]},{"start1":7131,"length1":0,"diffs":[[1,"    // Victory dance\n"]]},{"start1":7186,"length1":61,"diffs":[[1,"        cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00); // GREEN\n"]]},{"start1":7323,"length1":61,"diffs":[[1,"        cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x000000); // OFF\n"]]},{"start1":7566,"length1":0,"diffs":[[1,"// Turns robot, records max volume and signal, returns a hybrid score\n"]]},{"start1":7835,"length1":0,"diffs":[[1,"    // Scan for 600 ms\n"]]},{"start1":8092,"length1":0,"diffs":[[1,"    // Normalize and score:\n    // Sound 0–255 -> 0–100\n    // RSSI -95 to -40 -> 0–100\n"]]},{"start1":8293,"length1":0,"diffs":[[1,"    // Clamp values into 0–100\n"]]},{"start1":8589,"length1":28,"diffs":[[1,""]]},{"start1":8676,"length1":57,"diffs":[[1,"    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00); // GREEN\n"]]}]}]},{"timestamp":1764918290104,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":318,"length1":123,"diffs":[[1,"const RSSI_ARRIVED_THRESH = -55;  // Signal strength indicating we are VERY close\nconst MAX_SEARCH_TIME = 6000;     // Give up after 6 seconds if not found\n"]]},{"start1":595,"length1":168,"diffs":[[1,"let isDistressMode = false;       // Am I the victim?\nlet isRescuing = false;           // Am I currently looking for someone?\nlet hasAckedVictim = false;       // Have I already ACKed this victim?\n"]]},{"start1":794,"length1":172,"diffs":[[1,"// Track the target\nlet targetId = 0;\nlet currentRSSI = -100;\nlet lastBeaconTime = 0;\n"]]},{"start1":881,"length1":139,"diffs":[[1,"// Initial setup\n"]]},{"start1":927,"length1":27,"diffs":[[1,"radio.setTransmitPower(7); // Max power\n"]]},{"start1":1029,"length1":46,"diffs":[[1,"// === 1. RADIO HANDLER =====================\n"]]},{"start1":1269,"length1":56,"diffs":[[1,"    // Ignore my own packets (avoid self-trigger loops)\n"]]},{"start1":1405,"length1":70,"diffs":[[1,"        // Victim MUST NOT react to alerts (it is the one in trouble)\n"]]},{"start1":1512,"length1":58,"diffs":[[1,"        // If I'm already rescuing someone, ignore new alerts\n"]]},{"start1":1776,"length1":58,"diffs":[[1,"        // Only listen to the robot I am tracking\n"]]},{"start1":2034,"length1":49,"diffs":[[1,"        // Victim is safe, reset everything\n"]]},{"start1":2203,"length1":42,"diffs":[[1,"        // Only the victim with that ID cares\n"]]},{"start1":2301,"length1":91,"diffs":[[1,"            // A rescuer has acknowledged. Do NOT become rescuer.\n            // Just keep beeping & beaconing; don't react as rescuer.\n"]]},{"start1":2505,"length1":46,"diffs":[[1,"// === 2. VICTIM LOGIC ======================\n"]]},{"start1":2598,"length1":47,"diffs":[[1,""]]},{"start1":2775,"length1":48,"diffs":[[1,"        }\n        else if (z > 200 && isDistressMode) {\n"]]},{"start1":2867,"length1":1,"diffs":[[1,""]]},{"start1":3022,"length1":64,"diffs":[[1,"    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xff0000);\n"]]},{"start1":3115,"length1":32,"diffs":[[1,"    // Send initial ALERT with my ID\n"]]},{"start1":3194,"length1":50,"diffs":[[1,"    // Continuous BEACON & sound\n"]]},{"start1":3390,"length1":0,"diffs":[[1,"\n            // Occasionally repeat ALERT (if no ACK yet, optional)\n"]]},{"start1":3561,"length1":32,"diffs":[[1,"    // Tell rescuers to stop\n"]]},{"start1":3699,"length1":46,"diffs":[[1,"// === 3. RESCUER LOGIC (HYBRID TIER 3) =====\n"]]},{"start1":3848,"length1":51,"diffs":[[1,"    // Send ACK ONCE to that victim to say: \"I got your alert\"\n"]]},{"start1":4035,"length1":67,"diffs":[[1,"    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xffff00);\n"]]},{"start1":4153,"length1":47,"diffs":[[1,"    // Adjust weights based on initial RSSI (if any)\n"]]},{"start1":4270,"length1":32,"diffs":[[1,""]]},{"start1":4328,"length1":48,"diffs":[[1,""]]},{"start1":4380,"length1":170,"diffs":[[1,"    // STEP 1: SCAN\n    let leftScore = scanDirection(-35, 35);\n    basic.pause(200);\n    let rightScore = scanDirection(35, -35);\n    basic.pause(200);\n"]]},{"start1":4534,"length1":66,"diffs":[[1,"    if (leftScore > rightScore) {\n        cuteBot.motors(-35, 35);\n        basic.pause(400);\n    } else {\n        cuteBot.motors(35, -35);\n        basic.pause(400);\n    }\n    cuteBot.stopcar();\n\n    // STEP 2: APPROACH\n    driveToTarget();\n\n    resetSystem();\n}\n\nfunction driveToTarget() {\n    const startTime = input.runningTime();\n    cuteBot.motors(25, 25);\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x0000ff);\n\n    while (input.runningTime() - startTime < MAX_SEARCH_TIME) {\n"]]},{"start1":5047,"length1":67,"diffs":[[1,""]]},{"start1":5155,"length1":70,"diffs":[[1,"        // Found: strong radio + strong sound\n"]]},{"start1":5388,"length1":94,"diffs":[[1,"        // Strong radio but weak sound → local rescan\n        if (currentRSSI > RSSI_ARRIVED_THRESH && soundNow < SOUND_THRESHOLD) {\n            cuteBot.stopcar();\n"]]},{"start1":5553,"length1":156,"diffs":[[1,"            W_SOUND = 0.8;\n            W_RSSI = 0.2;\n"]]},{"start1":5607,"length1":243,"diffs":[[1,"            const leftScoreLocal = scanDirection(-35, 35);\n            basic.pause(150);\n            const rightScoreLocal = scanDirection(35, -35);\n            basic.pause(150);\n"]]},{"start1":5787,"length1":62,"diffs":[[1,"            if (leftScoreLocal > rightScoreLocal) {\n                cuteBot.motors(-35, 35);\n                basic.pause(300);\n            } else {\n                cuteBot.motors(35, -35);\n                basic.pause(300);\n            }\n"]]},{"start1":6025,"length1":62,"diffs":[[1,"            cuteBot.motors(25, 25);\n        }\n\n        // Lost both radio & sound\n"]]},{"start1":6199,"length1":0,"diffs":[[1,"\n        basic.pause(50);\n"]]},{"start1":6255,"length1":19,"diffs":[[1,""]]},{"start1":6258,"length1":413,"diffs":[[1,"function missionSuccess() {\n"]]},{"start1":6309,"length1":22,"diffs":[[1,""]]},{"start1":6310,"length1":162,"diffs":[[1,"    if (input.soundLevel() < SOUND_THRESHOLD) {\n        // Possibly false positive: back off & re-run rescue once\n        cuteBot.motors(-25, -25);\n        basic.pause(400);\n        cuteBot.stopcar();\n        if (!isDistressMode) {\n            startRescueRoutine();\n        }\n        return;\n    }\n"]]},{"start1":6609,"length1":121,"diffs":[[1,"    for (let i = 0; i < 3; i++) {\n        cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00);\n        basic.showIcon(IconNames.Heart);\n"]]},{"start1":6771,"length1":68,"diffs":[[1,"        cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x000000);\n"]]},{"start1":6864,"length1":23,"diffs":[[1,"}\n"]]},{"start1":6867,"length1":177,"diffs":[[1,""]]},{"start1":6868,"length1":82,"diffs":[[1,"// ==========================================\n// === 4. HELPERS ===========================\n// ==========================================\n"]]},{"start1":7007,"length1":0,"diffs":[[1,"function scanDirection(leftSpeed: number, rightSpeed: number): number {\n    cuteBot.motors(leftSpeed, rightSpeed);\n"]]},{"start1":7123,"length1":102,"diffs":[[1,""]]},{"start1":7169,"length1":36,"diffs":[[1,""]]},{"start1":7170,"length1":52,"diffs":[[1,"    const t0 = input.runningTime();\n    while (input.runningTime() - t0 < 600) {\n"]]},{"start1":7416,"length1":0,"diffs":[[1,"    cuteBot.stopcar();\n"]]},{"start1":7769,"length1":782,"diffs":[[1,""]]},{"start1":7933,"length1":66,"diffs":[[1,"    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00);\n"]]}]}]},{"timestamp":1764919140001,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":2048,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"ui_v#(LiVdUYoxcu-N]^\">isDistressMode</variable><variable id=\"zlDJMb`bqGL:5t]QAzUB\">incomingRSSI</variable><variable id=\"IEvilFV;3G]]6#F3*7xF\">isRescuing</variable><variable id=\"1C8$((J};8Gr!Wi)|W~S\">targetId</variable><variable id=\"qjdnJMqdtx-=sfU0HY,+\">currentRSSI</variable><variable id=\"r7/[NqFA}a2,4~SFEBsO\">lastBeaconTime</variable><variable id=\"u%(sM?7:,z{}_]+Gbezu\">z</variable><variable id=\"F=X:e}@H.K_5GlLXZ|$!\">MY_SERIAL</variable><variable id=\"n;pnR2n4}V@_]e)bT!l!\">initialRssi</variable><variable id=\"-!iCE#1l{haTP+,,-e.%\">W_SOUND</variable><variable id=\"m69)LonS1x*~f73Tf,sT\">W_RSSI</variable><variable id=\":)%d^D]R3%3LKK5Xz+Jy\">leftScore</variable><variable id=\"8.$I.|/Iz/:+1wO+v;%c\">rightScore</variable><variable id=\"0nuGWw+zr*8U6#PKHml#\">startTime</variable><variable id=\"nsA:vcU`YIlc1=n5L$y[\">MAX_SEARCH_TIME</variable><variable id=\"P:j*9xCv49OfdbgMN^Y!\">soundNow</variable><variable id=\"z^4mtKq#O[*8.uyH?}=J\">RSSI_ARRIVED_THRESH</variable><variable id=\"^p%.II?v@GY]@GIq6GUY\">SOUND_THRESHOLD</variable><variable id=\"VA?Q2eJ=x28:dd_DFdx}\">leftScoreLocal</variable><variable id=\"s#Vcm[czGDv{vmNeE:hm\">rightScoreLocal</variable><variable id=\"Zd3rp]I+:#oC@j^^-;QE\">maxRssi</variable><variable id=\"XIsjbV!K=|bjKWF%MIJ=\">t0</variable><variable id=\"Z*_2N8?%Ce+H;9iegPom\">s</variable><variable id=\"i[,-Hn^qY%$L?hYwF{57\">maxSound</variable><variable id=\"d~eso0tGXpCulaLktbCt\">normSound</variable><variable id=\"wJ:5!-c%?$Qr3un{ku[v\">normRssi</variable><variable id=\"MFi6{,X9GO|()L$3zO*w\">RADIO_GROUP</variable></variables><comment x=\"0\" y=\"0\" w=\"420\" h=\"120\">\n"]]},{"start1":1691,"length1":43,"diffs":[[1,""]]},{"start1":1829,"length1":58292,"diffs":[[1,"</comment><comment x=\"0\" y=\"0\" w=\"350\" h=\"120\">\nAm I currently looking for someone?\n</comment><comment x=\"0\" y=\"0\" w=\"160\" h=\"120\">\nTrack the target\n</comment><block type=\"control_in_background\" x=\"10\" y=\"10\"><comment pinned=\"false\" h=\"80\" w=\"160\">Monitor orientation in background (fast reaction)</comment><data>1</data><statement name=\"HANDLER\"><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"u%(sM?7:,z{}_]+Gbezu\">z</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_acceleration\"><field name=\"NAME\">Dimension.Z</field></block></value><next><block type=\"controls_if\"><mutation elseif=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Flip detected (upside down) -&gt; become victim\nFlipped back up -&gt; become safe</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"u%(sM?7:,z{}_]+Gbezu\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-600</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ui_v#(LiVdUYoxcu-N]^\">isDistressMode</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"becomeVictim\" functionid=\"0gZ-.)VwV)~rp-1M[KYc\"></mutation></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"u%(sM?7:,z{}_]+Gbezu\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ui_v#(LiVdUYoxcu-N]^\">isDistressMode</field></block></value></block></value><statement name=\"DO1\"><block type=\"function_call\"><mutation name=\"becomeSafe\" functionid=\"B?skx+Vp)CU`2tsDpFe.\"></mutation></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value></block></next></block></next></block></statement></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"becomeVictim\" functionid=\"0gZ-.)VwV)~rp-1M[KYc\"></mutation><field name=\"function_name\">becomeVictim</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"ui_v#(LiVdUYoxcu-N]^\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"IEvilFV;3G]]6#F3*7xF\">isRescuing</field><comment pinned=\"false\" h=\"80\" w=\"160\">Stop everything else</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"cutebot_stopcar\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">Visuals\nRED</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xff0000</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"radio_datagram_send_value\"><comment pinned=\"false\" h=\"80\" w=\"160\">RADIO: send initial ALERT</comment><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">ALERT</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"F=X:e}@H.K_5GlLXZ|$!\">MY_SERIAL</field></block></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        while (isDistressMode) {\" line2=\"            // 1. Send BEACON (for others to track RSSI)\" line3=\"            radio.sendValue(&quot;BEACON&quot;, MY_SERIAL);\" line4=\"\" line5=\"            // 2. Make noise\" line6=\"            soundExpression.sad.play();\" line7=\"\" line8=\"            // 3. Occasionally re-send ALERT (in case rescuers missed it)\" line9=\"            if (Math.randomBoolean()) {\" line10=\"                radio.sendValue(&quot;ALERT&quot;, MY_SERIAL);\" line11=\"            }\" line12=\"\" line13=\"            basic.pause(500); // Pulse every 0.5s\" line14=\"        }\" line15=\"    });\" numlines=\"16\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"becomeSafe\" functionid=\"B?skx+Vp)CU`2tsDpFe.\"></mutation><field name=\"function_name\">becomeSafe</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"ui_v#(LiVdUYoxcu-N]^\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"radio_datagram_send_value\"><comment pinned=\"false\" h=\"80\" w=\"160\">Tell rescuers to stop</comment><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">SAFE</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"F=X:e}@H.K_5GlLXZ|$!\">MY_SERIAL</field></block></value><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"MgT.0jOT[.5Xk{YFSz6h\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"startRescueRoutine\" functionid=\"Lzc1@xZ`[vAWrdI1sRS4\"></mutation><field name=\"function_name\">startRescueRoutine</field><data>2</data><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"IEvilFV;3G]]6#F3*7xF\">isRescuing</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">Acknowledge phase\nYELLOW</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xffff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Target</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">Listen briefly to get initial RSSI</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"n;pnR2n4}V@_]e)bT!l!\">initialRssi</field><comment pinned=\"false\" h=\"80\" w=\"160\">Dynamically adjust weights based on how strong initial RSSI is</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qjdnJMqdtx-=sfU0HY,+\">currentRSSI</field></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"n;pnR2n4}V@_]e)bT!l!\">initialRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-70</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"-!iCE#1l{haTP+,,-e.%\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Already close -&gt; trust sound more for scan</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.8</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m69)LonS1x*~f73Tf,sT\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.2</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"variables_set\"><field name=\"VAR\" id=\"-!iCE#1l{haTP+,,-e.%\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Far away -&gt; trust radio more for scan</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.4</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m69)LonS1x*~f73Tf,sT\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.6</field></shadow></value></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\":)%d^D]R3%3LKK5Xz+Jy\">leftScore</field><comment pinned=\"false\" h=\"80\" w=\"160\">--- STEP 1: SCAN (Left vs Right using hybrid score) ---\nTurn left</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanDirection\" functionid=\"R7A2%,_6vnkV3@fUU^Ga\"><arg name=\"leftSpeed\" id=\"r7kzvdd8w2e7v3ur1w0zx6\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"iohu5q8vtnu18bhswzdsi\" type=\"number\"></arg></mutation><value name=\"r7kzvdd8w2e7v3ur1w0zx6\"><shadow type=\"math_number\"><field name=\"NUM\">-35</field></shadow></value><value name=\"iohu5q8vtnu18bhswzdsi\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"8.$I.|/Iz/:+1wO+v;%c\">rightScore</field><comment pinned=\"false\" h=\"80\" w=\"160\">Turn right</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanDirection\" functionid=\"R7A2%,_6vnkV3@fUU^Ga\"><arg name=\"leftSpeed\" id=\"r7kzvdd8w2e7v3ur1w0zx6\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"iohu5q8vtnu18bhswzdsi\" type=\"number\"></arg></mutation><value name=\"r7kzvdd8w2e7v3ur1w0zx6\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value><value name=\"iohu5q8vtnu18bhswzdsi\"><shadow type=\"math_number\"><field name=\"NUM\">-35</field></shadow></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Turn towards the better scored direction</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":)%d^D]R3%3LKK5Xz+Jy\">leftScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"8.$I.|/Iz/:+1wO+v;%c\">rightScore</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Turn left</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-35</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">35</field></shadow></value><next><block type=\"device_pause\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">400</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Turn right</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">35</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-35</field></shadow></value><next><block type=\"device_pause\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">400</field></shadow></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"driveToTarget\" functionid=\"nYlXt]Ap9|EVV-K)LHM;\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">--- STEP 2: APPROACH (Hybrid: radio + sound) ---</comment><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"MgT.0jOT[.5Xk{YFSz6h\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Done (either success or timeout)</comment></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"driveToTarget\" functionid=\"nYlXt]Ap9|EVV-K)LHM;\"></mutation><field name=\"function_name\">driveToTarget</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"0nuGWw+zr*8U6#PKHml#\">startTime</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Slow approach</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">25</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">25</field></shadow></value><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">BLUE (Driving)</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x0000ff</field></shadow></value><next><block type=\"device_while\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"0nuGWw+zr*8U6#PKHml#\">startTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"nsA:vcU`YIlc1=n5L$y[\">MAX_SEARCH_TIME</field></block></value></block></value><statement name=\"DO\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Safety: if I accidentally flip while driving, stop immediately &amp; become victim</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ui_v#(LiVdUYoxcu-N]^\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"P:j*9xCv49OfdbgMN^Y!\">soundNow</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">CHECK 1: Are we there yet? (strong radio + strong sound)</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qjdnJMqdtx-=sfU0HY,+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"z^4mtKq#O[*8.uyH?}=J\">RSSI_ARRIVED_THRESH</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">NEQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qjdnJMqdtx-=sfU0HY,+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"P:j*9xCv49OfdbgMN^Y!\">soundNow</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^p%.II?v@GY]@GIq6GUY\">SOUND_THRESHOLD</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"missionSuccess\" functionid=\"/UY2_Rt!6CoDjAGyR0=M\"></mutation><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">CHECK 2: Radio says \"very close\" but sound is low -&gt; do a local rescan</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qjdnJMqdtx-=sfU0HY,+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"z^4mtKq#O[*8.uyH?}=J\">RSSI_ARRIVED_THRESH</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"P:j*9xCv49OfdbgMN^Y!\">soundNow</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^p%.II?v@GY]@GIq6GUY\">SOUND_THRESHOLD</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><next><block type=\"variables_set\"><field name=\"VAR\" id=\"-!iCE#1l{haTP+,,-e.%\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Local small re-scan, giving sound more weight now</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.8</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m69)LonS1x*~f73Tf,sT\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"VA?Q2eJ=x28:dd_DFdx}\">leftScoreLocal</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanDirection\" functionid=\"R7A2%,_6vnkV3@fUU^Ga\"><arg name=\"leftSpeed\" id=\"r7kzvdd8w2e7v3ur1w0zx6\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"iohu5q8vtnu18bhswzdsi\" type=\"number\"></arg></mutation><value name=\"r7kzvdd8w2e7v3ur1w0zx6\"><shadow type=\"math_number\"><field name=\"NUM\">-35</field></shadow></value><value name=\"iohu5q8vtnu18bhswzdsi\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">150</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"s#Vcm[czGDv{vmNeE:hm\">rightScoreLocal</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanDirection\" functionid=\"R7A2%,_6vnkV3@fUU^Ga\"><arg name=\"leftSpeed\" id=\"r7kzvdd8w2e7v3ur1w0zx6\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"iohu5q8vtnu18bhswzdsi\" type=\"number\"></arg></mutation><value name=\"r7kzvdd8w2e7v3ur1w0zx6\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value><value name=\"iohu5q8vtnu18bhswzdsi\"><shadow type=\"math_number\"><field name=\"NUM\">-35</field></shadow></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">150</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"VA?Q2eJ=x28:dd_DFdx}\">leftScoreLocal</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"s#Vcm[czGDv{vmNeE:hm\">rightScoreLocal</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-35</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">35</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">300</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">35</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-35</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">300</field></shadow></value></block></next></block></statement><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Resume forward motion</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">25</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">25</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">CHECK 3: If both radio &amp; sound are very weak, assume we lost the trail</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qjdnJMqdtx-=sfU0HY,+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-90</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"P:j*9xCv49OfdbgMN^Y!\">soundNow</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^p%.II?v@GY]@GIq6GUY\">SOUND_THRESHOLD</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"break_keyword\"></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"missionSuccess\" functionid=\"/UY2_Rt!6CoDjAGyR0=M\"></mutation><field name=\"function_name\">missionSuccess</field><statement name=\"STACK\"><block type=\"cutebot_stopcar\"><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Extra confirmation step:\nIf sound isn't loud enough here, we might be fooled by multipath RSSI.</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^p%.II?v@GY]@GIq6GUY\">SOUND_THRESHOLD</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Back off slightly and try again with a fresh rescue routine</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-25</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-25</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">400</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"startRescueRoutine\" functionid=\"Lzc1@xZ`[vAWrdI1sRS4\"></mutation><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></next></block></next></block></next></block></statement><next><block type=\"controls_repeat_ext\"><comment pinned=\"false\" h=\"80\" w=\"160\">Victory dance</comment><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">3</field></shadow></value><statement name=\"DO\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">GREEN</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">OFF</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x000000</field></shadow></value><next><block type=\"device_pause\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"scanDirection\" functionid=\"R7A2%,_6vnkV3@fUU^Ga\"><arg name=\"leftSpeed\" id=\"r7kzvdd8w2e7v3ur1w0zx6\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"iohu5q8vtnu18bhswzdsi\" type=\"number\"></arg></mutation><field name=\"function_name\">scanDirection</field><comment pinned=\"false\" h=\"80\" w=\"160\">Turns robot, records max volume and signal, returns a hybrid score</comment><data>3</data><value name=\"r7kzvdd8w2e7v3ur1w0zx6\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">leftSpeed</field></block></value><value name=\"iohu5q8vtnu18bhswzdsi\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">rightSpeed</field></block></value><statement name=\"STACK\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">leftSpeed</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rightSpeed</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Zd3rp]I+:#oC@j^^-;QE\">maxRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"XIsjbV!K=|bjKWF%MIJ=\">t0</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><comment pinned=\"false\" h=\"80\" w=\"160\">Scan for 600 ms</comment><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"XIsjbV!K=|bjKWF%MIJ=\">t0</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">600</field></shadow></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Z*_2N8?%Ce+H;9iegPom\">s</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Z*_2N8?%Ce+H;9iegPom\">s</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i[,-Hn^qY%$L?hYwF{57\">maxSound</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"i[,-Hn^qY%$L?hYwF{57\">maxSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Z*_2N8?%Ce+H;9iegPom\">s</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qjdnJMqdtx-=sfU0HY,+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Zd3rp]I+:#oC@j^^-;QE\">maxRssi</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Zd3rp]I+:#oC@j^^-;QE\">maxRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qjdnJMqdtx-=sfU0HY,+\">currentRSSI</field></block></value></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"variables_set\"><field name=\"VAR\" id=\"d~eso0tGXpCulaLktbCt\">normSound</field><comment pinned=\"false\" h=\"80\" w=\"160\">Normalize and score:\nSound 0–255 -&gt; 0–100\nRSSI -95 to -40 -&gt; 0–100</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_map\"><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i[,-Hn^qY%$L?hYwF{57\">maxSound</field></block></value><value name=\"fromLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"fromHigh\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value><value name=\"toLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"toHigh\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"wJ:5!-c%?$Qr3un{ku[v\">normRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_map\"><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Zd3rp]I+:#oC@j^^-;QE\">maxRssi</field></block></value><value name=\"fromLow\"><shadow type=\"math_number\"><field name=\"NUM\">-95</field></shadow></value><value name=\"fromHigh\"><shadow type=\"math_number\"><field name=\"NUM\">-40</field></shadow></value><value name=\"toLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"toHigh\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Clamp values into 0–100</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"d~eso0tGXpCulaLktbCt\">normSound</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"d~eso0tGXpCulaLktbCt\">normSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"d~eso0tGXpCulaLktbCt\">normSound</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"d~eso0tGXpCulaLktbCt\">normSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"wJ:5!-c%?$Qr3un{ku[v\">normRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"wJ:5!-c%?$Qr3un{ku[v\">normRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"wJ:5!-c%?$Qr3un{ku[v\">normRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"wJ:5!-c%?$Qr3un{ku[v\">normRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"d~eso0tGXpCulaLktbCt\">normSound</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-!iCE#1l{haTP+,,-e.%\">W_SOUND</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"wJ:5!-c%?$Qr3un{ku[v\">normRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m69)LonS1x*~f73Tf,sT\">W_RSSI</field></block></value></block></value></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"resetSystem\" functionid=\"MgT.0jOT[.5Xk{YFSz6h\"></mutation><field name=\"function_name\">resetSystem</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"IEvilFV;3G]]6#F3*7xF\">isRescuing</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"1C8$((J};8Gr!Wi)|W~S\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"qjdnJMqdtx-=sfU0HY,+\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"smc5OKxZ#]R.o9p?f[y)\"></mutation></block></next></block></next></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let isDistressMode = false\" numlines=\"1\" declaredvars=\"isDistressMode\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== STATE VARIABLES ======\nAm I the victim?</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"MFi6{,X9GO|()L$3zO*w\">RADIO_GROUP</field><data>4</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">17</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"F=X:e}@H.K_5GlLXZ|$!\">MY_SERIAL</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_device_serial_number\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"^p%.II?v@GY]@GIq6GUY\">SOUND_THRESHOLD</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== TUNING CONSTANTS ======\nHow loud to be considered \"crying\"</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">60</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"z^4mtKq#O[*8.uyH?}=J\">RSSI_ARRIVED_THRESH</field><comment pinned=\"false\" h=\"80\" w=\"160\">Signal strength indicating we are VERY close</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-55</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"nsA:vcU`YIlc1=n5L$y[\">MAX_SEARCH_TIME</field><comment pinned=\"false\" h=\"80\" w=\"160\">Give up after 6 seconds if not found</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">6000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"-!iCE#1l{haTP+,,-e.%\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Default weights for decision (Sound vs Radio)\nThese will be adjusted dynamically in startRescueRoutine()</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m69)LonS1x*~f73Tf,sT\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.3</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"qjdnJMqdtx-=sfU0HY,+\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value><next><block type=\"radio_set_group\"><comment pinned=\"false\" h=\"80\" w=\"160\">Initial setup</comment><value name=\"ID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"255\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"MFi6{,X9GO|()L$3zO*w\">RADIO_GROUP</field></block></value><next><block type=\"radio_set_transmit_power\"><comment pinned=\"false\" h=\"80\" w=\"160\">Max power</comment><value name=\"power\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"7\" precision=\"0\"></mutation><field name=\"SLIDER\">7</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"smc5OKxZ#]R.o9p?f[y)\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"radio_on_value_drag\" x=\"2293\" y=\"20\"><data>0</data><value name=\"HANDLER_DRAG_PARAM_name\"><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"HANDLER_DRAG_PARAM_value\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">If I am the victim, I ignore all radio input.</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ui_v#(LiVdUYoxcu-N]^\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"return;\" numlines=\"1\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"zlDJMb`bqGL:5t]QAzUB\">incomingRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"radio_received_packet\"><value name=\"type\"><shadow type=\"radio_packet_property\"><field name=\"note\">RadioPacketProperty.SignalStrength</field></shadow></value></block></value><next><block type=\"controls_if\"><mutation elseif=\"2\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">ALERT</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Only start rescue if I'm not already busy</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"IEvilFV;3G]]6#F3*7xF\">isRescuing</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"1C8$((J};8Gr!Wi)|W~S\">targetId</field><comment pinned=\"false\" h=\"80\" w=\"160\">Lock onto this specific ID</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><next><block type=\"function_call\"><mutation name=\"startRescueRoutine\" functionid=\"Lzc1@xZ`[vAWrdI1sRS4\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></statement></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">BEACON</field></block></value></block></value><statement name=\"DO1\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Only listen to the robot I am tracking</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"1C8$((J};8Gr!Wi)|W~S\">targetId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"1C8$((J};8Gr!Wi)|W~S\">targetId</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qjdnJMqdtx-=sfU0HY,+\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"zlDJMb`bqGL:5t]QAzUB\">incomingRSSI</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"r7/[NqFA}a2,4~SFEBsO\">lastBeaconTime</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></statement></block></statement><value name=\"IF2\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">SAFE</field></block></value></block></value><statement name=\"DO2\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Victim is safe, reset everything</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"1C8$((J};8Gr!Wi)|W~S\">targetId</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"MgT.0jOT[.5Xk{YFSz6h\"></mutation></block></statement></block></statement></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"3164\" y=\"20\"><mutation name=\"calmLights\" functionid=\"smc5OKxZ#]R.o9p?f[y)\"></mutation><field name=\"function_name\">calmLights</field><statement name=\"STACK\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">GREEN</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></statement></block></xml>"]]}]}]},{"timestamp":1764919150113,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":31,"diffs":[[1,"// ==========================================\n// ====== CONFIGURATION & CONSTANTS =========\n// ==========================================\n\n"]]},{"start1":246,"length1":224,"diffs":[[1,"const SOUND_THRESHOLD = 60;       // How loud to be considered \"crying\"\nconst RSSI_ARRIVED_THRESH = -55;  // Strong signal => very close\nconst MAX_SEARCH_TIME = 8000;     // Max search time (ms)\n"]]},{"start1":442,"length1":82,"diffs":[[1,"// Default weights for decision (Sound vs Radio)\nlet W_SOUND = 0.7;\nlet W_RSSI = 0.3;\n"]]},{"start1":562,"length1":111,"diffs":[[1,"let isDistressMode = false;   // Am I the victim?\nlet isRescuing = false;       // Am I currently searching?\nlet hasAckedVictim = false;   // Have I ACKed this victim?\n"]]},{"start1":731,"length1":86,"diffs":[[1,"let targetId = 0;             // Victim ID I'm rescuing\nlet currentRSSI = -100;       // Latest RSSI from target\nlet lastBeaconTime = 0;       // Last time we heard BEACON\n"]]},{"start1":904,"length1":9,"diffs":[[1,"// ==========================================\n// ====== INITIAL SETUP =====================\n// ==========================================\n\n"]]},{"start1":1072,"length1":40,"diffs":[[1,"radio.setTransmitPower(7);\n"]]},{"start1":1114,"length1":0,"diffs":[[1,"\n"]]},{"start1":1161,"length1":45,"diffs":[[1,"// ====== 1. RADIO HANDLER ==================\n"]]},{"start1":1253,"length1":0,"diffs":[[1,"\n"]]},{"start1":1317,"length1":141,"diffs":[[1,"    const incomingRSSI = radio.receivedPacket(RadioPacketProperty.SignalStrength);\n\n    // Ignore my own packets by ID (avoid self-trigger)\n    if (value == MY_SERIAL) {\n"]]},{"start1":1510,"length1":115,"diffs":[[1,""]]},{"start1":1537,"length1":184,"diffs":[[1,"        // Victim must not react to alerts (it IS the one in trouble)\n        if (isDistressMode) return;\n\n        // If already rescuing someone, ignore new alerts\n        if (isRescuing) return;\n\n        // Become rescuer for this victim\n        targetId = value;\n        hasAckedVictim = false;\n        startRescueRoutine();\n"]]},{"start1":1904,"length1":100,"diffs":[[1,"        // Only track BEACON from the victim I'm rescuing\n        if (!isDistressMode && (targetId == 0 || value == targetId)) {\n"]]},{"start1":2170,"length1":77,"diffs":[[1,"        // Victim says it is safe; rescuer stops\n        if (!isDistressMode && value == targetId) {\n"]]},{"start1":2314,"length1":0,"diffs":[[1,"    else if (name == \"ACK\") {\n        // Only victim with that ID cares\n        if (isDistressMode && value == MY_SERIAL) {\n            // Rescuer acknowledged; victim just keeps beeping and does NOT become rescuer\n        }\n    }\n"]]},{"start1":2550,"length1":0,"diffs":[[1,"\n"]]},{"start1":2597,"length1":46,"diffs":[[1,"// ====== 2. VICTIM LOGIC ===================\n"]]},{"start1":2690,"length1":53,"diffs":[[1,"// Orientation watcher (flip to become victim)\n"]]},{"start1":2843,"length1":56,"diffs":[[1,""]]},{"start1":2914,"length1":98,"diffs":[[1,"        } else if (z > 200 && isDistressMode) {\n"]]},{"start1":2998,"length1":0,"diffs":[[1,"\n"]]},{"start1":3088,"length1":48,"diffs":[[1,"    isRescuing = false;\n    targetId = 0;\n"]]},{"start1":3154,"length1":15,"diffs":[[1,""]]},{"start1":3254,"length1":33,"diffs":[[1,"    // Initial ALERT with my ID\n"]]},{"start1":3328,"length1":50,"diffs":[[1,"    // Continuous BEACON & sound while distressed\n"]]},{"start1":3451,"length1":57,"diffs":[[1,""]]},{"start1":3501,"length1":30,"diffs":[[1,""]]},{"start1":3541,"length1":233,"diffs":[[1,"            basic.pause(500);\n"]]},{"start1":3644,"length1":65,"diffs":[[1,"    // Tell any rescuer to stop\n    radio.sendValue(\"SAFE\", MY_SERIAL);\n"]]},{"start1":3738,"length1":0,"diffs":[[1,"\n"]]},{"start1":3785,"length1":46,"diffs":[[1,"// ====== 3. RESCUER LOGIC ==================\n"]]},{"start1":3934,"length1":25,"diffs":[[1,"    // Send ACK once to victim: \"I got your alert\"\n    if (!hasAckedVictim && targetId != 0) {\n        radio.sendValue(\"ACK\", targetId);\n        hasAckedVictim = true;\n    }\n\n"]]},{"start1":4214,"length1":65,"diffs":[[1,"    basic.pause(500);\n"]]},{"start1":4237,"length1":384,"diffs":[[1,"    // Set initial weights based on first RSSI\n    let initialRssi = currentRSSI;\n    if (initialRssi > -70) {\n        // Already fairly close\n        W_SOUND = 0.8;\n        W_RSSI = 0.2;\n"]]},{"start1":4438,"length1":73,"diffs":[[1,"        // Far away; trust radio more initially\n        W_SOUND = 0.4;\n        W_RSSI = 0.6;\n"]]},{"start1":4537,"length1":23,"diffs":[[1,""]]},{"start1":4538,"length1":130,"diffs":[[1,"    // Iterative search loop: scan → step → evaluate\n    const searchStart = input.runningTime();\n    let prevRssi = currentRSSI;\n    let prevSound = input.soundLevel();\n"]]},{"start1":4709,"length1":365,"diffs":[[1,"    while (input.runningTime() - searchStart < MAX_SEARCH_TIME) {\n"]]},{"start1":4805,"length1":0,"diffs":[[1,"            // This bot flipped while rescuing; it is now a victim\n"]]},{"start1":4934,"length1":210,"diffs":[[1,"        const soundNow = input.soundLevel();\n\n        // 1) Combined success condition: strong radio + strong sound\n        if (currentRSSI > RSSI_ARRIVED_THRESH\n            && currentRSSI != -100\n            && soundNow > SOUND_THRESHOLD) {\n"]]},{"start1":5237,"length1":355,"diffs":[[1,"        // 2) Perform one local search step (small scan + forward move)\n        stepSearch();\n\n        // 3) Trend check: did both signals get worse?\n        let rssiImproved = currentRSSI > prevRssi;\n        let soundImproved = soundNow > prevSound;\n\n        if (!rssiImproved && !soundImproved) {\n            // Both degraded: back up slightly and re-orient\n            cuteBot.motors(-25, -25);\n            basic.pause(300);\n"]]},{"start1":5696,"length1":230,"diffs":[[1,"            stepSearch();\n"]]},{"start1":5733,"length1":142,"diffs":[[1,"        prevRssi = currentRSSI;\n        prevSound = soundNow;\n\n        // 4) If both are very weak, assume we lost the trail\n        if (currentRSSI < -90 && soundNow < SOUND_THRESHOLD) {\n            break;\n        }\n"]]},{"start1":5956,"length1":0,"diffs":[[1,"\n"]]},{"start1":5980,"length1":0,"diffs":[[1,"    resetSystem();\n"]]},{"start1":6002,"length1":28,"diffs":[[1,"\n// === One search step: small scan left/right + forward burst ===\nfunction stepSearch() {\n    const scanTurnSpeed = 35;\n    const scanDuration = 300;\n\n    // Temporarily equalize weights while orienting\n    let oldWsound = W_SOUND;\n    let oldWrssi = W_RSSI;\n    W_SOUND = 0.5;\n    W_RSSI = 0.5;\n\n    // Scan left\n    cuteBot.motors(-scanTurnSpeed, scanTurnSpeed);\n    let leftScore = sampleScore(scanDuration);\n"]]},{"start1":6438,"length1":166,"diffs":[[1,"    basic.pause(100);\n\n    // Scan right\n    cuteBot.motors(scanTurnSpeed, -scanTurnSpeed);\n    let rightScore = sampleScore(scanDuration);\n    cuteBot.stopcar();\n    basic.pause(100);\n\n    // Turn toward better score\n    if (leftScore > rightScore) {\n        cuteBot.motors(-scanTurnSpeed, scanTurnSpeed);\n"]]},{"start1":6771,"length1":68,"diffs":[[1,"    } else {\n        cuteBot.motors(scanTurnSpeed, -scanTurnSpeed);\n"]]},{"start1":6871,"length1":2,"diffs":[[1,"    cuteBot.stopcar();\n"]]},{"start1":6895,"length1":138,"diffs":[[1,"    // Short forward move\n    cuteBot.motors(30, 30);\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x0000ff); // BLUE while moving\n    basic.pause(400);\n    cuteBot.stopcar();\n"]]},{"start1":7073,"length1":178,"diffs":[[1,"    // Restore previous weights\n    W_SOUND = oldWsound;\n    W_RSSI = oldWrssi;\n}\n"]]},{"start1":7156,"length1":0,"diffs":[[1,"\n// === Sample hybrid score over given duration ===\nfunction sampleScore(durationMs: number): number {\n"]]},{"start1":7305,"length1":1,"diffs":[[1,""]]},{"start1":7341,"length1":67,"diffs":[[1,"\n    while (input.runningTime() - t0 < durationMs) {\n"]]},{"start1":7559,"length1":23,"diffs":[[1,""]]},{"start1":7560,"length1":87,"diffs":[[1,""]]},{"start1":7673,"length1":0,"diffs":[[1,"    if (normSound < 0) normSound = 0;\n    if (normSound > 100) normSound = 100;\n    if (normRssi < 0) normRssi = 0;\n    if (normRssi > 100) normRssi = 100;\n\n"]]},{"start1":7889,"length1":0,"diffs":[[1,"\nfunction missionSuccess() {\n    cuteBot.stopcar();\n\n    // Extra sanity check on sound: if too low, back off & retry once\n    if (input.soundLevel() < SOUND_THRESHOLD) {\n        cuteBot.motors(-25, -25);\n        basic.pause(400);\n        cuteBot.stopcar();\n        if (!isDistressMode) {\n            startRescueRoutine();\n        }\n        return;\n    }\n\n    for (let i = 0; i < 3; i++) {\n        cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00); // GREEN\n        basic.showIcon(IconNames.Heart);\n        basic.pause(200);\n        cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x000000);\n        basic.pause(200);\n    }\n    resetSystem();\n}\n\n\n// ==========================================\n// ====== 4. HELPERS ========================\n// ==========================================\n\n"]]},{"start1":8720,"length1":0,"diffs":[[1,"    hasAckedVictim = false;\n"]]},{"start1":8766,"length1":0,"diffs":[[1,"    currentRSSI = -100;\n"]]},{"start1":8835,"length1":66,"diffs":[[1,"    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00); // GREEN\n"]]},{"start1":8938,"length1":1,"diffs":[[1,"}\n"]]}]}]},{"timestamp":1764919270971,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1412,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"rY``U82f+l}m!$b62n,0\">incomingRSSI</variable><variable id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</variable><variable id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</variable><variable id=\"x)?P!*kQ*btFCrr[F:jz\">isRescuing</variable><variable id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</variable><variable id=\"6+E?:H12lp}B,k]}*Kj:\">hasAckedVictim</variable><variable id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</variable><variable id=\"C$Rj^jNF)qN:9S#0ROt(\">lastBeaconTime</variable><variable id=\"B}DK8L-f:,0di,_h56B=\">z</variable><variable id=\"KG/#g%p_|yTtNn{_l]iv\">initialRssi</variable><variable id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</variable><variable id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</variable><variable id=\"s*ze$Il{!/0n$u+e/Q_1\">searchStart</variable><variable id=\"KplJ~1!rcO~gq4piu7eu\">prevRssi</variable><variable id=\"0|;~!_A|Q=FL)CG*UFYA\">prevSound</variable><variable id=\"b=(_@6G=PnYR@Gy_*5rw\">MAX_SEARCH_TIME</variable><variable id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</variable><variable id=\"NOfOh_x_;r@TSj4lhp-A\">RSSI_ARRIVED_THRESH</variable><variable id=\"y$$%*Q}f7}t.(Z8VkE:+\">SOUND_THRESHOLD</variable><variable id=\"RxfS;;W$NMDzU[?0D^bY\">rssiImproved</variable><variable id=\"CWJ]wl,[LhL.aWzS//C6\">soundImproved</variable><variable id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</variable><variable id=\"I)e)PsW;u?:$:dD;zy5z\">scanDuration</variable><variable id=\"(;Ntaw;-?c+g{8@;{SQI\">oldWsound</variable><variable id=\";de-l)|7%r5b$IeL_:2+\">oldWrssi</variable><variable id=\"A8WAVqg{}1929!R$WQ+s\">leftScore</variable><variable id=\"?WZx!:yJ`H6nk,24SfF2\">rightScore</variable><variable id=\"U.SWQ:ll)GzF@;anb5SR\">maxRssi</variable><variable id=\"]I)L9(zK?]bOg4[ad{%#\">t0</variable><variable id=\"{pDBWA?bYmHA=6ffrZg2\">s</variable><variable id=\"fn5Z~!e9bR`{$7ShN{Fo\">maxSound</variable><variable id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</variable><variable id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</variable><variable id=\"GdA+W9SB6$.oIB$%DF2}\">RADIO_GROUP</variable></variables><comment x=\"0\" y=\"0\" w=\"420\" h=\"120\">\n"]]},{"start1":2091,"length1":40015,"diffs":[[1,"====== 4. HELPERS ========================\n</comment><comment x=\"0\" y=\"0\" w=\"420\" h=\"120\">\n==========================================\n====== CONFIGURATION &amp; CONSTANTS =========\n==========================================\n</comment><comment x=\"0\" y=\"0\" w=\"420\" h=\"160\">\nLast time we heard BEACON\n==========================================\n====== INITIAL SETUP =====================\n==========================================\n</comment><comment x=\"0\" y=\"0\" w=\"250\" h=\"120\">\nAm I currently searching?\n</comment><comment x=\"0\" y=\"0\" w=\"250\" h=\"120\">\nHave I ACKed this victim?\n</comment><block type=\"control_in_background\" x=\"10\" y=\"10\"><comment pinned=\"false\" h=\"80\" w=\"160\">Orientation watcher (flip to become victim)</comment><data>1</data><statement name=\"HANDLER\"><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"B}DK8L-f:,0di,_h56B=\">z</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_acceleration\"><field name=\"NAME\">Dimension.Z</field></block></value><next><block type=\"controls_if\"><mutation elseif=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"B}DK8L-f:,0di,_h56B=\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-600</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"becomeVictim\" functionid=\"b3sU]HaV)sxdn8mVwx}Q\"></mutation></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"B}DK8L-f:,0di,_h56B=\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value></block></value><statement name=\"DO1\"><block type=\"function_call\"><mutation name=\"becomeSafe\" functionid=\"*C}8e`@?jCtA(c)ionVQ\"></mutation></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value></block></next></block></next></block></statement></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"becomeVictim\" functionid=\"b3sU]HaV)sxdn8mVwx}Q\"></mutation><field name=\"function_name\">becomeVictim</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"x)?P!*kQ*btFCrr[F:jz\">isRescuing</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">RED</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xff0000</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"radio_datagram_send_value\"><comment pinned=\"false\" h=\"80\" w=\"160\">Initial ALERT with my ID</comment><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">ALERT</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</field></block></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        while (isDistressMode) {\" line2=\"            radio.sendValue(&quot;BEACON&quot;, MY_SERIAL);\" line3=\"            soundExpression.sad.play();\" line4=\"            basic.pause(500);\" line5=\"        }\" line6=\"    });\" numlines=\"7\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"becomeSafe\" functionid=\"*C}8e`@?jCtA(c)ionVQ\"></mutation><field name=\"function_name\">becomeSafe</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"radio_datagram_send_value\"><comment pinned=\"false\" h=\"80\" w=\"160\">Tell any rescuer to stop</comment><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">SAFE</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</field></block></value><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"cxe$J~zhO#l3VFne!Fqr\"></mutation></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"startRescueRoutine\" functionid=\"L9)+nc5~AGYN$yQM?~Y{\"></mutation><field name=\"function_name\">startRescueRoutine</field><data>2</data><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"x)?P!*kQ*btFCrr[F:jz\">isRescuing</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Send ACK once to victim: \"I got your alert\"</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"6+E?:H12lp}B,k]}*Kj:\">hasAckedVictim</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">NEQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"radio_datagram_send_value\"><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">ACK</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"6+E?:H12lp}B,k]}*Kj:\">hasAckedVictim</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value></block></next></block></statement><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">YELLOW</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xffff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Target</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"KG/#g%p_|yTtNn{_l]iv\">initialRssi</field><comment pinned=\"false\" h=\"80\" w=\"160\">Set initial weights based on first RSSI</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"KG/#g%p_|yTtNn{_l]iv\">initialRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-70</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Already fairly close</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.8</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.2</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"variables_set\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Far away; trust radio more initially</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.4</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.6</field></shadow></value></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"s*ze$Il{!/0n$u+e/Q_1\">searchStart</field><comment pinned=\"false\" h=\"80\" w=\"160\">Iterative search loop: scan → step → evaluate</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"KplJ~1!rcO~gq4piu7eu\">prevRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"0|;~!_A|Q=FL)CG*UFYA\">prevSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"s*ze$Il{!/0n$u+e/Q_1\">searchStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"b=(_@6G=PnYR@Gy_*5rw\">MAX_SEARCH_TIME</field></block></value></block></value><statement name=\"DO\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><comment pinned=\"false\" h=\"80\" w=\"160\">This bot flipped while rescuing; it is now a victim</comment><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">1) Combined success condition: strong radio + strong sound</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"NOfOh_x_;r@TSj4lhp-A\">RSSI_ARRIVED_THRESH</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">NEQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y$$%*Q}f7}t.(Z8VkE:+\">SOUND_THRESHOLD</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"missionSuccess\" functionid=\"{tv0`z@heWwi=K97(MC!\"></mutation><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></statement><next><block type=\"function_call\"><mutation name=\"stepSearch\" functionid=\"z5wSE|_(T|xIs1ILvb6p\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">2) Perform one local search step (small scan + forward move)</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"RxfS;;W$NMDzU[?0D^bY\">rssiImproved</field><comment pinned=\"false\" h=\"80\" w=\"160\">3) Trend check: did both signals get worse?</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"KplJ~1!rcO~gq4piu7eu\">prevRssi</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"CWJ]wl,[LhL.aWzS//C6\">soundImproved</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"0|;~!_A|Q=FL)CG*UFYA\">prevSound</field></block></value></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"RxfS;;W$NMDzU[?0D^bY\">rssiImproved</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"CWJ]wl,[LhL.aWzS//C6\">soundImproved</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Both degraded: back up slightly and re-orient</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-25</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-25</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">300</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"stepSearch\" functionid=\"z5wSE|_(T|xIs1ILvb6p\"></mutation></block></next></block></next></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"KplJ~1!rcO~gq4piu7eu\">prevRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"0|;~!_A|Q=FL)CG*UFYA\">prevSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</field></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">4) If both are very weak, assume we lost the trail</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-90</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y$$%*Q}f7}t.(Z8VkE:+\">SOUND_THRESHOLD</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"break_keyword\"></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"cxe$J~zhO#l3VFne!Fqr\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"stepSearch\" functionid=\"z5wSE|_(T|xIs1ILvb6p\"></mutation><field name=\"function_name\">stepSearch</field><comment pinned=\"false\" h=\"80\" w=\"160\">=== One search step: small scan left/right + forward burst ===</comment><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"I)e)PsW;u?:$:dD;zy5z\">scanDuration</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">300</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"(;Ntaw;-?c+g{8@;{SQI\">oldWsound</field><comment pinned=\"false\" h=\"80\" w=\"160\">Temporarily equalize weights while orienting</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\";de-l)|7%r5b$IeL_:2+\">oldWrssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.5</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.5</field></shadow></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Scan left</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"A8WAVqg{}1929!R$WQ+s\">leftScore</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"sampleScore\" functionid=\"Ur[SWLmDV~N6N|QzF2WP\"><arg name=\"durationMs\" id=\"mx1nu03k9e45djk4nq53\" type=\"number\"></arg></mutation><value name=\"mx1nu03k9e45djk4nq53\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"I)e)PsW;u?:$:dD;zy5z\">scanDuration</field></block></value></block></value><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">100</field></shadow></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Scan right</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"?WZx!:yJ`H6nk,24SfF2\">rightScore</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"sampleScore\" functionid=\"Ur[SWLmDV~N6N|QzF2WP\"><arg name=\"durationMs\" id=\"mx1nu03k9e45djk4nq53\" type=\"number\"></arg></mutation><value name=\"mx1nu03k9e45djk4nq53\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"I)e)PsW;u?:$:dD;zy5z\">scanDuration</field></block></value></block></value><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">100</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Turn toward better score</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"A8WAVqg{}1929!R$WQ+s\">leftScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"?WZx!:yJ`H6nk,24SfF2\">rightScore</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Short forward move</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">30</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">30</field></shadow></value><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">BLUE while moving</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x0000ff</field></shadow></value><next><block type=\"device_pause\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">400</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"variables_set\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Restore previous weights</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"(;Ntaw;-?c+g{8@;{SQI\">oldWsound</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";de-l)|7%r5b$IeL_:2+\">oldWrssi</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"sampleScore\" functionid=\"Ur[SWLmDV~N6N|QzF2WP\"><arg name=\"durationMs\" id=\"mx1nu03k9e45djk4nq53\" type=\"number\"></arg></mutation><field name=\"function_name\">sampleScore</field><comment pinned=\"false\" h=\"80\" w=\"160\">=== Sample hybrid score over given duration ===</comment><value name=\"mx1nu03k9e45djk4nq53\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">durationMs</field></block></value><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"U.SWQ:ll)GzF@;anb5SR\">maxRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"]I)L9(zK?]bOg4[ad{%#\">t0</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"]I)L9(zK?]bOg4[ad{%#\">t0</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">durationMs</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"{pDBWA?bYmHA=6ffrZg2\">s</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{pDBWA?bYmHA=6ffrZg2\">s</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"fn5Z~!e9bR`{$7ShN{Fo\">maxSound</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"fn5Z~!e9bR`{$7ShN{Fo\">maxSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{pDBWA?bYmHA=6ffrZg2\">s</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"U.SWQ:ll)GzF@;anb5SR\">maxRssi</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"U.SWQ:ll)GzF@;anb5SR\">maxRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_map\"><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"fn5Z~!e9bR`{$7ShN{Fo\">maxSound</field></block></value><value name=\"fromLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"fromHigh\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value><value name=\"toLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"toHigh\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_map\"><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"U.SWQ:ll)GzF@;anb5SR\">maxRssi</field></block></value><value name=\"fromLow\"><shadow type=\"math_number\"><field name=\"NUM\">-95</field></shadow></value><value name=\"fromHigh\"><shadow type=\"math_number\"><field name=\"NUM\">-40</field></shadow></value><value name=\"toLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"toHigh\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field></block></value></block></value></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"missionSuccess\" functionid=\"{tv0`z@heWwi=K97(MC!\"></mutation><field name=\"function_name\">missionSuccess</field><statement name=\"STACK\"><block type=\"cutebot_stopcar\"><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Extra sanity check on sound: if too low, back off &amp; retry once</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y$$%*Q}f7}t.(Z8VkE:+\">SOUND_THRESHOLD</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-25</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-25</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">400</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"startRescueRoutine\" functionid=\"L9)+nc5~AGYN$yQM?~Y{\"></mutation></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></next></block></next></block></next></block></statement><next><block type=\"controls_repeat_ext\"><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">3</field></shadow></value><statement name=\"DO\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">GREEN</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x000000</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value></block></next></block></next></block></next></block></next></block></statement><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"cxe$J~zhO#l3VFne!Fqr\"></mutation></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"resetSystem\" functionid=\"cxe$J~zhO#l3VFne!Fqr\"></mutation><field name=\"function_name\">resetSystem</field><data>3</data><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"x)?P!*kQ*btFCrr[F:jz\">isRescuing</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"6+E?:H12lp}B,k]}*Kj:\">hasAckedVictim</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\";LA!V7k=y)l})-mv2?fe\"></mutation></block></next></block></next></block></next></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let isDistressMode = false\" numlines=\"1\" declaredvars=\"isDistressMode\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== STATE VARIABLES ======\nAm I the victim?</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"GdA+W9SB6$.oIB$%DF2}\">RADIO_GROUP</field><data>4</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">17</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_device_serial_number\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"y$$%*Q}f7}t.(Z8VkE:+\">SOUND_THRESHOLD</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== TUNING CONSTANTS ======\nHow loud to be considered \"crying\"</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">60</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"NOfOh_x_;r@TSj4lhp-A\">RSSI_ARRIVED_THRESH</field><comment pinned=\"false\" h=\"80\" w=\"160\">Strong signal =&gt; very close</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-55</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"b=(_@6G=PnYR@Gy_*5rw\">MAX_SEARCH_TIME</field><comment pinned=\"false\" h=\"80\" w=\"160\">Max search time (ms)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">8000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Default weights for decision (Sound vs Radio)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.3</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field><comment pinned=\"false\" h=\"80\" w=\"160\">Victim ID I'm rescuing\nLatest RSSI from target</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value><next><block type=\"radio_set_group\"><data>5</data><value name=\"ID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"255\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"GdA+W9SB6$.oIB$%DF2}\">RADIO_GROUP</field></block></value><next><block type=\"radio_set_transmit_power\"><value name=\"power\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"7\" precision=\"0\"></mutation><field name=\"SLIDER\">7</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\";LA!V7k=y)l})-mv2?fe\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"radio_on_value_drag\" x=\"2293\" y=\"20\"><data>0</data><value name=\"HANDLER_DRAG_PARAM_name\"><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"HANDLER_DRAG_PARAM_value\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"rY``U82f+l}m!$b62n,0\">incomingRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"radio_received_packet\"><value name=\"type\"><shadow type=\"radio_packet_property\"><field name=\"note\">RadioPacketProperty.SignalStrength</field></shadow></value></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Ignore my own packets by ID (avoid self-trigger)</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</field></block></value></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"return;\" numlines=\"1\"></mutation></block></statement><next><block type=\"controls_if\"><mutation elseif=\"3\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">ALERT</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Victim must not react to alerts (it IS the one in trouble)</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"return;\" numlines=\"1\"></mutation></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">If already rescuing someone, ignore new alerts</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"x)?P!*kQ*btFCrr[F:jz\">isRescuing</field></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"return;\" numlines=\"1\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field><comment pinned=\"false\" h=\"80\" w=\"160\">Become rescuer for this victim</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"6+E?:H12lp}B,k]}*Kj:\">hasAckedVictim</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"function_call\"><mutation name=\"startRescueRoutine\" functionid=\"L9)+nc5~AGYN$yQM?~Y{\"></mutation></block></next></block></next></block></next></block></next></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">BEACON</field></block></value></block></value><statement name=\"DO1\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Only track BEACON from the victim I'm rescuing</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field></block></value></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"rY``U82f+l}m!$b62n,0\">incomingRSSI</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"C$Rj^jNF)qN:9S#0ROt(\">lastBeaconTime</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></statement></block></statement><value name=\"IF2\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">SAFE</field></block></value></block></value><statement name=\"DO2\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Victim says it is safe; rescuer stops</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"cxe$J~zhO#l3VFne!Fqr\"></mutation></block></statement></block></statement><value name=\"IF3\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">ACK</field></block></value></block></value><statement name=\"DO3\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Only victim with that ID cares\nRescuer acknowledged; victim just keeps beeping and does NOT become rescuer</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</field></block></value></block></value></block></value></block></statement></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"3164\" y=\"20\"><mutation name=\"calmLights\" functionid=\";LA!V7k=y)l})-mv2?fe\"></mutation><field name=\"function_name\">calmLights</field><statement name=\"STACK\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">GREEN</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":138,"length1":67,"diffs":[[1,"const SOUND_THRESHOLD = 60; // How loud to be considered \"crying\"\n"]]},{"start1":2160,"length1":282,"diffs":[[1,"        // Flip detected (Upside down) -> Become Victim\n        if (z < -600 && !isDistressMode) {\n"]]},{"start1":5273,"length1":0,"diffs":[[1,"        // We allow a small buffer; if it's quiet for just a moment, keep going.\n        // Only stop if quiet for > 1 second.\n"]]},{"start1":5452,"length1":0,"diffs":[[1,"            // If sound is low, maybe rely purely on RSSI?\n            // For now, we pause briefly to listen better.\n"]]},{"start1":5842,"length1":0,"diffs":[[1,"        // Update RSSI for next loop check\n        // (Radio background handler updates 'currentRSSI' automatically)\n"]]},{"start1":7046,"length1":0,"diffs":[[1,"    // Sound 0-255 -> 0-100\n    // RSSI -90 to -40 -> 0-100\n"]]},{"start1":7303,"length1":363,"diffs":[[1,"    isRescuing = false;\n"]]},{"start1":7345,"length1":68,"diffs":[[1,"    calmLights();\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":340,"length1":35,"diffs":[[1,"    \"preferredEditor\": \"tsprj\"\n"]]}]}]},{"timestamp":1764919865830,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1446,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"=%PwH35)(ipy/~{q_btf\">isDistressMode</variable><variable id=\"j3*^at)$h0Oopq:f:{y}\">incomingRSSI</variable><variable id=\".%*bKnz9l`5vVqcM!N/!\">isRescuing</variable><variable id=\"qADY0w@Y8/eh9!gDF|H2\">targetId</variable><variable id=\"@+ic(qraO/1p=[ujB}Yf\">currentRSSI</variable><variable id=\";M%_7Dcfwy2.0z`H7HF(\">lastBeaconTime</variable><variable id=\"IY:j|6b%?NuUe1}LS7P$\">z</variable><variable id=\"]lcxBK-O$|S`MH~0)KAD\">MY_SERIAL</variable><variable id=\"uWJHEUmj]U@mQd;]3i;/\">leftScore</variable><variable id=\"1%;;-}Ex=S^t[[}St,a}\">rightScore</variable><variable id=\";BrGUAWDnvZp+r4dQ]56\">startTime</variable><variable id=\"t4#8zUzrYh9jB0WM4N/a\">MAX_SEARCH_TIME</variable><variable id=\"jdtL.Pi,|y+(^ws#Y`V.\">RSSI_ARRIVED_THRESH</variable><variable id=\"{a9mLF$ypCLp_!:p!D5B\">SOUND_THRESHOLD</variable><variable id=\"snj0Vc:@8?3ir9D]+HqS\">maxRssi</variable><variable id=\"#;TXR=F3iTtG#;scDw@W\">t0</variable><variable id=\"_:BsB*`I]L~,c1aZ9;-k\">s</variable><variable id=\"w9#q{W`%7Uh|^0ZKcUTt\">maxSound</variable><variable id=\"FgH2uZaE.jhV]DmspC:C\">normSound</variable><variable id=\"OMU${s0@@xWufpuqV3:e\">normRssi</variable><variable id=\"44/e4|u7MM[Fc6KgNjFa\">W_SOUND</variable><variable id=\"aVMm*dI9SaxR2-$%%wAD\">W_RSSI</variable><variable id=\"Dvq3xRpRlyTQ061r7$.|\">RADIO_GROUP</variable></variables><comment x=\"0\" y=\"0\" w=\"420\" h=\"120\">\n==========================================\n</comment><comment x=\"0\" y=\"0\" w=\"350\" h=\"120\">\nAm I currently looking for someone?\n</comment><comment x=\"0\" y=\"0\" w=\"160\" h=\"120\">\n"]]},{"start1":1604,"length1":41198,"diffs":[[1,"</comment><block type=\"control_in_background\" x=\"10\" y=\"10\"><comment pinned=\"false\" h=\"80\" w=\"160\">Monitor orientation in background (Fast Reaction)</comment><data>0</data><statement name=\"HANDLER\"><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"IY:j|6b%?NuUe1}LS7P$\">z</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_acceleration\"><field name=\"NAME\">Dimension.Z</field></block></value><next><block type=\"controls_if\"><mutation elseif=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">=== MAJOR FIX HERE ===\nWe added \"&amp;&amp; !isRescuing\"\nIf the robot is driving to save someone, it might bump or shake.\nWe must IGNORE those shakes so it doesn't scream for help itself.\nFlipped back up -&gt; Become Safe</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"IY:j|6b%?NuUe1}LS7P$\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-600</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"=%PwH35)(ipy/~{q_btf\">isDistressMode</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\".%*bKnz9l`5vVqcM!N/!\">isRescuing</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"becomeVictim\" functionid=\"RA=9pHW]~jB]DJ-+`-nR\"></mutation></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"IY:j|6b%?NuUe1}LS7P$\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"=%PwH35)(ipy/~{q_btf\">isDistressMode</field></block></value></block></value><statement name=\"DO1\"><block type=\"function_call\"><mutation name=\"becomeSafe\" functionid=\"AQ0(po|JlXtYseg5x!OD\"></mutation></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value></block></next></block></next></block></statement></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"becomeVictim\" functionid=\"RA=9pHW]~jB]DJ-+`-nR\"></mutation><field name=\"function_name\">becomeVictim</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"=%PwH35)(ipy/~{q_btf\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\".%*bKnz9l`5vVqcM!N/!\">isRescuing</field><comment pinned=\"false\" h=\"80\" w=\"160\">Stop everything else</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"cutebot_stopcar\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">VISUALS\nRED</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xff0000</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"radio_datagram_send_value\"><comment pinned=\"false\" h=\"80\" w=\"160\">RADIO: Send initial Alert</comment><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">ALERT</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]lcxBK-O$|S`MH~0)KAD\">MY_SERIAL</field></block></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        while (isDistressMode) {\" line2=\"            // 1. Send Beacon (for others to track RSSI)\" line3=\"            radio.sendValue(&quot;BEACON&quot;, MY_SERIAL);\" line4=\"\" line5=\"            // 2. Make Noise\" line6=\"            soundExpression.sad.play();\" line7=\"\" line8=\"            // 3. Occasionally re-send ALERT (in case rescuers missed it)\" line9=\"            if (Math.randomBoolean()) {\" line10=\"                radio.sendValue(&quot;ALERT&quot;, MY_SERIAL);\" line11=\"            }\" line12=\"\" line13=\"            basic.pause(500); // Pulse every 0.5s\" line14=\"        }\" line15=\"    });\" numlines=\"16\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"becomeSafe\" functionid=\"AQ0(po|JlXtYseg5x!OD\"></mutation><field name=\"function_name\">becomeSafe</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"=%PwH35)(ipy/~{q_btf\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"radio_datagram_send_value\"><comment pinned=\"false\" h=\"80\" w=\"160\">Tell rescuers to stop</comment><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">SAFE</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]lcxBK-O$|S`MH~0)KAD\">MY_SERIAL</field></block></value><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"Lw9cx)(zRJ?0U5cx`^-/\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"startRescueRoutine\" functionid=\"4HY@3wkBFCS9L1L:O=;I\"></mutation><field name=\"function_name\">startRescueRoutine</field><data>1</data><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\".%*bKnz9l`5vVqcM!N/!\">isRescuing</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">Acknowledge Phase\nYELLOW</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xffff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Target</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">Listen for a moment to get initial RSSI</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"uWJHEUmj]U@mQd;]3i;/\">leftScore</field><comment pinned=\"false\" h=\"80\" w=\"160\">--- STEP 1: SCAN ---\nCompare Left vs Right to find the strongest signal\nTurn Left</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanDirection\" functionid=\"RCC9_~dxWsrWCRRT!9SL\"><arg name=\"leftSpeed\" id=\"k95t34ja4ccbdsdj5eyd1\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"09yvqhckl40gy3zpitjrkf\" type=\"number\"></arg></mutation><value name=\"k95t34ja4ccbdsdj5eyd1\"><shadow type=\"math_number\"><field name=\"NUM\">-35</field></shadow></value><value name=\"09yvqhckl40gy3zpitjrkf\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"1%;;-}Ex=S^t[[}St,a}\">rightScore</field><comment pinned=\"false\" h=\"80\" w=\"160\">Turn Right</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanDirection\" functionid=\"RCC9_~dxWsrWCRRT!9SL\"><arg name=\"leftSpeed\" id=\"k95t34ja4ccbdsdj5eyd1\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"09yvqhckl40gy3zpitjrkf\" type=\"number\"></arg></mutation><value name=\"k95t34ja4ccbdsdj5eyd1\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value><value name=\"09yvqhckl40gy3zpitjrkf\"><shadow type=\"math_number\"><field name=\"NUM\">-35</field></shadow></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Turn towards the winner</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"uWJHEUmj]U@mQd;]3i;/\">leftScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"1%;;-}Ex=S^t[[}St,a}\">rightScore</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Turn Left</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-35</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">35</field></shadow></value><next><block type=\"device_pause\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">400</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Turn Right</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">35</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-35</field></shadow></value><next><block type=\"device_pause\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">400</field></shadow></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"driveToTarget\" functionid=\"gEbeO*(r$YqEr_S?h{h;\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">--- STEP 2: APPROACH (IMPROVED) ---\nDrive until we are VERY close (High RSSI) or it gets quiet</comment><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"Lw9cx)(zRJ?0U5cx`^-/\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Done</comment></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"driveToTarget\" functionid=\"gEbeO*(r$YqEr_S?h{h;\"></mutation><field name=\"function_name\">driveToTarget</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\";BrGUAWDnvZp+r4dQ]56\">startTime</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Slow approach</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">25</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">25</field></shadow></value><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">BLUE (Driving)</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x0000ff</field></shadow></value><next><block type=\"device_while\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";BrGUAWDnvZp+r4dQ]56\">startTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"t4#8zUzrYh9jB0WM4N/a\">MAX_SEARCH_TIME</field></block></value></block></value><statement name=\"DO\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Safety: If I accidentally flip while driving, stop immediately!</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"=%PwH35)(ipy/~{q_btf\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">CHECK 1: Are we there yet? (RSSI is Strong)\n-55 is usually within 10-15cm of the target</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@+ic(qraO/1p=[ujB}Yf\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"jdtL.Pi,|y+(^ws#Y`V.\">RSSI_ARRIVED_THRESH</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">NEQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@+ic(qraO/1p=[ujB}Yf\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"missionSuccess\" functionid=\"okKszPNnC^l6b2$mX8L5\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">WE FOUND IT!</comment><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">CHECK 2: Is it getting quiet? (Lost the trail)</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{a9mLF$ypCLp_!:p!D5B\">SOUND_THRESHOLD</field></block></value></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{a9mLF$ypCLp_!:p!D5B\">SOUND_THRESHOLD</field></block></value></block></value><statement name=\"DO0\"><block type=\"break_keyword\"><comment pinned=\"false\" h=\"80\" w=\"160\">Still quiet? Maybe we arrived or lost it.</comment></block></statement><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Resume</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">25</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">25</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"missionSuccess\" functionid=\"okKszPNnC^l6b2$mX8L5\"></mutation><field name=\"function_name\">missionSuccess</field><statement name=\"STACK\"><block type=\"cutebot_stopcar\"><next><block type=\"controls_repeat_ext\"><comment pinned=\"false\" h=\"80\" w=\"160\">Victory Dance</comment><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">3</field></shadow></value><statement name=\"DO\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">GREEN</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">OFF</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x000000</field></shadow></value><next><block type=\"device_pause\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"scanDirection\" functionid=\"RCC9_~dxWsrWCRRT!9SL\"><arg name=\"leftSpeed\" id=\"k95t34ja4ccbdsdj5eyd1\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"09yvqhckl40gy3zpitjrkf\" type=\"number\"></arg></mutation><field name=\"function_name\">scanDirection</field><comment pinned=\"false\" h=\"80\" w=\"160\">Turns robot, records max volume and signal, returns a Score</comment><data>2</data><value name=\"k95t34ja4ccbdsdj5eyd1\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">leftSpeed</field></block></value><value name=\"09yvqhckl40gy3zpitjrkf\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">rightSpeed</field></block></value><statement name=\"STACK\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">leftSpeed</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rightSpeed</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"snj0Vc:@8?3ir9D]+HqS\">maxRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"#;TXR=F3iTtG#;scDw@W\">t0</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><comment pinned=\"false\" h=\"80\" w=\"160\">Scan for 600ms</comment><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"#;TXR=F3iTtG#;scDw@W\">t0</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">600</field></shadow></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"_:BsB*`I]L~,c1aZ9;-k\">s</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"_:BsB*`I]L~,c1aZ9;-k\">s</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"w9#q{W`%7Uh|^0ZKcUTt\">maxSound</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"w9#q{W`%7Uh|^0ZKcUTt\">maxSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"_:BsB*`I]L~,c1aZ9;-k\">s</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@+ic(qraO/1p=[ujB}Yf\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"snj0Vc:@8?3ir9D]+HqS\">maxRssi</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"snj0Vc:@8?3ir9D]+HqS\">maxRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@+ic(qraO/1p=[ujB}Yf\">currentRSSI</field></block></value></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"variables_set\"><field name=\"VAR\" id=\"FgH2uZaE.jhV]DmspC:C\">normSound</field><comment pinned=\"false\" h=\"80\" w=\"160\">Normalize and Score</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_map\"><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"w9#q{W`%7Uh|^0ZKcUTt\">maxSound</field></block></value><value name=\"fromLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"fromHigh\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value><value name=\"toLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"toHigh\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"OMU${s0@@xWufpuqV3:e\">normRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_map\"><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"snj0Vc:@8?3ir9D]+HqS\">maxRssi</field></block></value><value name=\"fromLow\"><shadow type=\"math_number\"><field name=\"NUM\">-95</field></shadow></value><value name=\"fromHigh\"><shadow type=\"math_number\"><field name=\"NUM\">-40</field></shadow></value><value name=\"toLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"toHigh\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"FgH2uZaE.jhV]DmspC:C\">normSound</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"44/e4|u7MM[Fc6KgNjFa\">W_SOUND</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"OMU${s0@@xWufpuqV3:e\">normRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"aVMm*dI9SaxR2-$%%wAD\">W_RSSI</field></block></value></block></value></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"resetSystem\" functionid=\"Lw9cx)(zRJ?0U5cx`^-/\"></mutation><field name=\"function_name\">resetSystem</field><statement name=\"STACK\"><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\")t)7kB[{;wTppr}kT[^=\"></mutation><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">=== FIX FOR VICTORY DANCE ===\nWe wait 1 full second here. The background thread checks\n\"!isRescuing\". Since we haven't set it to false yet,\nthe background thread stays blocked. This lets the robot\nstop shaking from the dance before we turn the sensors back on.</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"qADY0w@Y8/eh9!gDF|H2\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\".%*bKnz9l`5vVqcM!N/!\">isRescuing</field><comment pinned=\"false\" h=\"80\" w=\"160\">NOW it's safe to listen to gravity again</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value></block></next></block></next></block></next></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let isDistressMode = false\" numlines=\"1\" declaredvars=\"isDistressMode\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== STATE VARIABLES ======\nAm I the victim?</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Dvq3xRpRlyTQ061r7$.|\">RADIO_GROUP</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== CONFIGURATION ======</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">17</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"]lcxBK-O$|S`MH~0)KAD\">MY_SERIAL</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_device_serial_number\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"{a9mLF$ypCLp_!:p!D5B\">SOUND_THRESHOLD</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== TUNING CONSTANTS ======\nHow loud to be considered \"crying\"</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">60</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"jdtL.Pi,|y+(^ws#Y`V.\">RSSI_ARRIVED_THRESH</field><comment pinned=\"false\" h=\"80\" w=\"160\">Signal strength indicating we are VERY close (Stop)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-55</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"t4#8zUzrYh9jB0WM4N/a\">MAX_SEARCH_TIME</field><comment pinned=\"false\" h=\"80\" w=\"160\">Give up after 6 seconds if not found</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">6000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"44/e4|u7MM[Fc6KgNjFa\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Weights for decision (Sound vs Radio)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"aVMm*dI9SaxR2-$%%wAD\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.3</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"@+ic(qraO/1p=[ujB}Yf\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value><next><block type=\"radio_set_group\"><comment pinned=\"false\" h=\"80\" w=\"160\">Setup</comment><value name=\"ID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"255\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Dvq3xRpRlyTQ061r7$.|\">RADIO_GROUP</field></block></value><next><block type=\"radio_set_transmit_power\"><comment pinned=\"false\" h=\"80\" w=\"160\">Max power</comment><value name=\"power\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"7\" precision=\"0\"></mutation><field name=\"SLIDER\">7</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\")t)7kB[{;wTppr}kT[^=\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"radio_on_value_drag\" x=\"2293\" y=\"20\"><comment pinned=\"false\" h=\"80\" w=\"160\">==========================================\n=== 1. RADIO HANDLER (THE \"EARPLUGS\" FIX)\n==========================================</comment><value name=\"HANDLER_DRAG_PARAM_name\"><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"HANDLER_DRAG_PARAM_value\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">CRITICAL FIX: If I am the victim, IGNORE everything.\nI am the one screaming, I cannot rescue anyone.</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"=%PwH35)(ipy/~{q_btf\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"return;\" numlines=\"1\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j3*^at)$h0Oopq:f:{y}\">incomingRSSI</field><comment pinned=\"false\" h=\"80\" w=\"160\">Capture Signal Strength</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"radio_received_packet\"><value name=\"type\"><shadow type=\"radio_packet_property\"><field name=\"note\">RadioPacketProperty.SignalStrength</field></shadow></value></block></value><next><block type=\"controls_if\"><mutation elseif=\"2\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">ALERT</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Only start rescue if I'm not already busy</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\".%*bKnz9l`5vVqcM!N/!\">isRescuing</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qADY0w@Y8/eh9!gDF|H2\">targetId</field><comment pinned=\"false\" h=\"80\" w=\"160\">Lock onto this specific ID</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><next><block type=\"function_call\"><mutation name=\"startRescueRoutine\" functionid=\"4HY@3wkBFCS9L1L:O=;I\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></statement></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">BEACON</field></block></value></block></value><statement name=\"DO1\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Only listen to the robot I am tracking</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qADY0w@Y8/eh9!gDF|H2\">targetId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qADY0w@Y8/eh9!gDF|H2\">targetId</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"@+ic(qraO/1p=[ujB}Yf\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j3*^at)$h0Oopq:f:{y}\">incomingRSSI</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\";M%_7Dcfwy2.0z`H7HF(\">lastBeaconTime</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></statement></block></statement><value name=\"IF2\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">SAFE</field></block></value></block></value><statement name=\"DO2\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Victim is safe, reset everything</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qADY0w@Y8/eh9!gDF|H2\">targetId</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"Lw9cx)(zRJ?0U5cx`^-/\"></mutation></block></statement></block></statement></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"3164\" y=\"20\"><mutation name=\"calmLights\" functionid=\")t)7kB[{;wTppr}kT[^=\"></mutation><field name=\"function_name\">calmLights</field><statement name=\"STACK\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">Green</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":459,"diffs":[[1,"// ====== CONFIGURATION ======\nconst RADIO_GROUP = 17;\nconst MY_SERIAL = control.deviceSerialNumber();\n\n// ====== TUNING CONSTANTS ======\nconst SOUND_THRESHOLD = 60;  // How loud to be considered \"crying\"\nconst RSSI_ARRIVED_THRESH = -55; // Signal strength indicating we are VERY close (Stop)\nconst MAX_SEARCH_TIME = 6000; // Give up after 6 seconds if not found\n\n// Weights for decision (Sound vs Radio)\nconst W_SOUND = 0.7;\nconst W_RSSI = 0.3;\n\n// ====== STATE VARIABLES ======\nlet isDistressMode = false; // Am I the victim?\nlet isRescuing = false; // Am I currently looking for someone?\n\n// Track the target\nlet targetId = 0;\nlet currentRSSI = -100;\nlet lastBeaconTime = 0;\n\n// Setup\nradio.setGroup(RADIO_GROUP);\nradio.setTransmitPower(7); // Max power\ncalmLights();\n\n// ==========================================\n// === 1. RADIO HANDLER (THE \"EARPLUGS\" FIX)\n// ==========================================\nradio.onReceivedValue(function (name: string, value: number) {\n    // CRITICAL FIX: If I am the victim, IGNORE everything.\n    // I am the one screaming, I cannot rescue anyone.\n    if (isDistressMode) {\n        return;\n    }\n\n    // Capture Signal Strength\n    const incomingRSSI = radio.receivedPacket(RadioPacketProperty.SignalStrength);\n\n    if (name == \"ALERT\") {\n        // Only start rescue if I'm not already busy\n        if (!isRescuing) {\n            targetId = value; // Lock onto this specific ID\n            startRescueRoutine();\n"]]},{"start1":1462,"length1":188,"diffs":[[1,"    }\n    else if (name == \"BEACON\") {\n        // Only listen to the robot I am tracking\n        if (targetId == 0 || value == targetId) {\n            currentRSSI = incomingRSSI;\n            lastBeaconTime = input.runningTime();\n"]]},{"start1":1701,"length1":440,"diffs":[[1,"    }\n    else if (name == \"SAFE\") {\n        // Victim is safe, reset everything\n        if (value == targetId) {\n            resetSystem();\n"]]},{"start1":1852,"length1":88,"diffs":[[1,""]]},{"start1":1858,"length1":252,"diffs":[[1,"});\n\n// ==========================================\n// === 2. VICTIM LOGIC (ONE-WAY SIGNAL) =====\n// ==========================================\n\n// Monitor orientation in background (Fast Reaction)\ncontrol.inBackground(function () {\n    while (true) {\n        const z = input.acceleration(Dimension.Z);\n\n        // === MAJOR FIX HERE ===\n        // We added \"&& !isRescuing\"\n        // If the robot is driving to save someone, it might bump or shake.\n        // We must IGNORE those shakes so it doesn't scream for help itself.\n        if (z < -600 && !isDistressMode && !isRescuing) {\n            becomeVictim();\n        }\n        // Flipped back up -> Become Safe\n        else if (z > 200 && isDistressMode) {\n            becomeSafe();\n        }\n        basic.pause(50);\n    }\n});\n\nfunction becomeVictim() {\n    isDistressMode = true;\n    isRescuing = false; // Stop everything else\n    cuteBot.stopcar();\n\n    // VISUALS\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xff0000); // RED\n    basic.showIcon(IconNames.Sad);\n\n    // RADIO: Send initial Alert\n    radio.sendValue(\"ALERT\", MY_SERIAL);\n\n    // BACKGROUND LOOP: Continuous Beacon & Sound\n"]]},{"start1":3079,"length1":0,"diffs":[[1,"            // 1. Send Beacon (for others to track RSSI)\n"]]},{"start1":3186,"length1":0,"diffs":[[1,"\n            // 2. Make Noise\n"]]},{"start1":3256,"length1":105,"diffs":[[1,"\n            // 3. Occasionally re-send ALERT (in case rescuers missed it)\n            if (Math.randomBoolean()) {\n                radio.sendValue(\"ALERT\", MY_SERIAL);\n            }\n\n            basic.pause(500); // Pulse every 0.5s\n"]]},{"start1":3509,"length1":514,"diffs":[[1,"\nfunction becomeSafe() {\n    isDistressMode = false;\n    radio.sendValue(\"SAFE\", MY_SERIAL); // Tell rescuers to stop\n    resetSystem();\n"]]},{"start1":3648,"length1":1378,"diffs":[[1,"\n// ==========================================\n// === 3. RESCUER LOGIC (IMPROVED APPROACH) =\n// ==========================================\n\nfunction startRescueRoutine() {\n    isRescuing = true;\n\n    // Acknowledge Phase\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xffff00); // YELLOW\n    basic.showIcon(IconNames.Target);\n    basic.pause(500); // Listen for a moment to get initial RSSI\n\n    // --- STEP 1: SCAN ---\n    // Compare Left vs Right to find the strongest signal\n    let leftScore = scanDirection(-35, 35); // Turn Left\n    basic.pause(200);\n    let rightScore = scanDirection(35, -35); // Turn Right\n    basic.pause(200);\n\n    // Turn towards the winner\n    if (leftScore > rightScore) {\n        cuteBot.motors(-35, 35); // Turn Left\n        basic.pause(400);\n"]]},{"start1":4437,"length1":49,"diffs":[[1,"        cuteBot.motors(35, -35); // Turn Right\n        basic.pause(400);\n"]]},{"start1":4516,"length1":0,"diffs":[[1,"    cuteBot.stopcar();\n\n    // --- STEP 2: APPROACH (IMPROVED) ---\n    // Drive until we are VERY close (High RSSI) or it gets quiet\n    driveToTarget();\n\n    // Done\n    resetSystem();\n"]]},{"start1":4704,"length1":391,"diffs":[[1,"\nfunction driveToTarget() {\n    const startTime = input.runningTime();\n    cuteBot.motors(25, 25); // Slow approach\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x0000ff); // BLUE (Driving)\n\n    while (input.runningTime() - startTime < MAX_SEARCH_TIME) {\n\n        // Safety: If I accidentally flip while driving, stop immediately!\n        if (isDistressMode) {\n            cuteBot.stopcar();\n            return;\n"]]},{"start1":5127,"length1":224,"diffs":[[1,"\n        // CHECK 1: Are we there yet? (RSSI is Strong)\n        // -55 is usually within 10-15cm of the target\n        if (currentRSSI > RSSI_ARRIVED_THRESH && currentRSSI != -100) {\n            // WE FOUND IT!\n            missionSuccess();\n            return;\n"]]},{"start1":5398,"length1":421,"diffs":[[1,"\n        // CHECK 2: Is it getting quiet? (Lost the trail)\n        if (input.soundLevel() < SOUND_THRESHOLD) {\n            cuteBot.stopcar();\n            basic.pause(200);\n            if (input.soundLevel() < SOUND_THRESHOLD) {\n                // Still quiet? Maybe we arrived or lost it.\n                break;\n            }\n            cuteBot.motors(25, 25); // Resume\n"]]},{"start1":5780,"length1":252,"diffs":[[1,"\n        basic.pause(50);\n"]]},{"start1":5812,"length1":18,"diffs":[[1,"    cuteBot.stopcar();\n"]]},{"start1":5837,"length1":205,"diffs":[[1,"\nfunction missionSuccess() {\n    cuteBot.stopcar();\n    // Victory Dance\n    for (let i = 0; i < 3; i++) {\n        cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00); // GREEN\n        basic.showIcon(IconNames.Heart);\n        basic.pause(200);\n        cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x000000); // OFF\n        basic.pause(200);\n"]]},{"start1":6181,"length1":696,"diffs":[[1,""]]},{"start1":6183,"length1":905,"diffs":[[1,"\n"]]},{"start1":6230,"length1":35,"diffs":[[1,"// === 4. HELPERS ===========================\n"]]},{"start1":6322,"length1":363,"diffs":[[1,"\n// Turns robot, records max volume and signal, returns a Score\nfunction scanDirection(leftSpeed: number, rightSpeed: number): number {\n    cuteBot.motors(leftSpeed, rightSpeed);\n\n    let maxSound = 0;\n    let maxRssi = -128;\n\n    const t0 = input.runningTime();\n    // Scan for 600ms\n    while (input.runningTime() - t0 < 600) {\n        let s = input.soundLevel();\n        if (s > maxSound) maxSound = s;\n        if (currentRSSI > maxRssi) maxRssi = currentRSSI;\n        basic.pause(20);\n"]]},{"start1":6817,"length1":3,"diffs":[[1,"    cuteBot.stopcar();\n\n    // Normalize and Score\n    let normSound = Math.map(maxSound, 0, 255, 0, 100);\n    let normRssi = Math.map(maxRssi, -95, -40, 0, 100);\n\n    return (normSound * W_SOUND) + (normRssi * W_RSSI);\n}\n\nfunction resetSystem() {\n    cuteBot.stopcar();\n    calmLights();\n\n    // === FIX FOR VICTORY DANCE ===\n    // We wait 1 full second here. The background thread checks\n    // \"!isRescuing\". Since we haven't set it to false yet, \n    // the background thread stays blocked. This lets the robot\n    // stop shaking from the dance before we turn the sensors back on.\n    basic.pause(1000);\n\n    targetId = 0;\n    isRescuing = false; // NOW it's safe to listen to gravity again\n}\n\nfunction calmLights() {\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00); // Green\n    basic.showIcon(IconNames.Happy);\n}"]]}]}]},{"timestamp":1764920383441,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1463,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\":3(P~D/fvFmBVKypE*r$\">isDistressMode</variable><variable id=\"6pVvn!dba|Vn,Z=OnHH!\">incomingRSSI</variable><variable id=\"8,iKCHvExL##NW_6QHA9\">isRescuing</variable><variable id=\"@]1Ev|(WJU{rs=Wwy*mv\">targetId</variable><variable id=\"O8cM~^Cc`WuLJF#(lsP@\">currentRSSI</variable><variable id=\"XZ%@b!2${Pr,%yQjhLZH\">lastBeaconTime</variable><variable id=\"-acfJr$G1BJ:z},A3h.l\">z</variable><variable id=\"Ma{5GoozN/A0d11sx7h}\">MY_SERIAL</variable><variable id=\")!^lz7al^`d+Cd_SUL}J\">searchStartTime</variable><variable id=\";y}qIJzoiKZ`4=pPtSxY\">MAX_SEARCH_TIME</variable><variable id=\"5f`3Xaz`#bg^#wdR=4[]\">initialSignal</variable><variable id=\"s1[*zyFw;4o8{iRiB0=y\">RSSI_ARRIVED_THRESH</variable><variable id=\"tG?JpSqhE+3}ZnhN8J_O\">bestDir</variable><variable id=\"OMXn6z^t;g(Exv}r6ZQA\">newSignal</variable><variable id=\"9cN7!O}J,Uu7.LZ8wfhV\">startSignal</variable><variable id=\"HR1I+=YDK+n8#l9Lh?`+\">leftScore</variable><variable id=\"QhL[/R~i-(!j,_0nB1=@\">rightScore</variable><variable id=\"Y-u`@JEr/s_]RW0$_}{{\">sum</variable><variable id=\"|3!HfBThC{%:Z9,Ke,UG\">count</variable><variable id=\"9N:U69l`G*30vtY}pdz~\">RADIO_GROUP</variable><variable id=\"uE2RN)Uc7O$6l4P44MT3\">SOUND_THRESHOLD</variable><variable id=\"f]|?jHHAA8Z,J]rl)ZE$\">W_SOUND</variable><variable id=\"Muqx5yN%4kX|MHAwU%M$\">W_RSSI</variable></variables><comment x=\"3374.078125\" y=\"1209.5\" w=\"160\" h=\"120\">\n"]]},{"start1":1463,"length1":4044,"diffs":[[1,"</comment><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let isDistressMode = false\" numlines=\"1\" declaredvars=\"isDistressMode\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== STATE VARIABLES ======</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"9N:U69l`G*30vtY}pdz~\">RADIO_GROUP</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== CONFIGURATION ======</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">17</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Ma{5GoozN/A0d11sx7h}\">MY_SERIAL</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_device_serial_number\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"uE2RN)Uc7O$6l4P44MT3\">SOUND_THRESHOLD</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== TUNING CONSTANTS ======\nLouder threshold for sound</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">80</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"s1[*zyFw;4o8{iRiB0=y\">RSSI_ARRIVED_THRESH</field><comment pinned=\"false\" h=\"80\" w=\"160\">-50 is VERY close</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-50</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\";y}qIJzoiKZ`4=pPtSxY\">MAX_SEARCH_TIME</field><comment pinned=\"false\" h=\"80\" w=\"160\">10 seconds timeout</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">10000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"f]|?jHHAA8Z,J]rl)ZE$\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Weights: We now trust Radio (RSSI) more than sound for direction</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.3</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Muqx5yN%4kX|MHAwU%M$\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"O8cM~^Cc`WuLJF#(lsP@\">currentRSSI</field><comment pinned=\"false\" h=\"80\" w=\"160\">Raw value from radio</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value><next><block type=\"radio_set_group\"><comment pinned=\"false\" h=\"80\" w=\"160\">Setup</comment><value name=\"ID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"255\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"9N:U69l`G*30vtY}pdz~\">RADIO_GROUP</field></block></value><next><block type=\"radio_set_transmit_power\"><value name=\"power\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"7\" precision=\"0\"></mutation><field name=\"SLIDER\">7</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"47Q2BVG5eHVkeh%W51mC\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"control_in_background\" x=\"486\" y=\"20\"><comment pinned=\"false\" h=\"80\" w=\"160\">==========================================\n"]]},{"start1":4863,"length1":4394,"diffs":[[1,"==========================================</comment><statement name=\"HANDLER\"><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"-acfJr$G1BJ:z},A3h.l\">z</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_acceleration\"><field name=\"NAME\">Dimension.Z</field></block></value><next><block type=\"controls_if\"><mutation elseif=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Safety Check: Don't flip out if we are driving (Rescuing)</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-acfJr$G1BJ:z},A3h.l\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-600</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":3(P~D/fvFmBVKypE*r$\">isDistressMode</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"8,iKCHvExL##NW_6QHA9\">isRescuing</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"becomeVictim\" functionid=\"J!A}Sd%QqdA%*Q7GW4H(\"></mutation></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-acfJr$G1BJ:z},A3h.l\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":3(P~D/fvFmBVKypE*r$\">isDistressMode</field></block></value></block></value><statement name=\"DO1\"><block type=\"function_call\"><mutation name=\"becomeSafe\" functionid=\"gIwrgDaxrrbT:HJk8j[%\"></mutation></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value></block></next></block></next></block></statement></block></statement></block><block type=\"radio_on_value_drag\" x=\"1556\" y=\"20\"><comment pinned=\"false\" h=\"80\" w=\"160\">==========================================\n"]]},{"start1":8316,"length1":11821,"diffs":[[1,"==========================================</comment><value name=\"HANDLER_DRAG_PARAM_name\"><block type=\"argument_reporter_string\" deletable=\"false\"><field name=\"VALUE\">name</field></block></value><value name=\"HANDLER_DRAG_PARAM_value\"><block type=\"argument_reporter_number\" deletable=\"false\"><field name=\"VALUE\">value</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":3(P~D/fvFmBVKypE*r$\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"return;\" numlines=\"1\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"6pVvn!dba|Vn,Z=OnHH!\">incomingRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"radio_received_packet\"><value name=\"type\"><shadow type=\"radio_packet_property\"><field name=\"note\">RadioPacketProperty.SignalStrength</field></shadow></value></block></value><next><block type=\"controls_if\"><mutation elseif=\"2\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">ALERT</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"8,iKCHvExL##NW_6QHA9\">isRescuing</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"@]1Ev|(WJU{rs=Wwy*mv\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><next><block type=\"function_call\"><mutation name=\"startRescueRoutine\" functionid=\"z[)ADJt5Yt-0s2|~0mWS\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Start the new logic</comment></block></next></block></statement></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">BEACON</field></block></value></block></value><statement name=\"DO1\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@]1Ev|(WJU{rs=Wwy*mv\">targetId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@]1Ev|(WJU{rs=Wwy*mv\">targetId</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"O8cM~^Cc`WuLJF#(lsP@\">currentRSSI</field><comment pinned=\"false\" h=\"80\" w=\"160\">Update the raw global variable</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"6pVvn!dba|Vn,Z=OnHH!\">incomingRSSI</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"XZ%@b!2${Pr,%yQjhLZH\">lastBeaconTime</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></statement></block></statement><value name=\"IF2\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">SAFE</field></block></value></block></value><statement name=\"DO2\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@]1Ev|(WJU{rs=Wwy*mv\">targetId</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"gB9oIXO@EB{zOtYqfk.`\"></mutation></block></statement></block></statement></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2372\" y=\"20\"><mutation name=\"driveWhileHot\" functionid=\"!|fPme,JYIBu4q$T4a1|\"><arg name=\"startSignal\" id=\"isztoklhipn5twwo5t9aw\" type=\"number\"></arg></mutation><field name=\"function_name\">driveWhileHot</field><comment pinned=\"false\" h=\"80\" w=\"160\">Moves forward as long as signal is Good or Getting Better</comment><value name=\"isztoklhipn5twwo5t9aw\"><block type=\"argument_reporter_number\" deletable=\"false\"><field name=\"VALUE\">startSignal</field></block></value><statement name=\"STACK\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">Blue</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x0000ff</field></shadow></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Drive forward</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">25</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">25</field></shadow></value><next><block type=\"controls_repeat_ext\"><comment pinned=\"false\" h=\"80\" w=\"160\">Drive for up to 1.5 seconds, checking signal every 200ms</comment><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">8</field></shadow></value><statement name=\"DO\"><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Safety stop</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":3(P~D/fvFmBVKypE*r$\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"OMXn6z^t;g(Exv}r6ZQA\">newSignal</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"getSmoothedRSSI\" functionid=\"z)m7xXE8a3JVEIPC-=(G\"></mutation></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Arrived check</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"OMXn6z^t;g(Exv}r6ZQA\">newSignal</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"s1[*zyFw;4o8{iRiB0=y\">RSSI_ARRIVED_THRESH</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Exit, the main loop will catch the success</comment></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">CRITICAL LOGIC: HOT OR COLD?\n"]]},{"start1":17786,"length1":26113,"diffs":[[1,"Example: Started at -70, now at -75. STOP.</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"OMXn6z^t;g(Exv}r6ZQA\">newSignal</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">startSignal</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">Flash Red briefly</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xff0000</field></shadow></value><next><block type=\"device_pause\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Exit function to Trigger a re-scan</comment></block></next></block></next></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"9cN7!O}J,Uu7.LZ8wfhV\">startSignal</field><comment pinned=\"false\" h=\"80\" w=\"160\">Update baseline (we are now at the new spot)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"OMXn6z^t;g(Exv}r6ZQA\">newSignal</field></block></value></block></next></block></next></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"3046\" y=\"20\"><mutation name=\"smartScan\" functionid=\"I3]02$#|y:if*ZGVR:dI\"></mutation><field name=\"function_name\">smartScan</field><comment pinned=\"false\" h=\"80\" w=\"160\">Scans Left and Right and returns which way is strongest</comment><statement name=\"STACK\"><block type=\"cutebot_stopcar\"><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Check Left</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-35</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">35</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">300</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">Wait for radio to settle</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"HR1I+=YDK+n8#l9Lh?`+\">leftScore</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"getSmoothedRSSI\" functionid=\"z)m7xXE8a3JVEIPC-=(G\"></mutation></block></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Turn all the way to Right (Left turn + Right turn = 600ms)</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">35</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-35</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">600</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"QhL[/R~i-(!j,_0nB1=@\">rightScore</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"getSmoothedRSSI\" functionid=\"z)m7xXE8a3JVEIPC-=(G\"></mutation></block></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Return to Center</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-35</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">35</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">300</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"controls_if\"><mutation elseif=\"1\" else=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Compare\nNote: Closer to 0 is better. -60 is larger than -80.</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HR1I+=YDK+n8#l9Lh?`+\">leftScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QhL[/R~i-(!j,_0nB1=@\">rightScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">LEFT</field></block></value></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QhL[/R~i-(!j,_0nB1=@\">rightScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HR1I+=YDK+n8#l9Lh?`+\">leftScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></block></value></block></value><statement name=\"DO1\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">RIGHT</field></block></value></block></statement><statement name=\"ELSE\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Roughly equal</comment><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">CENTER</field></block></value></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"3748\" y=\"20\"><mutation name=\"getSmoothedRSSI\" functionid=\"z)m7xXE8a3JVEIPC-=(G\"></mutation><field name=\"function_name\">getSmoothedRSSI</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== HELPER: RSSI SMOOTHING ======\nTakes 5 readings and averages them to remove noise</comment><statement name=\"STACK\"><block type=\"controls_repeat_ext\"><comment pinned=\"false\" h=\"80\" w=\"160\">Take 5 samples over 100ms</comment><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">5</field></shadow></value><statement name=\"DO\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Only add if we have a valid recent signal</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">NEQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"O8cM~^Cc`WuLJF#(lsP@\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_change\"><field name=\"VAR\" id=\"Y-u`@JEr/s_]RW0$_}{{\">sum</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"O8cM~^Cc`WuLJF#(lsP@\">currentRSSI</field></block></value><next><block type=\"variables_change\"><field name=\"VAR\" id=\"|3!HfBThC{%:Z9,Ke,UG\">count</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">If no signal, return a very low number</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"|3!HfBThC{%:Z9,Ke,UG\">count</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Y-u`@JEr/s_]RW0$_}{{\">sum</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"|3!HfBThC{%:Z9,Ke,UG\">count</field></block></value></block></value></block></value></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"20\" y=\"1210\"><mutation name=\"becomeVictim\" functionid=\"J!A}Sd%QqdA%*Q7GW4H(\"></mutation><field name=\"function_name\">becomeVictim</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\":3(P~D/fvFmBVKypE*r$\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"8,iKCHvExL##NW_6QHA9\">isRescuing</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"cutebot_stopcar\"><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xff0000</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field><next><block type=\"radio_datagram_send_value\"><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">ALERT</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ma{5GoozN/A0d11sx7h}\">MY_SERIAL</field></block></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        while (isDistressMode) {\" line2=\"            radio.sendValue(&quot;BEACON&quot;, MY_SERIAL);\" line3=\"            soundExpression.sad.play();\" line4=\"            if (Math.randomBoolean()) radio.sendValue(&quot;ALERT&quot;, MY_SERIAL);\" line5=\"            basic.pause(500);\" line6=\"        }\" line7=\"    });\" numlines=\"8\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"748\" y=\"1210\"><mutation name=\"becomeSafe\" functionid=\"gIwrgDaxrrbT:HJk8j[%\"></mutation><field name=\"function_name\">becomeSafe</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\":3(P~D/fvFmBVKypE*r$\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"radio_datagram_send_value\"><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">SAFE</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ma{5GoozN/A0d11sx7h}\">MY_SERIAL</field></block></value><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"gB9oIXO@EB{zOtYqfk.`\"></mutation></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"1194\" y=\"1210\"><mutation name=\"startRescueRoutine\" functionid=\"z[)ADJt5Yt-0s2|~0mWS\"></mutation><field name=\"function_name\">startRescueRoutine</field><data>0</data><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"8,iKCHvExL##NW_6QHA9\">isRescuing</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Diamond</field><comment pinned=\"false\" h=\"80\" w=\"160\">Icon: Searching</comment><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">Yellow</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xffff00</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\")!^lz7al^`d+Cd_SUL}J\">searchStartTime</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"8,iKCHvExL##NW_6QHA9\">isRescuing</field></block></value><statement name=\"DO\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Timeout check</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\")!^lz7al^`d+Cd_SUL}J\">searchStartTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";y}qIJzoiKZ`4=pPtSxY\">MAX_SEARCH_TIME</field></block></value></block></value><statement name=\"DO0\"><block type=\"break_keyword\"><comment pinned=\"false\" h=\"80\" w=\"160\">Give up</comment></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"5f`3Xaz`#bg^#wdR=4[]\">initialSignal</field><comment pinned=\"false\" h=\"80\" w=\"160\">1. Get a clean baseline reading</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"getSmoothedRSSI\" functionid=\"z)m7xXE8a3JVEIPC-=(G\"></mutation></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">2. CHECK: Are we there yet?</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"5f`3Xaz`#bg^#wdR=4[]\">initialSignal</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"s1[*zyFw;4o8{iRiB0=y\">RSSI_ARRIVED_THRESH</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"missionSuccess\" functionid=\"i/Ks)vp_iQCOj.{Z{!r!\"></mutation><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"tG?JpSqhE+3}ZnhN8J_O\">bestDir</field><comment pinned=\"false\" h=\"80\" w=\"160\">3. DECISION: Scan to find the best direction\nWe look Left, Center, Right</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"smartScan\" functionid=\"I3]02$#|y:if*ZGVR:dI\"></mutation></block></value><next><block type=\"controls_if\"><mutation elseif=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">4. Turn toward best direction</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"tG?JpSqhE+3}ZnhN8J_O\">bestDir</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">LEFT</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Turn Left</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-30</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">30</field></shadow></value><next><block type=\"device_pause\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">300</field></shadow></value></block></next></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"tG?JpSqhE+3}ZnhN8J_O\">bestDir</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">RIGHT</field></block></value></block></value><statement name=\"DO1\"><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Turn Right</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">30</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-30</field></shadow></value><next><block type=\"device_pause\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">300</field></shadow></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><comment pinned=\"false\" h=\"80\" w=\"160\">If \"CENTER\", we don't turn, we just drive.\n"]]},{"start1":38814,"length1":4705,"diffs":[[1,"We drive forward for a bit, but check if signal drops.</comment><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">100</field></shadow></value><next><block type=\"function_call\"><mutation name=\"driveWhileHot\" functionid=\"!|fPme,JYIBu4q$T4a1|\"><arg name=\"startSignal\" id=\"isztoklhipn5twwo5t9aw\" type=\"number\"></arg></mutation><value name=\"isztoklhipn5twwo5t9aw\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"5f`3Xaz`#bg^#wdR=4[]\">initialSignal</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"gB9oIXO@EB{zOtYqfk.`\"></mutation></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2110\" y=\"1210\"><mutation name=\"missionSuccess\" functionid=\"i/Ks)vp_iQCOj.{Z{!r!\"></mutation><field name=\"function_name\">missionSuccess</field><statement name=\"STACK\"><block type=\"cutebot_stopcar\"><next><block type=\"controls_repeat_ext\"><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">3</field></shadow></value><statement name=\"DO\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">Green</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x000000</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block></next></block></statement></block><block type=\"function_definition\" x=\"2574\" y=\"1210\"><mutation name=\"resetSystem\" functionid=\"gB9oIXO@EB{zOtYqfk.`\"></mutation><field name=\"function_name\">resetSystem</field><statement name=\"STACK\"><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"47Q2BVG5eHVkeh%W51mC\"></mutation><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">Cooldown for accelerometer</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"8,iKCHvExL##NW_6QHA9\">isRescuing</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"@]1Ev|(WJU{rs=Wwy*mv\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2968\" y=\"1210\"><mutation name=\"calmLights\" functionid=\"47Q2BVG5eHVkeh%W51mC\"></mutation><field name=\"function_name\">calmLights</field><statement name=\"STACK\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":2,"length1":45,"diffs":[[1,"    \"name\": \"p5_test\",\n"]]},{"start1":340,"length1":44,"diffs":[[1,""]]}]},{"type":"added","filename":"test.ts","value":"// tests go here; this will not be compiled when this package is used as an extension.\n"}]}],"snapshots":[{"timestamp":1764888671505,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>","main.ts":"\n","README.md":"","pxt.json":"{\n    \"name\": \"p5_test\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}},{"timestamp":1764915520876,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"-Z,4a-e%xNA0#6|qTj9N\">scanningAnimOn</variable><variable id=\"J)I8g*gvB(_K*8}d[*-j\">v</variable><variable id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</variable><variable id=\"T5T^}eOsq?]ibB?ne(,y\">MAX</variable><variable id=\"qU${p6I_m:1=jBjy)9^i\">rssi</variable><variable id=\"gxCd{DZG.@S;:.ke4fo^\">alertCooldown</variable><variable id=\"`aQ84*,ix6xoK)iV}R9c\">MSG_ALERT</variable><variable id=\"FNnb#.[J:HaTsd!6sF],\">myId</variable><variable id=\"EMnV~ul.WwEzQ!Xlvc34\">MSG_BEACON</variable><variable id=\"fW(4qbl,Qlb3.hv;GZi4\">MSG_DONE</variable><variable id=\"?HLF0lX{$S83wL2dP^[,\">senderId</variable><variable id=\"[y`Z)1dFQ6UKDzBRU%hU\">senderId2</variable><variable id=\"k=J=!{Nx:|6s2g[3CQ,)\">targetId</variable><variable id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</variable><variable id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</variable><variable id=\"OM?cv1-tsyk#OMh:-{bx\">scanning</variable><variable id=\"r{)GYlBG6Om6+0l34,v{\">leftRssiMax</variable><variable id=\"/relD1s6YQbqNn-3m.vo\">rightRssiMax</variable><variable id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</variable><variable id=\"%~fT~.3Fk:Hy{LCgAY-F\">leftStart</variable><variable id=\"wT!.DQnAB3=]W~^k!263\">SCAN_MS</variable><variable id=\"m^S4St$L|2:`%@v6yT/H\">s</variable><variable id=\"Q|sM-1j(+oZ}f:Geer4[\">leftSoundMax</variable><variable id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</variable><variable id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</variable><variable id=\"{!=)M:W`.s~x65bsf+h#\">rightStart</variable><variable id=\"}y_7+AqV)2)k:LP.3HMr\">t</variable><variable id=\"-Z|rg/RWnmU,%VUoCUo=\">rightSoundMax</variable><variable id=\"Yn])m[:YGhf9$#M#-~4a\">leftScore</variable><variable id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</variable><variable id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</variable><variable id=\"-.=u$`9s4*B%MySH*Y2]\">rightScore</variable><variable id=\"!nolpoU?hzfs;RcU_e#C\">SEEK_MS</variable><variable id=\"h{%JbJ3i!sg,e-2O]OT/\">leftRssiMax2</variable><variable id=\"(Pe?IzWi7vjGmVjy6#xA\">rightRssiMax2</variable><variable id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</variable><variable id=\"C2*giTM;V`iXUfRT/JWn\">leftStart2</variable><variable id=\"qd;nwtv2[F+ixX7P.osU\">SCAN_MS_SHORT</variable><variable id=\"t+6^uPDpJk?(B++Zms4O\">u</variable><variable id=\"k4kPk6AYGbWx@EG{-5o}\">leftSoundMax2</variable><variable id=\"ZR8dC?WNhO5fdn*ct.H+\">rightStart2</variable><variable id=\"%*Vm5EcwK-tmw@TC%L~b\">rightSoundMax2</variable><variable id=\"NwqHhd|ls^]a@.U7/(jb\">leftScore2</variable><variable id=\"tVa+F0GWr4me~LciH!(4\">rightScore2</variable><variable id=\"9wMvQ+KFD_nv]qUHFemz\">SEEK_MS_SHORT</variable><variable id=\"AEz9|ALWrQ-$spDMYI1~\">t02</variable><variable id=\"qczk{/|pPm8._CED+;Kd\">lastRescan</variable><variable id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</variable><variable id=\"V,lUgU.jBe_Qc/04^JzL\">APPROACH_MAX_MS</variable><variable id=\"93f0j|C|lxs|h/Tt;31E\">w</variable><variable id=\"XJ7j!u+_(y[h}WOK5,}t\">SOUND_APPROACH_THRESH</variable><variable id=\"a+hb[x{4o@#;OGcn8[Jd\">quietStart</variable><variable id=\"KZ*Zy@nmhCRE$M,CRmUg\">QUIET_STOP_MS</variable><variable id=\"CR3g38QgGU:$(PX)KL/f\">RESCAN_PERIOD_MS</variable><variable id=\"4gscC;?*]XI3pOeF9}PV\">z</variable><variable id=\"ZY.XCdOZ:uk}P[Pp{u]!\">pitch</variable><variable id=\"T(lkrrgs0fRJpc=TCUo5\">z2</variable><variable id=\"m|?8=XQ%aA.S2Jrf[tx:\">pitch2</variable><variable id=\"oW(^(c~~;fs#7`bL=*}2\">strength</variable><variable id=\"1N6Y*5q!NJbf=BUxOLQ7\">LIFT_ACCEL_THRESH</variable><variable id=\"?f0wz(j/abJw,}YR:k?|\">RADIO_GROUP</variable></variables><comment x=\"20\" y=\"4871\" w=\"480\" h=\"120\">\n====== Target tracking (RSSI from source beacons) ======\n</comment><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"briefRescanAndAdjust\" functionid=\";}8;sWF`0NN~t[[p=!)z\"></mutation><field name=\"function_name\">briefRescanAndAdjust</field><comment pinned=\"false\" h=\"80\" w=\"160\">=== Brief re-scan used during approach (yellow animation on/off) ===</comment><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningLights\" functionid=\"/0rtS)UcmD4N~#!:T]f~\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\"h{%JbJ3i!sg,e-2O]OT/\">leftRssiMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"(Pe?IzWi7vjGmVjy6#xA\">rightRssiMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Scan LEFT (short)</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"C2*giTM;V`iXUfRT/JWn\">leftStart2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"C2*giTM;V`iXUfRT/JWn\">leftStart2</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qd;nwtv2[F+ixX7P.osU\">SCAN_MS_SHORT</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"t+6^uPDpJk?(B++Zms4O\">u</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"t+6^uPDpJk?(B++Zms4O\">u</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"k4kPk6AYGbWx@EG{-5o}\">leftSoundMax2</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"k4kPk6AYGbWx@EG{-5o}\">leftSoundMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"t+6^uPDpJk?(B++Zms4O\">u</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"h{%JbJ3i!sg,e-2O]OT/\">leftRssiMax2</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"h{%JbJ3i!sg,e-2O]OT/\">leftRssiMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value></block></statement></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">15</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</field></block></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Scan RIGHT (short)</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"ZR8dC?WNhO5fdn*ct.H+\">rightStart2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ZR8dC?WNhO5fdn*ct.H+\">rightStart2</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qd;nwtv2[F+ixX7P.osU\">SCAN_MS_SHORT</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"J)I8g*gvB(_K*8}d[*-j\">v</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"J)I8g*gvB(_K*8}d[*-j\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"%*Vm5EcwK-tmw@TC%L~b\">rightSoundMax2</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"%*Vm5EcwK-tmw@TC%L~b\">rightSoundMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"J)I8g*gvB(_K*8}d[*-j\">v</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"(Pe?IzWi7vjGmVjy6#xA\">rightRssiMax2</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"(Pe?IzWi7vjGmVjy6#xA\">rightRssiMax2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value></block></statement></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">15</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"NwqHhd|ls^]a@.U7/(jb\">leftScore2</field><comment pinned=\"false\" h=\"80\" w=\"160\">Combine and adjust heading</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normSound\" functionid=\"9d^z^*5%*W2W+}MVn*~3\"><arg name=\"v\" id=\"uskzyisnlovwxfrtyyl4h\" type=\"number\"></arg></mutation><value name=\"uskzyisnlovwxfrtyyl4h\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"k4kPk6AYGbWx@EG{-5o}\">leftSoundMax2</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normRssi\" functionid=\"F/ko;ht.|Lgo4+23~Jig\"><arg name=\"rssi\" id=\"oorcc2427v0nof69ldroj\" type=\"number\"></arg></mutation><value name=\"oorcc2427v0nof69ldroj\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"h{%JbJ3i!sg,e-2O]OT/\">leftRssiMax2</field></block></value></block></value></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"tVa+F0GWr4me~LciH!(4\">rightScore2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normSound\" functionid=\"9d^z^*5%*W2W+}MVn*~3\"><arg name=\"v\" id=\"uskzyisnlovwxfrtyyl4h\" type=\"number\"></arg></mutation><value name=\"uskzyisnlovwxfrtyyl4h\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"%*Vm5EcwK-tmw@TC%L~b\">rightSoundMax2</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normRssi\" functionid=\"F/ko;ht.|Lgo4+23~Jig\"><arg name=\"rssi\" id=\"oorcc2427v0nof69ldroj\" type=\"number\"></arg></mutation><value name=\"oorcc2427v0nof69ldroj\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"(Pe?IzWi7vjGmVjy6#xA\">rightRssiMax2</field></block></value></block></value></block></value></block></value><next><block type=\"controls_if\"><mutation elseif=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"NwqHhd|ls^]a@.U7/(jb\">leftScore2</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"tVa+F0GWr4me~LciH!(4\">rightScore2</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"9wMvQ+KFD_nv]qUHFemz\">SEEK_MS_SHORT</field></block></value></block></next></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"tVa+F0GWr4me~LciH!(4\">rightScore2</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"NwqHhd|ls^]a@.U7/(jb\">leftScore2</field></block></value></block></value><statement name=\"DO1\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"9wMvQ+KFD_nv]qUHFemz\">SEEK_MS_SHORT</field></block></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"|k!E-.DXcEX}_v/{-PhM\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"approachWhileLoudWithRescan\" functionid=\"O6^r^Y`z`6#:sw)iH@bj\"></mutation><field name=\"function_name\">approachWhileLoudWithRescan</field><comment pinned=\"false\" h=\"80\" w=\"160\">=== Approach with periodic re-scan loop ===</comment><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"AEz9|ALWrQ-$spDMYI1~\">t02</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"qczk{/|pPm8._CED+;Kd\">lastRescan</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Start forward motion</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</field></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"AEz9|ALWrQ-$spDMYI1~\">t02</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"V,lUgU.jBe_Qc/04^JzL\">APPROACH_MAX_MS</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"93f0j|C|lxs|h/Tt;31E\">w</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Quiet detection for stopping</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"93f0j|C|lxs|h/Tt;31E\">w</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"XJ7j!u+_(y[h}WOK5,}t\">SOUND_APPROACH_THRESH</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+hb[x{4o@#;OGcn8[Jd\">quietStart</field><comment pinned=\"false\" h=\"80\" w=\"160\">loud again: keep moving</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a+hb[x{4o@#;OGcn8[Jd\">quietStart</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+hb[x{4o@#;OGcn8[Jd\">quietStart</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a+hb[x{4o@#;OGcn8[Jd\">quietStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"KZ*Zy@nmhCRE$M,CRmUg\">QUIET_STOP_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"break_keyword\"><comment pinned=\"false\" h=\"80\" w=\"160\">quiet long enough—stop approaching</comment></block></statement></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Periodic brief re-scan to correct heading</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qczk{/|pPm8._CED+;Kd\">lastRescan</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"CR3g38QgGU:$(PX)KL/f\">RESCAN_PERIOD_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"briefRescanAndAdjust\" functionid=\";}8;sWF`0NN~t[[p=!)z\"></mutation><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Resume forward motion</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"qczk{/|pPm8._CED+;Kd\">lastRescan</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></next></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">30</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"isScreenUpBySensor\" functionid=\"7+QpZ.+;Ce`aMA|^c8jo\"></mutation><field name=\"function_name\">isScreenUpBySensor</field><comment pinned=\"false\" h=\"80\" w=\"160\">Heuristic orientation checks using accelerometer Z and pitch.\nPositive Z with small pitch → screen up; negative Z → screen down.</comment><data>0</data><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"4gscC;?*]XI3pOeF9}PV\">z</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_acceleration\"><field name=\"NAME\">Dimension.Z</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"ZY.XCdOZ:uk}P[Pp{u]!\">pitch</field><comment pinned=\"false\" h=\"80\" w=\"160\">~0 when flat</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_rotation\"><field name=\"NAME\">Rotation.Pitch</field></block></value><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"4gscC;?*]XI3pOeF9}PV\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_op3\"><value name=\"x\"><block type=\"variables_get\"><field name=\"VAR\" id=\"ZY.XCdOZ:uk}P[Pp{u]!\">pitch</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">45</field></shadow></value></block></value></block></value></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"isScreenDownBySensor\" functionid=\"uG+1]$XBxjDGy%Z)36E?\"></mutation><field name=\"function_name\">isScreenDownBySensor</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"T(lkrrgs0fRJpc=TCUo5\">z2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_acceleration\"><field name=\"NAME\">Dimension.Z</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m|?8=XQ%aA.S2Jrf[tx:\">pitch2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_rotation\"><field name=\"NAME\">Rotation.Pitch</field></block></value><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"T(lkrrgs0fRJpc=TCUo5\">z2</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-200</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_op3\"><value name=\"x\"><block type=\"variables_get\"><field name=\"VAR\" id=\"m|?8=XQ%aA.S2Jrf[tx:\">pitch2</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">45</field></shadow></value></block></value></block></value></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"setupFlipDetectionBySensors\" functionid=\"X6qag/wRC)tgP#hM6oRV\"></mutation><field name=\"function_name\">setupFlipDetectionBySensors</field><comment pinned=\"false\" h=\"80\" w=\"160\">Poll orientation and trigger flip alerts without referencing enums.</comment><statement name=\"STACK\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.inBackground(function () {\" line1=\"        let lastUp = isScreenUpBySensor();\" line2=\"        while (true) {\" line3=\"            const nowUp = isScreenUpBySensor();\" line4=\"            const nowDown = isScreenDownBySensor();\" line5=\"\" line6=\"            if (nowUp &amp;&amp; !lastUp) {\" line7=\"                triggerAlert(&quot;flip-up(sensor)&quot;);\" line8=\"                lastUp = true;\" line9=\"            } else if (nowDown &amp;&amp; lastUp) {\" line10=\"                triggerAlert(&quot;flip-down(sensor)&quot;);\" line11=\"                lastUp = false;\" line12=\"            }\" line13=\"            basic.pause(120);\" line14=\"        }\" line15=\"    });\" numlines=\"16\"></mutation></block></statement></block><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let scanningAnimOn = false\" numlines=\"1\" declaredvars=\"scanningAnimOn\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== LED helpers (with animations) ======</comment><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let alertCooldown = false\" numlines=\"1\" declaredvars=\"alertCooldown\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\"?f0wz(j/abJw,}YR:k?|\">RADIO_GROUP</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Radio setup ======\nset any group; same on all bots</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">17</field></shadow></value><next><block type=\"radio_set_group\"><value name=\"ID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"255\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"?f0wz(j/abJw,}YR:k?|\">RADIO_GROUP</field></block></value><next><block type=\"radio_set_transmit_power\"><comment pinned=\"false\" h=\"80\" w=\"160\">max power for consistent RSSI</comment><value name=\"power\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"7\" precision=\"0\"></mutation><field name=\"SLIDER\">7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"FNnb#.[J:HaTsd!6sF],\">myId</field><comment pinned=\"false\" h=\"80\" w=\"160\">unique per micro:bit</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_device_serial_number\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"`aQ84*,ix6xoK)iV}R9c\">MSG_ALERT</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Message types (for multi-action behaviors) ======</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">ALERT</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"EMnV~ul.WwEzQ!Xlvc34\">MSG_BEACON</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">BEACON</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"fW(4qbl,Qlb3.hv;GZi4\">MSG_DONE</field><comment pinned=\"false\" h=\"80\" w=\"160\">optional end-of-response marker</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">DONE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Motion/scan settings ======\npivot speed (0..100) for initial scan</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">40</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"wT!.DQnAB3=]W~^k!263\">SCAN_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">sample time per side during initial scan</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">600</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"!nolpoU?hzfs;RcU_e#C\">SEEK_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">time to align toward chosen side (initial)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">400</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">pause between actions</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">150</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"*B`]wjS=Uwh};|00pxv7\">SLOW_FORWARD_SPEED</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Approach (with periodic re-scan) settings ======\napproach forward speed</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">25</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"XJ7j!u+_(y[h}WOK5,}t\">SOUND_APPROACH_THRESH</field><comment pinned=\"false\" h=\"80\" w=\"160\">continue forward while sound ≥ this</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">60</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"V,lUgU.jBe_Qc/04^JzL\">APPROACH_MAX_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">safety cap on approach duration</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">3000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"KZ*Zy@nmhCRE$M,CRmUg\">QUIET_STOP_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">stop if quiet for this long</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">400</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"CR3g38QgGU:$(PX)KL/f\">RESCAN_PERIOD_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Re-scan loop parameters\nre-scan every 0.8s while approaching</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">800</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"qd;nwtv2[F+ixX7P.osU\">SCAN_MS_SHORT</field><comment pinned=\"false\" h=\"80\" w=\"160\">short re-scan duration per side</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">300</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"9wMvQ+KFD_nv]qUHFemz\">SEEK_MS_SHORT</field><comment pinned=\"false\" h=\"80\" w=\"160\">short correction turn time</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">250</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"*PN@!ruJIWdQt.taWs|#\">APPROACH_TURN_SPEED</field><comment pinned=\"false\" h=\"80\" w=\"160\">pivot speed during re-scan corrections</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</field><comment pinned=\"false\" h=\"80\" w=\"160\">Weigh microphone loudness vs. radio RSSI when deciding direction</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.3</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"1N6Y*5q!NJbf=BUxOLQ7\">LIFT_ACCEL_THRESH</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Lift/flip detection thresholds ======\nmg spike for lift/bump</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1300</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field><comment pinned=\"false\" h=\"80\" w=\"160\">sender we're following\nupdated on each beacon</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">ms of last beacon\nstale window for RSSI</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">3000</field></shadow></value><next><block type=\"function_call\"><mutation name=\"setupFlipDetectionBySensors\" functionid=\"X6qag/wRC)tgP#hM6oRV\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== Startup ======\nenum-safe flip detection</comment><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"Iga}tH/,N!*f9X8fMa%N\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"control_in_background\" x=\"545\" y=\"20\"><comment pinned=\"false\" h=\"80\" w=\"160\">====== Background: detect lift/bump via acceleration strength ======</comment><statement name=\"HANDLER\"><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"oW(^(c~~;fs#7`bL=*}2\">strength</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_acceleration\"><field name=\"NAME\">Dimension.Strength</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"oW(^(c~~;fs#7`bL=*}2\">strength</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"1N6Y*5q!NJbf=BUxOLQ7\">LIFT_ACCEL_THRESH</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"triggerAlert\" functionid=\"o_Ot1|9.;SaBqE2tc=Md\"><arg name=\"reason\" id=\"vp9im044187fuz3wcbud\" type=\"string\"></arg></mutation><value name=\"vp9im044187fuz3wcbud\"><shadow type=\"text\"><field name=\"TEXT\">lift/bump</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value></block></next></block></next></block></statement></block></statement></block><block type=\"device_gesture_event\" x=\"1155\" y=\"20\"><field name=\"NAME\">Gesture.Shake</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Universal gesture: SHAKE (safe to reference) ======</comment><statement name=\"HANDLER\"><block type=\"function_call\"><mutation name=\"triggerAlert\" functionid=\"o_Ot1|9.;SaBqE2tc=Md\"><arg name=\"reason\" id=\"vp9im044187fuz3wcbud\" type=\"string\"></arg></mutation><value name=\"vp9im044187fuz3wcbud\"><shadow type=\"text\"><field name=\"TEXT\">shake</field></shadow></value></block></statement></block><block type=\"radio_on_value_drag\" x=\"2293\" y=\"20\"><comment pinned=\"false\" h=\"80\" w=\"160\">====== Radio receive handlers ======</comment><value name=\"HANDLER_DRAG_PARAM_name\"><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"HANDLER_DRAG_PARAM_value\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qU${p6I_m:1=jBjy)9^i\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"radio_received_packet\"><value name=\"type\"><shadow type=\"radio_packet_property\"><field name=\"note\">RadioPacketProperty.SignalStrength</field></shadow></value></block></value><next><block type=\"controls_if\"><mutation elseif=\"2\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">optional end-of-beacon handling</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"`aQ84*,ix6xoK)iV}R9c\">MSG_ALERT</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"?HLF0lX{$S83wL2dP^[,\">senderId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">NEQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"?HLF0lX{$S83wL2dP^[,\">senderId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"FNnb#.[J:HaTsd!6sF],\">myId</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"respondToAlert\" functionid=\"wpc1;#!@Dcx@|)d!F%)h\"><arg name=\"senderId\" id=\"3bo0uqxm9ydvw0toy8x1\" type=\"number\"></arg></mutation><value name=\"3bo0uqxm9ydvw0toy8x1\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"?HLF0lX{$S83wL2dP^[,\">senderId</field></block></value></block></statement></block></next></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"EMnV~ul.WwEzQ!Xlvc34\">MSG_BEACON</field></block></value></block></value><statement name=\"DO1\"><block type=\"variables_set\"><field name=\"VAR\" id=\"[y`Z)1dFQ6UKDzBRU%hU\">senderId2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"k=J=!{Nx:|6s2g[3CQ,)\">targetId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"[y`Z)1dFQ6UKDzBRU%hU\">senderId2</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"k=J=!{Nx:|6s2g[3CQ,)\">targetId</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qU${p6I_m:1=jBjy)9^i\">rssi</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></statement></block></next></block></statement><value name=\"IF2\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"fW(4qbl,Qlb3.hv;GZi4\">MSG_DONE</field></block></value></block></value></block></next></block></statement></block><block type=\"function_definition\" x=\"3164\" y=\"20\"><mutation name=\"calmLights\" functionid=\"Iga}tH/,N!*f9X8fMa%N\"></mutation><field name=\"function_name\">calmLights</field><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"|k!E-.DXcEX}_v/{-PhM\"></mutation><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">green</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"3595\" y=\"20\"><mutation name=\"sadLights\" functionid=\"qh:k4i.0rG6wwh=2{9Us\"></mutation><field name=\"function_name\">sadLights</field><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"|k!E-.DXcEX}_v/{-PhM\"></mutation><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">red</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xff0000</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"4026\" y=\"20\"><mutation name=\"scanningLights\" functionid=\"/0rtS)UcmD4N~#!:T]f~\"></mutation><field name=\"function_name\">scanningLights</field><statement name=\"STACK\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">yellow</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xffff00</field></shadow></value><next><block type=\"function_call\"><mutation name=\"scanningAnimationStart\" functionid=\"+mWzE(|qbJZh*DL$/!3j\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></statement></block><block type=\"function_definition\" x=\"4456\" y=\"20\"><mutation name=\"scanningAnimationStart\" functionid=\"+mWzE(|qbJZh*DL$/!3j\"></mutation><field name=\"function_name\">scanningAnimationStart</field><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-Z,4a-e%xNA0#6|qTj9N\">scanningAnimOn</field></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"-Z,4a-e%xNA0#6|qTj9N\">scanningAnimOn</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        const frames: Image[] = [\" line2=\"            images.createImage(`\" line3=\"                . . . . .\" line4=\"                . . # . .\" line5=\"                . # . # .\" line6=\"                . . . . .\" line7=\"                . . . . .\" line8=\"            `),\" line9=\"            images.createImage(`\" line10=\"                . . . . .\" line11=\"                . . . . .\" line12=\"                . . # . .\" line13=\"                . . . . .\" line14=\"                . . . . .\" line15=\"            `),\" line16=\"            images.createImage(`\" line17=\"                . . . . .\" line18=\"                . . . . .\" line19=\"                . # . # .\" line20=\"                . . # . .\" line21=\"                . . . . .\" line22=\"            `),\" line23=\"            images.createImage(`\" line24=\"                . . . . .\" line25=\"                . . . . .\" line26=\"                . . . . .\" line27=\"                . . # . .\" line28=\"                . . . . .\" line29=\"            `)\" line30=\"        ];\" line31=\"        let idx = 0;\" line32=\"        while (scanningAnimOn) {\" line33=\"            frames[idx].showImage(0);\" line34=\"            idx = (idx + 1) % frames.length;\" line35=\"            basic.pause(120);\" line36=\"        }\" line37=\"        basic.clearScreen();\" line38=\"    });\" numlines=\"39\"></mutation></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"20\" y=\"1906\"><mutation name=\"scanningAnimationStop\" functionid=\"|k!E-.DXcEX}_v/{-PhM\"></mutation><field name=\"function_name\">scanningAnimationStop</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"-Z,4a-e%xNA0#6|qTj9N\">scanningAnimOn</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value></block></statement></block><block type=\"function_definition\" x=\"450\" y=\"1906\"><mutation name=\"normSound\" functionid=\"9d^z^*5%*W2W+}MVn*~3\"><arg name=\"v\" id=\"uskzyisnlovwxfrtyyl4h\" type=\"number\"></arg></mutation><field name=\"function_name\">normSound</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Normalize helpers ======\nMicrophone: soundLevel() ≈ 0..255</comment><value name=\"uskzyisnlovwxfrtyyl4h\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"J)I8g*gvB(_K*8}d[*-j\">v</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"J)I8g*gvB(_K*8}d[*-j\">v</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">0..100</comment><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></value></block></value></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"1035\" y=\"1906\"><mutation name=\"normRssi\" functionid=\"F/ko;ht.|Lgo4+23~Jig\"><arg name=\"rssi\" id=\"oorcc2427v0nof69ldroj\" type=\"number\"></arg></mutation><field name=\"function_name\">normRssi</field><comment pinned=\"false\" h=\"80\" w=\"160\">RSSI: typical micro:bit radio RSSI ≈ -95..-45 dBm</comment><value name=\"oorcc2427v0nof69ldroj\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-95</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"T5T^}eOsq?]ibB?ne(,y\">MAX</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-45</field></shadow></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qU${p6I_m:1=jBjy)9^i\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"T5T^}eOsq?]ibB?ne(,y\">MAX</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qU${p6I_m:1=jBjy)9^i\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"T5T^}eOsq?]ibB?ne(,y\">MAX</field></block></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">0..100</comment><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"T5T^}eOsq?]ibB?ne(,y\">MAX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"GzV?u*k5ocBF,ifGOikZ\">MIN</field></block></value></block></value></block></value></block></value></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"1930\" y=\"1906\"><mutation name=\"triggerAlert\" functionid=\"o_Ot1|9.;SaBqE2tc=Md\"><arg name=\"reason\" id=\"vp9im044187fuz3wcbud\" type=\"string\"></arg></mutation><field name=\"function_name\">triggerAlert</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Send alert + start periodic beacons ======</comment><value name=\"vp9im044187fuz3wcbud\"><block type=\"argument_reporter_string\"><field name=\"VALUE\">reason</field></block></value><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"gxCd{DZG.@S;:.ke4fo^\">alertCooldown</field></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"gxCd{DZG.@S;:.ke4fo^\">alertCooldown</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"function_call\"><mutation name=\"sadLights\" functionid=\"qh:k4i.0rG6wwh=2{9Us\"></mutation><next><block type=\"SoundExpression_play\"><field name=\"this\">soundExpression.sad</field><next><block type=\"radio_datagram_send_value\"><comment pinned=\"false\" h=\"80\" w=\"160\">one-shot alert</comment><value name=\"name\"><block type=\"variables_get\"><field name=\"VAR\" id=\"`aQ84*,ix6xoK)iV}R9c\">MSG_ALERT</field></block></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"FNnb#.[J:HaTsd!6sF],\">myId</field></block></value><next><block type=\"function_call\"><mutation name=\"startBeacon\" functionid=\"QE[j@3L+J9HRoX6yQUO@\"><arg name=\"durationMs\" id=\"3wbkhsmmxt897zqzk7ctf\" type=\"number\"></arg><arg name=\"intervalMs\" id=\"hhsqf6m8vsmwvj273qtxj\" type=\"number\"></arg></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Keep beacons flowing for others to sample RSSI while scanning\nduration, interval</comment><value name=\"3wbkhsmmxt897zqzk7ctf\"><shadow type=\"math_number\"><field name=\"NUM\">4000</field></shadow></value><value name=\"hhsqf6m8vsmwvj273qtxj\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        basic.pause(1500);\" line2=\"        calmLights();\" line3=\"        alertCooldown = false;\" line4=\"    });\" numlines=\"5\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2407\" y=\"1906\"><mutation name=\"startBeacon\" functionid=\"QE[j@3L+J9HRoX6yQUO@\"><arg name=\"durationMs\" id=\"3wbkhsmmxt897zqzk7ctf\" type=\"number\"></arg><arg name=\"intervalMs\" id=\"hhsqf6m8vsmwvj273qtxj\" type=\"number\"></arg></mutation><field name=\"function_name\">startBeacon</field><value name=\"3wbkhsmmxt897zqzk7ctf\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">durationMs</field></block></value><value name=\"hhsqf6m8vsmwvj273qtxj\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">intervalMs</field></block></value><statement name=\"STACK\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        const t0 = input.runningTime();\" line2=\"        while (input.runningTime() - t0 &lt; durationMs) {\" line3=\"            radio.sendValue(MSG_BEACON, myId);\" line4=\"            basic.pause(intervalMs);\" line5=\"        }\" line6=\"        radio.sendValue(MSG_DONE, myId);\" line7=\"    });\" numlines=\"8\"></mutation></block></statement></block><block type=\"function_definition\" x=\"2968\" y=\"1906\"><mutation name=\"respondToAlert\" functionid=\"wpc1;#!@Dcx@|)d!F%)h\"><arg name=\"senderId\" id=\"3bo0uqxm9ydvw0toy8x1\" type=\"number\"></arg></mutation><field name=\"function_name\">respondToAlert</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Combined audio + RSSI scanning, turn, and approach ======\nTrack maxima per side while pivoting</comment><value name=\"3bo0uqxm9ydvw0toy8x1\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">senderId</field></block></value><statement name=\"STACK\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">prevent overlapping scans</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"OM?cv1-tsyk#OMh:-{bx\">scanning</field></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"OM?cv1-tsyk#OMh:-{bx\">scanning</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"k=J=!{Nx:|6s2g[3CQ,)\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">senderId</field></block></value><next><block type=\"function_call\"><mutation name=\"scanningLights\" functionid=\"/0rtS)UcmD4N~#!:T]f~\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">1) Indicate scanning</comment><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">short pause to let beacons start</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"r{)GYlBG6Om6+0l34,v{\">leftRssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/relD1s6YQbqNn-3m.vo\">rightRssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">---- Scan LEFT ----\npivot left</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"%~fT~.3Fk:Hy{LCgAY-F\">leftStart</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"%~fT~.3Fk:Hy{LCgAY-F\">leftStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"wT!.DQnAB3=]W~^k!263\">SCAN_MS</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"m^S4St$L|2:`%@v6yT/H\">s</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m^S4St$L|2:`%@v6yT/H\">s</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Q|sM-1j(+oZ}f:Geer4[\">leftSoundMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Q|sM-1j(+oZ}f:Geer4[\">leftSoundMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m^S4St$L|2:`%@v6yT/H\">s</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"r{)GYlBG6Om6+0l34,v{\">leftRssiMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"r{)GYlBG6Om6+0l34,v{\">leftRssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value></block></statement></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">15</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</field></block></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">---- Scan RIGHT ----\npivot right</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"{!=)M:W`.s~x65bsf+h#\">rightStart</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{!=)M:W`.s~x65bsf+h#\">rightStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"wT!.DQnAB3=]W~^k!263\">SCAN_MS</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"}y_7+AqV)2)k:LP.3HMr\">t</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"}y_7+AqV)2)k:LP.3HMr\">t</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-Z|rg/RWnmU,%VUoCUo=\">rightSoundMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"-Z|rg/RWnmU,%VUoCUo=\">rightSoundMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"}y_7+AqV)2)k:LP.3HMr\">t</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"b);zxB-VH7^lHq*)SHY.\">lastBeaconTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QLQK_eLX6`+}E+Wu6yh7\">BEACON_TIMEOUT_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/relD1s6YQbqNn-3m.vo\">rightRssiMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"/relD1s6YQbqNn-3m.vo\">rightRssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"p!%l6_V_*j`k^vl0?!vz\">currentRSSI</field></block></value></block></statement></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">15</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!O$Af)/4R5fJKOY(-!C?\">SETTLE_MS</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Yn])m[:YGhf9$#M#-~4a\">leftScore</field><comment pinned=\"false\" h=\"80\" w=\"160\">---- Combine cues ----</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normSound\" functionid=\"9d^z^*5%*W2W+}MVn*~3\"><arg name=\"v\" id=\"uskzyisnlovwxfrtyyl4h\" type=\"number\"></arg></mutation><value name=\"uskzyisnlovwxfrtyyl4h\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Q|sM-1j(+oZ}f:Geer4[\">leftSoundMax</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normRssi\" functionid=\"F/ko;ht.|Lgo4+23~Jig\"><arg name=\"rssi\" id=\"oorcc2427v0nof69ldroj\" type=\"number\"></arg></mutation><value name=\"oorcc2427v0nof69ldroj\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"r{)GYlBG6Om6+0l34,v{\">leftRssiMax</field></block></value></block></value></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"-.=u$`9s4*B%MySH*Y2]\">rightScore</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$@N-.#nW6/.A@`9-OZc]\">SOUND_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normSound\" functionid=\"9d^z^*5%*W2W+}MVn*~3\"><arg name=\"v\" id=\"uskzyisnlovwxfrtyyl4h\" type=\"number\"></arg></mutation><value name=\"uskzyisnlovwxfrtyyl4h\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-Z|rg/RWnmU,%VUoCUo=\">rightSoundMax</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"+5%Y;C!-w.g#15Pn!5o=\">RSSI_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normRssi\" functionid=\"F/ko;ht.|Lgo4+23~Jig\"><arg name=\"rssi\" id=\"oorcc2427v0nof69ldroj\" type=\"number\"></arg></mutation><value name=\"oorcc2427v0nof69ldroj\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/relD1s6YQbqNn-3m.vo\">rightRssiMax</field></block></value></block></value></block></value></block></value><next><block type=\"controls_if\"><mutation elseif=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">---- Turn toward the stronger/louder side ----</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Yn])m[:YGhf9$#M#-~4a\">leftScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-.=u$`9s4*B%MySH*Y2]\">rightScore</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!nolpoU?hzfs;RcU_e#C\">SEEK_MS</field></block></value></block></next></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-.=u$`9s4*B%MySH*Y2]\">rightScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Yn])m[:YGhf9$#M#-~4a\">leftScore</field></block></value></block></value><statement name=\"DO1\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";;t?Zd$G-U9v5#rckN@z\">TURN_SPEED</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"!nolpoU?hzfs;RcU_e#C\">SEEK_MS</field></block></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"sadLights\" functionid=\"qh:k4i.0rG6wwh=2{9Us\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">3) Play sad sound to empathize</comment><next><block type=\"SoundExpression_play\"><field name=\"this\">soundExpression.sad</field><next><block type=\"function_call\"><mutation name=\"approachWhileLoudWithRescan\" functionid=\"O6^r^Y`z`6#:sw)iH@bj\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">4) Approach the source: drive forward slowly while loud; stop when quiet</comment><next><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"|k!E-.DXcEX}_v/{-PhM\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Reset state</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"OM?cv1-tsyk#OMh:-{bx\">scanning</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"k=J=!{Nx:|6s2g[3CQ,)\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"Iga}tH/,N!*f9X8fMa%N\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>","main.ts":"\n// ====== Radio setup ======\nconst RADIO_GROUP = 17;           // set any group; same on all bots\nradio.setGroup(RADIO_GROUP);\nradio.setTransmitPower(7);        // max power for consistent RSSI\n\nconst myId = control.deviceSerialNumber(); // unique per micro:bit\n\n// ====== Message types (for multi-action behaviors) ======\nconst MSG_ALERT = \"ALERT\";\nconst MSG_BEACON = \"BEACON\";\nconst MSG_DONE = \"DONE\"; // optional end-of-response marker\n\n// ====== Motion/scan settings ======\nconst TURN_SPEED = 40;     // pivot speed (0..100) for initial scan\nconst SCAN_MS = 600;       // sample time per side during initial scan\nconst SEEK_MS = 400;       // time to align toward chosen side (initial)\nconst SETTLE_MS = 150;     // pause between actions\n\n// ====== Approach (with periodic re-scan) settings ======\nconst SLOW_FORWARD_SPEED = 25;     // approach forward speed\nconst SOUND_APPROACH_THRESH = 60;  // continue forward while sound ≥ this\nconst APPROACH_MAX_MS = 3000;      // safety cap on approach duration\nconst QUIET_STOP_MS = 400;         // stop if quiet for this long\n\n// Re-scan loop parameters\nconst RESCAN_PERIOD_MS = 800;      // re-scan every 0.8s while approaching\nconst SCAN_MS_SHORT = 300;         // short re-scan duration per side\nconst SEEK_MS_SHORT = 250;         // short correction turn time\nconst APPROACH_TURN_SPEED = 35;    // pivot speed during re-scan corrections\n\n// Weigh microphone loudness vs. radio RSSI when deciding direction\nconst SOUND_WEIGHT = 0.7;\nconst RSSI_WEIGHT = 0.3;\n\n// ====== Lift/flip detection thresholds ======\nconst LIFT_ACCEL_THRESH = 1300; // mg spike for lift/bump\nlet alertCooldown = false;\nlet scanning = false;\n\n// ====== Target tracking (RSSI from source beacons) ======\nlet targetId = 0;                     // sender we're following\nlet currentRSSI = -128;               // updated on each beacon\nlet lastBeaconTime = 0;               // ms of last beacon\nconst BEACON_TIMEOUT_MS = 3000;       // stale window for RSSI\n\n// ====== LED helpers (with animations) ======\nlet scanningAnimOn = false;\n\nfunction calmLights() {\n    scanningAnimationStop();\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00); // green\n    basic.showIcon(IconNames.Happy);\n}\n\nfunction sadLights() {\n    scanningAnimationStop();\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xff0000); // red\n    basic.showIcon(IconNames.Sad);\n}\n\nfunction scanningLights() {\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xffff00); // yellow\n    scanningAnimationStart();\n}\n\nfunction scanningAnimationStart() {\n    if (scanningAnimOn) return;\n    scanningAnimOn = true;\n    control.runInParallel(function () {\n        const frames: Image[] = [\n            images.createImage(`\n                . . . . .\n                . . # . .\n                . # . # .\n                . . . . .\n                . . . . .\n            `),\n            images.createImage(`\n                . . . . .\n                . . . . .\n                . . # . .\n                . . . . .\n                . . . . .\n            `),\n            images.createImage(`\n                . . . . .\n                . . . . .\n                . # . # .\n                . . # . .\n                . . . . .\n            `),\n            images.createImage(`\n                . . . . .\n                . . . . .\n                . . . . .\n                . . # . .\n                . . . . .\n            `)\n        ];\n        let idx = 0;\n        while (scanningAnimOn) {\n            frames[idx].showImage(0);\n            idx = (idx + 1) % frames.length;\n            basic.pause(120);\n        }\n        basic.clearScreen();\n    });\n}\n\nfunction scanningAnimationStop() {\n    scanningAnimOn = false;\n}\n\n// ====== Normalize helpers ======\n// Microphone: soundLevel() ≈ 0..255\nfunction normSound(v: number): number {\n    if (v < 0) v = 0;\n    if (v > 255) v = 255;\n    return Math.round(v * 100 / 255); // 0..100\n}\n// RSSI: typical micro:bit radio RSSI ≈ -95..-45 dBm\nfunction normRssi(rssi: number): number {\n    const MIN = -95, MAX = -45;\n    if (rssi < MIN) rssi = MIN;\n    if (rssi > MAX) rssi = MAX;\n    return Math.round((rssi - MIN) * 100 / (MAX - MIN)); // 0..100\n}\n\n// ====== Send alert + start periodic beacons ======\nfunction triggerAlert(reason: string) {\n    if (alertCooldown) return;\n    alertCooldown = true;\n\n    sadLights();\n    soundExpression.sad.play();\n    radio.sendValue(MSG_ALERT, myId); // one-shot alert\n\n    // Keep beacons flowing for others to sample RSSI while scanning\n    startBeacon(4000, 200); // duration, interval\n\n    // cooldown: return to calm after a bit\n    control.runInParallel(function () {\n        basic.pause(1500);\n        calmLights();\n        alertCooldown = false;\n    });\n}\n\nfunction startBeacon(durationMs: number, intervalMs: number) {\n    control.runInParallel(function () {\n        const t0 = input.runningTime();\n        while (input.runningTime() - t0 < durationMs) {\n            radio.sendValue(MSG_BEACON, myId);\n            basic.pause(intervalMs);\n        }\n        radio.sendValue(MSG_DONE, myId);\n    });\n}\n\n// ====== Radio receive handlers ======\nradio.onReceivedValue(function (name: string, value: number) {\n    const rssi = radio.receivedPacket(RadioPacketProperty.SignalStrength);\n\n    if (name == MSG_ALERT) {\n        const senderId = value;\n        if (senderId != myId) {\n            respondToAlert(senderId);\n        }\n    } else if (name == MSG_BEACON) {\n        const senderId = value;\n        if (targetId == 0 || senderId == targetId) {\n            currentRSSI = rssi;\n            lastBeaconTime = input.runningTime();\n        }\n    } else if (name == MSG_DONE) {\n        // optional end-of-beacon handling\n    }\n});\n\n// ====== Combined audio + RSSI scanning, turn, and approach ======\nfunction respondToAlert(senderId: number) {\n    if (scanning) return; // prevent overlapping scans\n    scanning = true;\n    targetId = senderId;\n\n    // 1) Indicate scanning\n    scanningLights();\n    basic.pause(200); // short pause to let beacons start\n\n    // Track maxima per side while pivoting\n    let leftSoundMax = 0;\n    let rightSoundMax = 0;\n    let leftRssiMax = -128;\n    let rightRssiMax = -128;\n\n    // ---- Scan LEFT ----\n    cuteBot.motors(-TURN_SPEED, TURN_SPEED); // pivot left\n    const leftStart = input.runningTime();\n    while (input.runningTime() - leftStart < SCAN_MS) {\n        const s = input.soundLevel();\n        if (s > leftSoundMax) leftSoundMax = s;\n\n        if (input.runningTime() - lastBeaconTime <= BEACON_TIMEOUT_MS) {\n            if (currentRSSI > leftRssiMax) leftRssiMax = currentRSSI;\n        }\n        basic.pause(15);\n    }\n    cuteBot.stopcar();\n    basic.pause(SETTLE_MS);\n\n    // ---- Scan RIGHT ----\n    cuteBot.motors(TURN_SPEED, -TURN_SPEED); // pivot right\n    const rightStart = input.runningTime();\n    while (input.runningTime() - rightStart < SCAN_MS) {\n        const s = input.soundLevel();\n        if (s > rightSoundMax) rightSoundMax = s;\n\n        if (input.runningTime() - lastBeaconTime <= BEACON_TIMEOUT_MS) {\n            if (currentRSSI > rightRssiMax) rightRssiMax = currentRSSI;\n        }\n        basic.pause(15);\n    }\n    cuteBot.stopcar();\n    basic.pause(SETTLE_MS);\n\n    // ---- Combine cues ----\n    const leftScore = SOUND_WEIGHT * normSound(leftSoundMax) + RSSI_WEIGHT * normRssi(leftRssiMax);\n    const rightScore = SOUND_WEIGHT * normSound(rightSoundMax) + RSSI_WEIGHT * normRssi(rightRssiMax);\n\n    // ---- Turn toward the stronger/louder side ----\n    if (leftScore > rightScore) {\n        cuteBot.motors(-TURN_SPEED, TURN_SPEED);\n        basic.pause(SEEK_MS);\n    } else if (rightScore > leftScore) {\n        cuteBot.motors(TURN_SPEED, -TURN_SPEED);\n        basic.pause(SEEK_MS);\n    }\n    cuteBot.stopcar();\n\n    // 3) Play sad sound to empathize\n    sadLights();\n    soundExpression.sad.play();\n\n    // 4) Approach the source: drive forward slowly while loud; stop when quiet\n    approachWhileLoudWithRescan();\n\n    // Reset state\n    scanningAnimationStop();\n    scanning = false;\n    targetId = 0;\n    calmLights();\n}\n\n// === Brief re-scan used during approach (yellow animation on/off) ===\nfunction briefRescanAndAdjust() {\n    scanningLights();\n\n    let leftSoundMax = 0;\n    let rightSoundMax = 0;\n    let leftRssiMax = -128;\n    let rightRssiMax = -128;\n\n    // Scan LEFT (short)\n    cuteBot.motors(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED);\n    const leftStart = input.runningTime();\n    while (input.runningTime() - leftStart < SCAN_MS_SHORT) {\n        const s = input.soundLevel();\n        if (s > leftSoundMax) leftSoundMax = s;\n\n        if (input.runningTime() - lastBeaconTime <= BEACON_TIMEOUT_MS) {\n            if (currentRSSI > leftRssiMax) leftRssiMax = currentRSSI;\n        }\n        basic.pause(15);\n    }\n    cuteBot.stopcar();\n    basic.pause(SETTLE_MS);\n\n    // Scan RIGHT (short)\n    cuteBot.motors(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED);\n    const rightStart = input.runningTime();\n    while (input.runningTime() - rightStart < SCAN_MS_SHORT) {\n        const s = input.soundLevel();\n        if (s > rightSoundMax) rightSoundMax = s;\n\n        if (input.runningTime() - lastBeaconTime <= BEACON_TIMEOUT_MS) {\n            if (currentRSSI > rightRssiMax) rightRssiMax = currentRSSI;\n        }\n        basic.pause(15);\n    }\n    cuteBot.stopcar();\n    basic.pause(SETTLE_MS);\n\n    // Combine and adjust heading\n    const leftScore = SOUND_WEIGHT * normSound(leftSoundMax) + RSSI_WEIGHT * normRssi(leftRssiMax);\n    const rightScore = SOUND_WEIGHT * normSound(rightSoundMax) + RSSI_WEIGHT * normRssi(rightRssiMax);\n\n    if (leftScore > rightScore) {\n        cuteBot.motors(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED);\n        basic.pause(SEEK_MS_SHORT);\n    } else if (rightScore > leftScore) {\n        cuteBot.motors(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED);\n        basic.pause(SEEK_MS_SHORT);\n    }\n    cuteBot.stopcar();\n\n    scanningAnimationStop();\n}\n\n// === Approach with periodic re-scan loop ===\nfunction approachWhileLoudWithRescan() {\n    const t0 = input.runningTime();\n    let quietStart = 0;\n    let lastRescan = input.runningTime();\n\n    // Start forward motion\n    cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED);\n\n    while (input.runningTime() - t0 < APPROACH_MAX_MS) {\n        const s = input.soundLevel();\n\n        // Quiet detection for stopping\n        if (s >= SOUND_APPROACH_THRESH) {\n            quietStart = 0; // loud again: keep moving\n        } else {\n            if (quietStart == 0) quietStart = input.runningTime();\n            if (input.runningTime() - quietStart >= QUIET_STOP_MS) {\n                break; // quiet long enough—stop approaching\n            }\n        }\n\n        // Periodic brief re-scan to correct heading\n        if (input.runningTime() - lastRescan >= RESCAN_PERIOD_MS) {\n            cuteBot.stopcar();\n            briefRescanAndAdjust();\n            // Resume forward motion\n            cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED);\n            lastRescan = input.runningTime();\n        }\n\n        basic.pause(30);\n    }\n\n    cuteBot.stopcar();\n}\n\n// ====================================================================\n// === COMPATIBILITY (enum-safe) FLIP DETECTION via sensors ===========\n// ====================================================================\n\n// Heuristic orientation checks using accelerometer Z and pitch.\n// Positive Z with small pitch → screen up; negative Z → screen down.\nfunction isScreenUpBySensor(): boolean {\n    const z = input.acceleration(Dimension.Z);\n    const pitch = input.rotation(Rotation.Pitch); // ~0 when flat\n    return z > 200 && Math.abs(pitch) < 45;\n}\nfunction isScreenDownBySensor(): boolean {\n    const z = input.acceleration(Dimension.Z);\n    const pitch = input.rotation(Rotation.Pitch);\n    return z < -200 && Math.abs(pitch) < 45;\n}\n\n// Poll orientation and trigger flip alerts without referencing enums.\nfunction setupFlipDetectionBySensors() {\n    control.inBackground(function () {\n        let lastUp = isScreenUpBySensor();\n        while (true) {\n            const nowUp = isScreenUpBySensor();\n            const nowDown = isScreenDownBySensor();\n\n            if (nowUp && !lastUp) {\n                triggerAlert(\"flip-up(sensor)\");\n                lastUp = true;\n            } else if (nowDown && lastUp) {\n                triggerAlert(\"flip-down(sensor)\");\n                lastUp = false;\n            }\n            basic.pause(120);\n        }\n    });\n}\n\n// ====== Universal gesture: SHAKE (safe to reference) ======\ninput.onGesture(Gesture.Shake, function () {\n    triggerAlert(\"shake\");\n});\n\n// ====== Background: detect lift/bump via acceleration strength ======\ncontrol.inBackground(function () {\n    while (true) {\n        const strength = input.acceleration(Dimension.Strength);\n        if (strength > LIFT_ACCEL_THRESH) {\n            triggerAlert(\"lift/bump\");\n            basic.pause(1000);\n        }\n        basic.pause(50);\n    }\n});\n\n// ====== Startup ======\nsetupFlipDetectionBySensors(); // enum-safe flip detection\ncalmLights();\n","README.md":"","pxt.json":"{\n    \"name\": \"p5_test\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\",\n        \"radio-broadcast\": \"*\",\n        \"cutebot\": \"github:elecfreaks/pxt-cutebot#v6.2.4\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1764917576352,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</variable><variable id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</variable><variable id=\"^j%oFTI0/$TbCv_zOML5\">MSG_ALERT</variable><variable id=\"jf`~oRe.#J`a@InuozSt\">myId</variable><variable id=\"jf$`u?l),0}^SVzOLf:D\">MSG_DONE</variable><variable id=\":s0#vocc2*9?#P^3nu`q\">rssi</variable><variable id=\"sp`5#c{[W6=1s*I*Hnw4\">MSG_BEACON</variable><variable id=\"nJfq+;#[}QkfzJ]t_FfX\">senderId</variable><variable id=\"/r6OB-%U!^STyZR5XY4H\">targetId</variable><variable id=\"m4]mq*CkgYrTE,{sC_Q-\">currentRSSI</variable><variable id=\"R~[E/Q~CT?p#Edsdj3uh\">lastBeaconTime</variable><variable id=\"A$KqR@Z8o+N32d=lf-:_\">leftScore</variable><variable id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</variable><variable id=\"liklD]!o^2z}(nl{|/Ri\">SCAN_MS</variable><variable id=\"/{.{gesL4}[+ScsFHTZ/\">SETTLE_MS</variable><variable id=\"]7o$z,jX.rE-+H/#O,#Q\">rightScore</variable><variable id=\"J:1.z!NNy8EbE$@BYrrJ\">SEEK_MS</variable><variable id=\"Z/1@,w-_3GJbT4=[.s3.\">rssiMax</variable><variable id=\"sRB]W+3kZ6S{s?a%VtRK\">t0</variable><variable id=\")qaQ2;%;g7PTDC+tpsQ?\">s</variable><variable id=\"7+Mi49Vi(r@b$HLC,=~1\">soundMax</variable><variable id=\"|z#Bi3#k=-$LEoj~.DOG\">BEACON_TIMEOUT_MS</variable><variable id=\")INkiCZ/jx!V{N|j0^[`\">SOUND_WEIGHT</variable><variable id=\";_HxxO.~Vn:4GYeO*vls\">RSSI_WEIGHT</variable><variable id=\"$BhYb^(i{2A#-Z/2+8Gi\">tStart</variable><variable id=\"^hGx2bJ_MaXJ?W`Im5FE\">lastRescan</variable><variable id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</variable><variable id=\"L{]I27XkQqE_8SF{_Fd(\">APPROACH_MAX_MS</variable><variable id=\"j2]1oHtc]7tM;JA4Zf%(\">t</variable><variable id=\"=/qz$L4$5LE^Ewh)(X?_\">SOUND_APPROACH_THRESH</variable><variable id=\"Jvy%1=fCd8!%Bu{Zm@u,\">quietStart</variable><variable id=\"bl|Itb[pR8Bx@)g1(E_3\">QUIET_STOP_MS</variable><variable id=\"Pk6w*/HWMmeO=5jMY*#|\">RESCAN_PERIOD_MS</variable><variable id=\"8]etx+BF3R?1.f@lr8py\">left</variable><variable id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</variable><variable id=\"`ZtNo]rEI3)e2u8)ija4\">SCAN_MS_SHORT</variable><variable id=\"BQVbdyP0BnLn1%DVJs%z\">right</variable><variable id=\"v!r$_l5kj#HbJv3zw9GT\">SEEK_MS_SHORT</variable><variable id=\"kfi#zx$?dFkn7RV,{Jx^\">v</variable><variable id=\"32VXQ{U`t0J44rf(!cMd\">MIN</variable><variable id=\"f?|JGAT!0iW,::B}YoM7\">MAX</variable><variable id=\"i3QI.ZPW|rY@#gr;l9(Z\">scanningAnimOn</variable><variable id=\"4oqX@Sm5hsjr5L@q1q]8\">RADIO_GROUP</variable></variables><comment x=\"0\" y=\"0\" w=\"480\" h=\"120\">\n=========================================================\n</comment><comment x=\"0\" y=\"0\" w=\"480\" h=\"120\">\n=========================================================\n=== PART 2: THE RESCUER LOGIC ==========================\n</comment><comment x=\"0\" y=\"0\" w=\"160\" h=\"120\">\nTarget tracking\n</comment><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"monitorOrientation\" functionid=\"_g5CT4D-l:BIuas8Z6q@\"></mutation><field name=\"function_name\">monitorOrientation</field><data>0</data><statement name=\"STACK\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.inBackground(function () {\" line1=\"        while (true) {\" line2=\"            const accelZ = input.acceleration(Dimension.Z);\" line3=\"\" line4=\"            // Detect Flip Down (Z &lt; -600)\" line5=\"            if (accelZ &lt; -600 &amp;&amp; !isDistressMode) {\" line6=\"                enterDistressMode();\" line7=\"            }\" line8=\"            // Detect Flip Up (Z &gt; 200)\" line9=\"            else if (accelZ &gt; 200 &amp;&amp; isDistressMode) {\" line10=\"                // Only exit if we are truly upright, not just shaken\" line11=\"                exitDistressMode();\" line12=\"            }\" line13=\"            basic.pause(50); // Check every 50ms (Fast Response)\" line14=\"        }\" line15=\"    });\" numlines=\"16\"></mutation></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"enterDistressMode\" functionid=\"$Sx$FhNOV9NznMwK2(Iw\"></mutation><field name=\"function_name\">enterDistressMode</field><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</field><comment pinned=\"false\" h=\"80\" w=\"160\">Stop trying to rescue others if I am hurt</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"cutebot_stopcar\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"function_call\"><mutation name=\"sadLights\" functionid=\"X=a:]Ue{RJTFC,RU,loN\"></mutation><next><block type=\"radio_datagram_send_value\"><value name=\"name\"><block type=\"variables_get\"><field name=\"VAR\" id=\"^j%oFTI0/$TbCv_zOML5\">MSG_ALERT</field></block></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"jf`~oRe.#J`a@InuozSt\">myId</field></block></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        while (isDistressMode) {\" line2=\"            // Broadcast beacon for RSSI tracking\" line3=\"            radio.sendValue(MSG_BEACON, myId);\" line4=\"            soundExpression.sad.play();\" line5=\"\" line6=\"            // Randomly re-send ALERT packet\" line7=\"            if (Math.randomBoolean()) {\" line8=\"                radio.sendValue(MSG_ALERT, myId);\" line9=\"            }\" line10=\"            basic.pause(600);\" line11=\"        }\" line12=\"    });\" numlines=\"13\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"exitDistressMode\" functionid=\"oap%09W(-PSB9z3O+BAR\"></mutation><field name=\"function_name\">exitDistressMode</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"radio_datagram_send_value\"><value name=\"name\"><block type=\"variables_get\"><field name=\"VAR\" id=\"jf$`u?l),0}^SVzOLf:D\">MSG_DONE</field></block></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"jf`~oRe.#J`a@InuozSt\">myId</field></block></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"k{$lQzHu4Kwc2o~gDj5B\"></mutation></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"scanSide\" functionid=\"B7ft2b2x_S}3n%ia*B]~\"><arg name=\"leftSpeed\" id=\"drqps96fb52xn70edjd2\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"kagwbea375l4c6rt6hxed\" type=\"number\"></arg><arg name=\"duration\" id=\"oldsmjr07cds6bd54ue6\" type=\"number\"></arg></mutation><field name=\"function_name\">scanSide</field><comment pinned=\"false\" h=\"80\" w=\"160\">Helper to scan one direction and return max score</comment><value name=\"drqps96fb52xn70edjd2\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">leftSpeed</field></block></value><value name=\"kagwbea375l4c6rt6hxed\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">rightSpeed</field></block></value><value name=\"oldsmjr07cds6bd54ue6\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">duration</field></block></value><statement name=\"STACK\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">leftSpeed</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rightSpeed</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Z/1@,w-_3GJbT4=[.s3.\">rssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"sRB]W+3kZ6S{s?a%VtRK\">t0</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"sRB]W+3kZ6S{s?a%VtRK\">t0</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">duration</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\")qaQ2;%;g7PTDC+tpsQ?\">s</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\")qaQ2;%;g7PTDC+tpsQ?\">s</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"7+Mi49Vi(r@b$HLC,=~1\">soundMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"7+Mi49Vi(r@b$HLC,=~1\">soundMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\")qaQ2;%;g7PTDC+tpsQ?\">s</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"R~[E/Q~CT?p#Edsdj3uh\">lastBeaconTime</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"|z#Bi3#k=-$LEoj~.DOG\">BEACON_TIMEOUT_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m4]mq*CkgYrTE,{sC_Q-\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Z/1@,w-_3GJbT4=[.s3.\">rssiMax</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Z/1@,w-_3GJbT4=[.s3.\">rssiMax</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m4]mq*CkgYrTE,{sC_Q-\">currentRSSI</field></block></value></block></statement></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">10</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\")INkiCZ/jx!V{N|j0^[`\">SOUND_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normSound\" functionid=\"/$qD{ZxSAhBsi=^v|c,l\"><arg name=\"v\" id=\"wmesznfx49nygom8tas3\" type=\"number\"></arg></mutation><value name=\"wmesznfx49nygom8tas3\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"7+Mi49Vi(r@b$HLC,=~1\">soundMax</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";_HxxO.~Vn:4GYeO*vls\">RSSI_WEIGHT</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"normRssi\" functionid=\"L3j6%NpfNt%yVYB/!{;r\"><arg name=\"rssi\" id=\"gsbsb20o5trvquels545\" type=\"number\"></arg></mutation><value name=\"gsbsb20o5trvquels545\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Z/1@,w-_3GJbT4=[.s3.\">rssiMax</field></block></value></block></value></block></value></block></value></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"approachWhileLoudWithRescan\" functionid=\"[Y1*wJmdgZ0I4c2r2@7o\"></mutation><field name=\"function_name\">approachWhileLoudWithRescan</field><comment pinned=\"false\" h=\"80\" w=\"160\">=== Approach Loop with Wiggle Correction ===</comment><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"$BhYb^(i{2A#-Z/2+8Gi\">tStart</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"^hGx2bJ_MaXJ?W`Im5FE\">lastRescan</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</field></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$BhYb^(i{2A#-Z/2+8Gi\">tStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"L{]I27XkQqE_8SF{_Fd(\">APPROACH_MAX_MS</field></block></value></block></value><statement name=\"DO\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Safety: stop if we get flipped during rescue</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2]1oHtc]7tM;JA4Zf%(\">t</field><comment pinned=\"false\" h=\"80\" w=\"160\">Volume Check</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2]1oHtc]7tM;JA4Zf%(\">t</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"=/qz$L4$5LE^Ewh)(X?_\">SOUND_APPROACH_THRESH</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Jvy%1=fCd8!%Bu{Zm@u,\">quietStart</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Jvy%1=fCd8!%Bu{Zm@u,\">quietStart</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Jvy%1=fCd8!%Bu{Zm@u,\">quietStart</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Jvy%1=fCd8!%Bu{Zm@u,\">quietStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"bl|Itb[pR8Bx@)g1(E_3\">QUIET_STOP_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"break_keyword\"></block></statement></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Periodic Re-Scan (Wiggle)</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^hGx2bJ_MaXJ?W`Im5FE\">lastRescan</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Pk6w*/HWMmeO=5jMY*#|\">RESCAN_PERIOD_MS</field></block></value></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"briefRescanAndAdjust\" functionid=\"Yz$6STe._6;aWBz?9{`J\"></mutation><next><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"^hGx2bJ_MaXJ?W`Im5FE\">lastRescan</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></next></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"briefRescanAndAdjust\" functionid=\"Yz$6STe._6;aWBz?9{`J\"></mutation><field name=\"function_name\">briefRescanAndAdjust</field><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningLights\" functionid=\"?oCHj$obZ$6)YXTOP8Gg\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\"8]etx+BF3R?1.f@lr8py\">left</field><comment pinned=\"false\" h=\"80\" w=\"160\">Quick Left/Right check</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanSide\" functionid=\"B7ft2b2x_S}3n%ia*B]~\"><arg name=\"leftSpeed\" id=\"drqps96fb52xn70edjd2\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"kagwbea375l4c6rt6hxed\" type=\"number\"></arg><arg name=\"duration\" id=\"oldsmjr07cds6bd54ue6\" type=\"number\"></arg></mutation><value name=\"drqps96fb52xn70edjd2\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value></block></value><value name=\"kagwbea375l4c6rt6hxed\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value><value name=\"oldsmjr07cds6bd54ue6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"`ZtNo]rEI3)e2u8)ija4\">SCAN_MS_SHORT</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"BQVbdyP0BnLn1%DVJs%z\">right</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanSide\" functionid=\"B7ft2b2x_S}3n%ia*B]~\"><arg name=\"leftSpeed\" id=\"drqps96fb52xn70edjd2\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"kagwbea375l4c6rt6hxed\" type=\"number\"></arg><arg name=\"duration\" id=\"oldsmjr07cds6bd54ue6\" type=\"number\"></arg></mutation><value name=\"drqps96fb52xn70edjd2\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value><value name=\"kagwbea375l4c6rt6hxed\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value></block></value><value name=\"oldsmjr07cds6bd54ue6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"`ZtNo]rEI3)e2u8)ija4\">SCAN_MS_SHORT</field></block></value></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"8]etx+BF3R?1.f@lr8py\">left</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"BQVbdyP0BnLn1%DVJs%z\">right</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"v!r$_l5kj#HbJv3zw9GT\">SEEK_MS_SHORT</field></block></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"v!r$_l5kj#HbJv3zw9GT\">SEEK_MS_SHORT</field></block></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"sadLights\" functionid=\"X=a:]Ue{RJTFC,RU,loN\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let scanningAnimOn = false\" numlines=\"1\" declaredvars=\"scanningAnimOn\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let isDistressMode = false\" numlines=\"1\" declaredvars=\"isDistressMode\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== Global State Variables ======</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"4oqX@Sm5hsjr5L@q1q]8\">RADIO_GROUP</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Radio setup ======\nMust be same on all bots</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">17</field></shadow></value><next><block type=\"radio_set_group\"><value name=\"ID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"255\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"4oqX@Sm5hsjr5L@q1q]8\">RADIO_GROUP</field></block></value><next><block type=\"radio_set_transmit_power\"><comment pinned=\"false\" h=\"80\" w=\"160\">Max power</comment><value name=\"power\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"7\" precision=\"0\"></mutation><field name=\"SLIDER\">7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"jf`~oRe.#J`a@InuozSt\">myId</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_device_serial_number\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"^j%oFTI0/$TbCv_zOML5\">MSG_ALERT</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Message types ======</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">ALERT</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"sp`5#c{[W6=1s*I*Hnw4\">MSG_BEACON</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">BEACON</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"jf$`u?l),0}^SVzOLf:D\">MSG_DONE</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">DONE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Motion/Scan Constants ======\nSpeed for initial scan</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">40</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"liklD]!o^2z}(nl{|/Ri\">SCAN_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Duration to listen per side</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">600</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"J:1.z!NNy8EbE$@BYrrJ\">SEEK_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Duration to turn towards target</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">400</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/{.{gesL4}[+ScsFHTZ/\">SETTLE_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Pause to stabilize</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"{.(Rz$4SehGaT*n]nm.6\">SLOW_FORWARD_SPEED</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Approach Constants ======</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">25</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"=/qz$L4$5LE^Ewh)(X?_\">SOUND_APPROACH_THRESH</field><comment pinned=\"false\" h=\"80\" w=\"160\">Stop if quieter than this</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">60</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"L{]I27XkQqE_8SF{_Fd(\">APPROACH_MAX_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Give up after 5 seconds</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">5000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"bl|Itb[pR8Bx@)g1(E_3\">QUIET_STOP_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">Stop if quiet for 0.5s</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">500</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Pk6w*/HWMmeO=5jMY*#|\">RESCAN_PERIOD_MS</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Re-scan Constants ======\nRe-check heading every 0.8s</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">800</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"`ZtNo]rEI3)e2u8)ija4\">SCAN_MS_SHORT</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">300</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"v!r$_l5kj#HbJv3zw9GT\">SEEK_MS_SHORT</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">250</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"xcl-z_vI^NsQUcuF4xAS\">APPROACH_TURN_SPEED</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\")INkiCZ/jx!V{N|j0^[`\">SOUND_WEIGHT</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Sensor Weights (0.0 to 1.0) ======\nTrust ears more</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\";_HxxO.~Vn:4GYeO*vls\">RSSI_WEIGHT</field><comment pinned=\"false\" h=\"80\" w=\"160\">Trust radio less</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.3</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m4]mq*CkgYrTE,{sC_Q-\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"|z#Bi3#k=-$LEoj~.DOG\">BEACON_TIMEOUT_MS</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">2000</field></shadow></value><next><block type=\"function_call\"><mutation name=\"monitorOrientation\" functionid=\"_g5CT4D-l:BIuas8Z6q@\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== Main Entry ======</comment><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"k{$lQzHu4Kwc2o~gDj5B\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"device_gesture_event\" x=\"1155\" y=\"20\"><field name=\"NAME\">Gesture.Shake</field><comment pinned=\"false\" h=\"80\" w=\"160\">Manual Shake Trigger</comment><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"enterDistressMode\" functionid=\"$Sx$FhNOV9NznMwK2(Iw\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"            basic.pause(3000);\" line2=\"            if (isDistressMode &amp;&amp; input.acceleration(Dimension.Z) &gt; -200) {\" line3=\"                exitDistressMode();\" line4=\"            }\" line5=\"        });\" numlines=\"6\"></mutation></block></next></block></statement></block></statement></block><block type=\"radio_on_value_drag\" x=\"2293\" y=\"20\"><data>1</data><value name=\"HANDLER_DRAG_PARAM_name\"><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"HANDLER_DRAG_PARAM_value\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\":s0#vocc2*9?#P^3nu`q\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"radio_received_packet\"><value name=\"type\"><shadow type=\"radio_packet_property\"><field name=\"note\">RadioPacketProperty.SignalStrength</field></shadow></value></block></value><next><block type=\"controls_if\"><mutation elseif=\"2\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^j%oFTI0/$TbCv_zOML5\">MSG_ALERT</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"nJfq+;#[}QkfzJ]t_FfX\">senderId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">NEQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"nJfq+;#[}QkfzJ]t_FfX\">senderId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"jf`~oRe.#J`a@InuozSt\">myId</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"U_{]GhqXa4o5Byiz?!l?\">isDistressMode</field></block></value></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"respondToAlert\" functionid=\"RsD/h=JDqX]s98,0$Ul;\"><arg name=\"senderId\" id=\"whyiryu2kkiomfi66j2qb\" type=\"number\"></arg></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Start Rescue!</comment><value name=\"whyiryu2kkiomfi66j2qb\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"nJfq+;#[}QkfzJ]t_FfX\">senderId</field></block></value></block></statement></block></next></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"sp`5#c{[W6=1s*I*Hnw4\">MSG_BEACON</field></block></value></block></value><statement name=\"DO1\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Only track the robot we are looking for</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"m4]mq*CkgYrTE,{sC_Q-\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":s0#vocc2*9?#P^3nu`q\">rssi</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"R~[E/Q~CT?p#Edsdj3uh\">lastBeaconTime</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></statement></block></statement><value name=\"IF2\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"jf$`u?l),0}^SVzOLf:D\">MSG_DONE</field></block></value></block></value><statement name=\"DO2\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</field><comment pinned=\"false\" h=\"80\" w=\"160\">Victim is happy, stop rescue</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"k{$lQzHu4Kwc2o~gDj5B\"></mutation></block></next></block></next></block></next></block></statement></block></statement></block></next></block></statement></block><block type=\"function_definition\" x=\"3164\" y=\"20\"><mutation name=\"calmLights\" functionid=\"k{$lQzHu4Kwc2o~gDj5B\"></mutation><field name=\"function_name\">calmLights</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== LED Control ======</comment><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"Mamdo$!Y;4_v3%)jMUPp\"></mutation><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"3595\" y=\"20\"><mutation name=\"sadLights\" functionid=\"X=a:]Ue{RJTFC,RU,loN\"></mutation><field name=\"function_name\">sadLights</field><statement name=\"STACK\"><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"Mamdo$!Y;4_v3%)jMUPp\"></mutation><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xff0000</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"4026\" y=\"20\"><mutation name=\"scanningLights\" functionid=\"?oCHj$obZ$6)YXTOP8Gg\"></mutation><field name=\"function_name\">scanningLights</field><statement name=\"STACK\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xffff00</field></shadow></value><next><block type=\"function_call\"><mutation name=\"scanningAnimationStart\" functionid=\"{Sn0TTI*Qvd%8G8:AR*X\"></mutation></block></next></block></statement></block><block type=\"function_definition\" x=\"4456\" y=\"20\"><mutation name=\"scanningAnimationStart\" functionid=\"{Sn0TTI*Qvd%8G8:AR*X\"></mutation><field name=\"function_name\">scanningAnimationStart</field><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i3QI.ZPW|rY@#gr;l9(Z\">scanningAnimOn</field></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i3QI.ZPW|rY@#gr;l9(Z\">scanningAnimOn</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        const frames = [\" line2=\"            images.createImage(`. . . . . \\n . . # . . \\n . # . # . \\n . . . . . \\n . . . . .`),\" line3=\"            images.createImage(`. . . . . \\n . . . . . \\n . . # . . \\n . . . . . \\n . . . . .`),\" line4=\"            images.createImage(`. . . . . \\n . . . . . \\n . # . # . \\n . . # . . \\n . . . . .`),\" line5=\"        ];\" line6=\"        let i = 0;\" line7=\"        while (scanningAnimOn) {\" line8=\"            frames[i].showImage(0);\" line9=\"            i = (i + 1) % frames.length;\" line10=\"            basic.pause(120);\" line11=\"        }\" line12=\"        basic.clearScreen();\" line13=\"    });\" numlines=\"14\"></mutation></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"20\" y=\"1906\"><mutation name=\"scanningAnimationStop\" functionid=\"Mamdo$!Y;4_v3%)jMUPp\"></mutation><field name=\"function_name\">scanningAnimationStop</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"i3QI.ZPW|rY@#gr;l9(Z\">scanningAnimOn</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value></block></statement></block><block type=\"function_definition\" x=\"450\" y=\"1906\"><mutation name=\"normSound\" functionid=\"/$qD{ZxSAhBsi=^v|c,l\"><arg name=\"v\" id=\"wmesznfx49nygom8tas3\" type=\"number\"></arg></mutation><field name=\"function_name\">normSound</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== Normalization Helpers ======</comment><value name=\"wmesznfx49nygom8tas3\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"kfi#zx$?dFkn7RV,{Jx^\">v</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"kfi#zx$?dFkn7RV,{Jx^\">v</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">v</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value></block></value></block></value></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"1035\" y=\"1906\"><mutation name=\"normRssi\" functionid=\"L3j6%NpfNt%yVYB/!{;r\"><arg name=\"rssi\" id=\"gsbsb20o5trvquels545\" type=\"number\"></arg></mutation><field name=\"function_name\">normRssi</field><value name=\"gsbsb20o5trvquels545\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"32VXQ{U`t0J44rf(!cMd\">MIN</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-95</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"f?|JGAT!0iW,::B}YoM7\">MAX</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-45</field></shadow></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"32VXQ{U`t0J44rf(!cMd\">MIN</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\":s0#vocc2*9?#P^3nu`q\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"32VXQ{U`t0J44rf(!cMd\">MIN</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"f?|JGAT!0iW,::B}YoM7\">MAX</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\":s0#vocc2*9?#P^3nu`q\">rssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"f?|JGAT!0iW,::B}YoM7\">MAX</field></block></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">rssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"32VXQ{U`t0J44rf(!cMd\">MIN</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"f?|JGAT!0iW,::B}YoM7\">MAX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"32VXQ{U`t0J44rf(!cMd\">MIN</field></block></value></block></value></block></value></block></value></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2968\" y=\"1906\"><mutation name=\"respondToAlert\" functionid=\"RsD/h=JDqX]s98,0$Ul;\"><arg name=\"senderId\" id=\"whyiryu2kkiomfi66j2qb\" type=\"number\"></arg></mutation><field name=\"function_name\">respondToAlert</field><value name=\"whyiryu2kkiomfi66j2qb\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">senderId</field></block></value><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">senderId</field></block></value><next><block type=\"function_call\"><mutation name=\"scanningLights\" functionid=\"?oCHj$obZ$6)YXTOP8Gg\"></mutation><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"A$KqR@Z8o+N32d=lf-:_\">leftScore</field><comment pinned=\"false\" h=\"80\" w=\"160\">1. Scan Left/Right to find direction</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanSide\" functionid=\"B7ft2b2x_S}3n%ia*B]~\"><arg name=\"leftSpeed\" id=\"drqps96fb52xn70edjd2\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"kagwbea375l4c6rt6hxed\" type=\"number\"></arg><arg name=\"duration\" id=\"oldsmjr07cds6bd54ue6\" type=\"number\"></arg></mutation><value name=\"drqps96fb52xn70edjd2\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value></block></value><value name=\"kagwbea375l4c6rt6hxed\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value><value name=\"oldsmjr07cds6bd54ue6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"liklD]!o^2z}(nl{|/Ri\">SCAN_MS</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/{.{gesL4}[+ScsFHTZ/\">SETTLE_MS</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"]7o$z,jX.rE-+H/#O,#Q\">rightScore</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"scanSide\" functionid=\"B7ft2b2x_S}3n%ia*B]~\"><arg name=\"leftSpeed\" id=\"drqps96fb52xn70edjd2\" type=\"number\"></arg><arg name=\"rightSpeed\" id=\"kagwbea375l4c6rt6hxed\" type=\"number\"></arg><arg name=\"duration\" id=\"oldsmjr07cds6bd54ue6\" type=\"number\"></arg></mutation><value name=\"drqps96fb52xn70edjd2\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value><value name=\"kagwbea375l4c6rt6hxed\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value></block></value><value name=\"oldsmjr07cds6bd54ue6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"liklD]!o^2z}(nl{|/Ri\">SCAN_MS</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/{.{gesL4}[+ScsFHTZ/\">SETTLE_MS</field></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">2. Pivot towards winner</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"A$KqR@Z8o+N32d=lf-:_\">leftScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"]7o$z,jX.rE-+H/#O,#Q\">rightScore</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"J:1.z!NNy8EbE$@BYrrJ\">SEEK_MS</field></block></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y9`(g!Q|q|17/e94X90T\">TURN_SPEED</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"J:1.z!NNy8EbE$@BYrrJ\">SEEK_MS</field></block></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"sadLights\" functionid=\"X=a:]Ue{RJTFC,RU,loN\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">3. Empathize and Approach</comment><next><block type=\"SoundExpression_play\"><field name=\"this\">soundExpression.sad</field><next><block type=\"function_call\"><mutation name=\"approachWhileLoudWithRescan\" functionid=\"[Y1*wJmdgZ0I4c2r2@7o\"></mutation><next><block type=\"function_call\"><mutation name=\"scanningAnimationStop\" functionid=\"Mamdo$!Y;4_v3%)jMUPp\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">4. Reset</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"o@tb=n|_7r`!ik4pFKnD\">scanning</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/r6OB-%U!^STyZR5XY4H\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\"k{$lQzHu4Kwc2o~gDj5B\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>","main.ts":"","README.md":"","main.py":"# ============== Radio setup ==============\nRADIO_GROUP = 17\n# Must be same on all bots\nradio.set_group(RADIO_GROUP)\nradio.set_transmit_power(7)\n# Max power\nmyId = control.device_serial_number()\n# ============== Message types ==============\nMSG_ALERT = \"ALERT\"\nMSG_BEACON = \"BEACON\"\nMSG_DONE = \"DONE\"\n# ============== Motion / Scan Constants ==============\nTURN_SPEED = 40\n# Speed for initial scan\nSCAN_MS = 600\n# Duration to listen per side (ms)\nSEEK_MS = 400\n# Duration to turn towards target (ms)\nSETTLE_MS = 100\n# Pause to stabilize (ms)\n# ============== Approach Constants ==============\nSLOW_FORWARD_SPEED = 25\nSOUND_APPROACH_THRESH = 60\n# Stop if quieter than this\nAPPROACH_MAX_MS = 5000\n# Give up after 5 seconds\nQUIET_STOP_MS = 500\n# Stop if quiet for 0.5s\n# ============== Re-scan Constants ==============\nRESCAN_PERIOD_MS = 800\n# Re-check heading every 0.8s\nSCAN_MS_SHORT = 300\nSEEK_MS_SHORT = 250\nAPPROACH_TURN_SPEED = 35\n# ============== Sensor Weights (0–100 scaled) ==============\nSOUND_WEIGHT = 0.7\n# Trust ears more\nRSSI_WEIGHT = 0.3\n# Trust radio less\n# ============== Global State Variables ==============\nisDistressMode = False\nscanning = False\nscanningAnimOn = False\n# Target tracking\ntargetId = 0\ncurrentRSSI = -128\nlastBeaconTime = 0\nBEACON_TIMEOUT_MS = 2000\n# =============================================\n# =========== PART 1: DISTRESS MODE ===========\n# =============================================\n# Orientation monitor – runs forever\n\ndef on_forever():\n    global isDistressMode\n    accelZ = input.acceleration(Dimension.Z)\n    # Flip down → distress\n    # Flip back up → exit distress\n    if accelZ < -600 and not isDistressMode:\n        enterDistressMode()\n    elif accelZ > 200 and isDistressMode:\n        exitDistressMode()\n    basic.pause(50)\nbasic.forever(on_forever)\n\ndef enterDistressMode():\n    global isDistressMode, scanning\n    if isDistressMode:\n        return\n    isDistressMode = True\n    scanning = False\n    # Stop rescuing others if I am hurt\n    cuteBot.stopcar()\n    sadLights()\n    radio.send_value(MSG_ALERT, myId)\n    # Continuous distress loop in background\n    \n    def on_in_background():\n        while isDistressMode:\n            # Broadcast beacon for RSSI tracking\n            radio.send_value(MSG_BEACON, myId)\n            # Play sad sound (non-blocking is nicer, but play is okay)\n            soundExpression.sad.play()\n            # Randomly re-send ALERT packet\n            if Math.random_boolean():\n                radio.send_value(MSG_ALERT, myId)\n            basic.pause(600)\n    control.in_background(on_in_background)\n    \ndef exitDistressMode():\n    global isDistressMode\n    isDistressMode = False\n    radio.send_value(MSG_DONE, myId)\n    calmLights()\n# Manual shake trigger\n\ndef on_gesture_shake():\n    global isDistressMode\n    if not isDistressMode:\n        enterDistressMode()\n        # Force sadness for at least 3 seconds on shake\n        \n        def on_in_background2():\n            basic.pause(3000)\n            if isDistressMode and input.acceleration(Dimension.Z) > -200:\n                exitDistressMode()\n        control.in_background(on_in_background2)\n        \ninput.on_gesture(Gesture.SHAKE, on_gesture_shake)\n\n# =============================================\n# =========== PART 2: RESCUER LOGIC ===========\n# =============================================\n\ndef on_received_value(name, value):\n    global isDistressMode, scanning, currentRSSI, lastBeaconTime, targetId\n    rssi = radio.received_packet(RadioPacketProperty.SIGNAL_STRENGTH)\n    if name == MSG_ALERT:\n        senderId = value\n        if senderId != myId and not isDistressMode and not scanning:\n            # Start rescue!\n            respondToAlert(senderId)\n    elif name == MSG_BEACON:\n        # Only track the robot we are looking for\n        if targetId == 0 or value == targetId:\n            currentRSSI = rssi\n            lastBeaconTime = input.running_time()\n    elif name == MSG_DONE:\n        if value == targetId:\n            # Victim is happy, stop rescue\n            scanning = False\n            targetId = 0\n            cuteBot.stopcar()\n            calmLights()\nradio.on_received_value(on_received_value)\n\ndef respondToAlert(senderId2: number):\n    global scanning, targetId, TURN_SPEED\n    scanning = True\n    targetId = senderId2\n    scanningLights()\n    basic.pause(200)\n    # 1. Scan left/right to find direction\n    leftScore = scanSide(-TURN_SPEED, TURN_SPEED, SCAN_MS)\n    basic.pause(SETTLE_MS)\n    rightScore = scanSide(TURN_SPEED, -TURN_SPEED, SCAN_MS)\n    basic.pause(SETTLE_MS)\n    # 2. Pivot towards winner\n    if leftScore > rightScore:\n        cuteBot.motors(-TURN_SPEED, TURN_SPEED)\n        basic.pause(SEEK_MS)\n    else:\n        cuteBot.motors(TURN_SPEED, -TURN_SPEED)\n        basic.pause(SEEK_MS)\n    cuteBot.stopcar()\n    # 3. Empathize and approach\n    sadLights()\n    soundExpression.sad.play()\n    approachWhileLoudWithRescan()\n    # 4. Reset\n    scanningAnimationStop()\n    scanning = False\n    targetId = 0\n    calmLights()\n# Scan one direction and return a score combining sound & RSSI\ndef scanSide(leftSpeed: number, rightSpeed: number, duration: number):\n    cuteBot.motors(leftSpeed, rightSpeed)\n    soundMax = 0\n    rssiMax = -128\n    t0 = input.running_time()\n    while input.running_time() - t0 < duration:\n        s = input.sound_level()\n        if s > soundMax:\n            soundMax = s\n        if input.running_time() - lastBeaconTime < BEACON_TIMEOUT_MS:\n            if currentRSSI > rssiMax:\n                rssiMax = currentRSSI\n        basic.pause(10)\n    cuteBot.stopcar()\n    soundScore = normSound(soundMax)\n    rssiScore = normRssi(rssiMax)\n    return SOUND_WEIGHT * soundScore + RSSI_WEIGHT * rssiScore\n# Approach loop with periodic re-scan (\"wiggle\")\ndef approachWhileLoudWithRescan():\n    tStart = input.running_time()\n    quietStart = 0\n    lastRescan = input.running_time()\n    cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED)\n    while input.running_time() - tStart < APPROACH_MAX_MS:\n        # Safety: if we get flipped during rescue, enter distress\n        if isDistressMode:\n            cuteBot.stopcar()\n            return\n        # Volume check\n        t = input.sound_level()\n        if t >= SOUND_APPROACH_THRESH:\n            quietStart = 0\n        else:\n            if quietStart == 0:\n                quietStart = input.running_time()\n            if input.running_time() - quietStart >= QUIET_STOP_MS:\n                break\n        # Periodic re-scan to adjust heading\n        if input.running_time() - lastRescan >= RESCAN_PERIOD_MS:\n            cuteBot.stopcar()\n            briefRescanAndAdjust()\n            cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED)\n            lastRescan = input.running_time()\n        basic.pause(20)\n    cuteBot.stopcar()\ndef briefRescanAndAdjust():\n    global APPROACH_TURN_SPEED\n    scanningLights()\n    # Quick left/right check\n    left = scanSide(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED, SCAN_MS_SHORT)\n    basic.pause(50)\n    right = scanSide(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED, SCAN_MS_SHORT)\n    if left > right:\n        cuteBot.motors(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED)\n        basic.pause(SEEK_MS_SHORT)\n    else:\n        cuteBot.motors(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED)\n        basic.pause(SEEK_MS_SHORT)\n    cuteBot.stopcar()\n    sadLights()\n# ============== Normalization Helpers ==============\ndef normSound(v: number):\n    if v < 0:\n        v = 0\n    if v > 255:\n        v = 255\n    return Math.round(v * 100 / 255)\ndef normRssi(rssi2: number):\n    MIN = -95\n    MAX = -45\n    if rssi2 < MIN:\n        rssi2 = MIN\n    if rssi2 > MAX:\n        rssi2 = MAX\n    return Math.round((rssi2 - MIN) * 100 / (MAX - MIN))\n# ============== LED / Display Control ==============\ndef calmLights():\n    scanningAnimationStop()\n    cuteBot.color_light(cuteBot.RGBLights.ALL, 0x00ff00)\n    basic.show_icon(IconNames.HAPPY)\ndef sadLights():\n    scanningAnimationStop()\n    cuteBot.color_light(cuteBot.RGBLights.ALL, 0xff0000)\n    basic.show_icon(IconNames.SAD)\ndef scanningLights():\n    cuteBot.color_light(cuteBot.RGBLights.ALL, 0xffff00)\n    scanningAnimationStart()\ndef scanningAnimationStart():\n    global scanningAnimOn\n    if scanningAnimOn:\n        return\n    scanningAnimOn = True\n    \n    def on_in_background3():\n        frames = [images.create_image(\"\"\"\n                . . . . .\n                . . # . .\n                . # . # .\n                . . . . .\n                . . . . .\n                \"\"\"),\n            images.create_image(\"\"\"\n                . . . . .\n                . . . . .\n                . . # . .\n                . . . . .\n                . . . . .\n                \"\"\"),\n            images.create_image(\"\"\"\n                . . . . .\n                . . . . .\n                . # . # .\n                . . # . .\n                . . . . .\n                \"\"\")]\n        i = 0\n        while scanningAnimOn:\n            frames[i].show_image(0)\n            i = (i + 1) % len(frames)\n            basic.pause(120)\n        basic.clear_screen()\n    control.in_background(on_in_background3)\n    \ndef scanningAnimationStop():\n    global scanningAnimOn\n    scanningAnimOn = False\n# ============== Main startup ==============\ncalmLights()","pxt.json":"{\n    \"name\": \"p5_test\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\",\n        \"radio-broadcast\": \"*\",\n        \"cutebot\": \"github:elecfreaks/pxt-cutebot#v6.2.4\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"main.py\"\n    ],\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1764919859778,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"rY``U82f+l}m!$b62n,0\">incomingRSSI</variable><variable id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</variable><variable id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</variable><variable id=\"x)?P!*kQ*btFCrr[F:jz\">isRescuing</variable><variable id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</variable><variable id=\"6+E?:H12lp}B,k]}*Kj:\">hasAckedVictim</variable><variable id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</variable><variable id=\"C$Rj^jNF)qN:9S#0ROt(\">lastBeaconTime</variable><variable id=\"B}DK8L-f:,0di,_h56B=\">z</variable><variable id=\"KG/#g%p_|yTtNn{_l]iv\">initialRssi</variable><variable id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</variable><variable id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</variable><variable id=\"s*ze$Il{!/0n$u+e/Q_1\">searchStart</variable><variable id=\"KplJ~1!rcO~gq4piu7eu\">prevRssi</variable><variable id=\"0|;~!_A|Q=FL)CG*UFYA\">prevSound</variable><variable id=\"b=(_@6G=PnYR@Gy_*5rw\">MAX_SEARCH_TIME</variable><variable id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</variable><variable id=\"NOfOh_x_;r@TSj4lhp-A\">RSSI_ARRIVED_THRESH</variable><variable id=\"y$$%*Q}f7}t.(Z8VkE:+\">SOUND_THRESHOLD</variable><variable id=\"RxfS;;W$NMDzU[?0D^bY\">rssiImproved</variable><variable id=\"CWJ]wl,[LhL.aWzS//C6\">soundImproved</variable><variable id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</variable><variable id=\"I)e)PsW;u?:$:dD;zy5z\">scanDuration</variable><variable id=\"(;Ntaw;-?c+g{8@;{SQI\">oldWsound</variable><variable id=\";de-l)|7%r5b$IeL_:2+\">oldWrssi</variable><variable id=\"A8WAVqg{}1929!R$WQ+s\">leftScore</variable><variable id=\"?WZx!:yJ`H6nk,24SfF2\">rightScore</variable><variable id=\"U.SWQ:ll)GzF@;anb5SR\">maxRssi</variable><variable id=\"]I)L9(zK?]bOg4[ad{%#\">t0</variable><variable id=\"{pDBWA?bYmHA=6ffrZg2\">s</variable><variable id=\"fn5Z~!e9bR`{$7ShN{Fo\">maxSound</variable><variable id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</variable><variable id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</variable><variable id=\"GdA+W9SB6$.oIB$%DF2}\">RADIO_GROUP</variable></variables><comment x=\"0\" y=\"0\" w=\"420\" h=\"120\">\n==========================================\n====== 4. HELPERS ========================\n</comment><comment x=\"0\" y=\"0\" w=\"420\" h=\"120\">\n==========================================\n====== CONFIGURATION &amp; CONSTANTS =========\n==========================================\n</comment><comment x=\"0\" y=\"0\" w=\"420\" h=\"160\">\nLast time we heard BEACON\n==========================================\n====== INITIAL SETUP =====================\n==========================================\n</comment><comment x=\"0\" y=\"0\" w=\"250\" h=\"120\">\nAm I currently searching?\n</comment><comment x=\"0\" y=\"0\" w=\"250\" h=\"120\">\nHave I ACKed this victim?\n</comment><block type=\"control_in_background\" x=\"10\" y=\"10\"><comment pinned=\"false\" h=\"80\" w=\"160\">Orientation watcher (flip to become victim)</comment><data>1</data><statement name=\"HANDLER\"><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"B}DK8L-f:,0di,_h56B=\">z</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_acceleration\"><field name=\"NAME\">Dimension.Z</field></block></value><next><block type=\"controls_if\"><mutation elseif=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"B}DK8L-f:,0di,_h56B=\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-600</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"becomeVictim\" functionid=\"b3sU]HaV)sxdn8mVwx}Q\"></mutation></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"B}DK8L-f:,0di,_h56B=\">z</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value></block></value><statement name=\"DO1\"><block type=\"function_call\"><mutation name=\"becomeSafe\" functionid=\"*C}8e`@?jCtA(c)ionVQ\"></mutation></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value></block></next></block></next></block></statement></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"becomeVictim\" functionid=\"b3sU]HaV)sxdn8mVwx}Q\"></mutation><field name=\"function_name\">becomeVictim</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"x)?P!*kQ*btFCrr[F:jz\">isRescuing</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">RED</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xff0000</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Sad</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"radio_datagram_send_value\"><comment pinned=\"false\" h=\"80\" w=\"160\">Initial ALERT with my ID</comment><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">ALERT</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</field></block></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"control.runInParallel(function () {\" line1=\"        while (isDistressMode) {\" line2=\"            radio.sendValue(&quot;BEACON&quot;, MY_SERIAL);\" line3=\"            soundExpression.sad.play();\" line4=\"            basic.pause(500);\" line5=\"        }\" line6=\"    });\" numlines=\"7\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"becomeSafe\" functionid=\"*C}8e`@?jCtA(c)ionVQ\"></mutation><field name=\"function_name\">becomeSafe</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"radio_datagram_send_value\"><comment pinned=\"false\" h=\"80\" w=\"160\">Tell any rescuer to stop</comment><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">SAFE</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</field></block></value><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"cxe$J~zhO#l3VFne!Fqr\"></mutation></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"startRescueRoutine\" functionid=\"L9)+nc5~AGYN$yQM?~Y{\"></mutation><field name=\"function_name\">startRescueRoutine</field><data>2</data><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"x)?P!*kQ*btFCrr[F:jz\">isRescuing</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Send ACK once to victim: \"I got your alert\"</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"6+E?:H12lp}B,k]}*Kj:\">hasAckedVictim</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">NEQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"radio_datagram_send_value\"><value name=\"name\"><shadow type=\"text\"><field name=\"TEXT\">ACK</field></shadow></value><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"6+E?:H12lp}B,k]}*Kj:\">hasAckedVictim</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value></block></next></block></statement><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">YELLOW</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0xffff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Target</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"KG/#g%p_|yTtNn{_l]iv\">initialRssi</field><comment pinned=\"false\" h=\"80\" w=\"160\">Set initial weights based on first RSSI</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"KG/#g%p_|yTtNn{_l]iv\">initialRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-70</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Already fairly close</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.8</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.2</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"variables_set\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Far away; trust radio more initially</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.4</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.6</field></shadow></value></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"s*ze$Il{!/0n$u+e/Q_1\">searchStart</field><comment pinned=\"false\" h=\"80\" w=\"160\">Iterative search loop: scan → step → evaluate</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"KplJ~1!rcO~gq4piu7eu\">prevRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"0|;~!_A|Q=FL)CG*UFYA\">prevSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"s*ze$Il{!/0n$u+e/Q_1\">searchStart</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"b=(_@6G=PnYR@Gy_*5rw\">MAX_SEARCH_TIME</field></block></value></block></value><statement name=\"DO\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"cutebot_stopcar\"><comment pinned=\"false\" h=\"80\" w=\"160\">This bot flipped while rescuing; it is now a victim</comment><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">1) Combined success condition: strong radio + strong sound</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"NOfOh_x_;r@TSj4lhp-A\">RSSI_ARRIVED_THRESH</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">NEQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y$$%*Q}f7}t.(Z8VkE:+\">SOUND_THRESHOLD</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"missionSuccess\" functionid=\"{tv0`z@heWwi=K97(MC!\"></mutation><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></statement><next><block type=\"function_call\"><mutation name=\"stepSearch\" functionid=\"z5wSE|_(T|xIs1ILvb6p\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">2) Perform one local search step (small scan + forward move)</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"RxfS;;W$NMDzU[?0D^bY\">rssiImproved</field><comment pinned=\"false\" h=\"80\" w=\"160\">3) Trend check: did both signals get worse?</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"KplJ~1!rcO~gq4piu7eu\">prevRssi</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"CWJ]wl,[LhL.aWzS//C6\">soundImproved</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"0|;~!_A|Q=FL)CG*UFYA\">prevSound</field></block></value></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"RxfS;;W$NMDzU[?0D^bY\">rssiImproved</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"CWJ]wl,[LhL.aWzS//C6\">soundImproved</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Both degraded: back up slightly and re-orient</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-25</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-25</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">300</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"stepSearch\" functionid=\"z5wSE|_(T|xIs1ILvb6p\"></mutation></block></next></block></next></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"KplJ~1!rcO~gq4piu7eu\">prevRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"0|;~!_A|Q=FL)CG*UFYA\">prevSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</field></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">4) If both are very weak, assume we lost the trail</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">-90</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i,U+@lKlc:f${7wSHjKG\">soundNow</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y$$%*Q}f7}t.(Z8VkE:+\">SOUND_THRESHOLD</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"break_keyword\"></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"cxe$J~zhO#l3VFne!Fqr\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"stepSearch\" functionid=\"z5wSE|_(T|xIs1ILvb6p\"></mutation><field name=\"function_name\">stepSearch</field><comment pinned=\"false\" h=\"80\" w=\"160\">=== One search step: small scan left/right + forward burst ===</comment><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">35</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"I)e)PsW;u?:$:dD;zy5z\">scanDuration</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">300</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"(;Ntaw;-?c+g{8@;{SQI\">oldWsound</field><comment pinned=\"false\" h=\"80\" w=\"160\">Temporarily equalize weights while orienting</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\";de-l)|7%r5b$IeL_:2+\">oldWrssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.5</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.5</field></shadow></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Scan left</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"A8WAVqg{}1929!R$WQ+s\">leftScore</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"sampleScore\" functionid=\"Ur[SWLmDV~N6N|QzF2WP\"><arg name=\"durationMs\" id=\"mx1nu03k9e45djk4nq53\" type=\"number\"></arg></mutation><value name=\"mx1nu03k9e45djk4nq53\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"I)e)PsW;u?:$:dD;zy5z\">scanDuration</field></block></value></block></value><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">100</field></shadow></value><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Scan right</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"?WZx!:yJ`H6nk,24SfF2\">rightScore</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"sampleScore\" functionid=\"Ur[SWLmDV~N6N|QzF2WP\"><arg name=\"durationMs\" id=\"mx1nu03k9e45djk4nq53\" type=\"number\"></arg></mutation><value name=\"mx1nu03k9e45djk4nq53\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"I)e)PsW;u?:$:dD;zy5z\">scanDuration</field></block></value></block></value><next><block type=\"cutebot_stopcar\"><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">100</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">Turn toward better score</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"A8WAVqg{}1929!R$WQ+s\">leftScore</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"?WZx!:yJ`H6nk,24SfF2\">rightScore</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";6PgW1%+n|0;5Sj8|wu5\">scanTurnSpeed</field></block></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value></block></next></block></statement><next><block type=\"cutebot_stopcar\"><next><block type=\"MotorRun\"><comment pinned=\"false\" h=\"80\" w=\"160\">Short forward move</comment><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">30</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">30</field></shadow></value><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">BLUE while moving</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x0000ff</field></shadow></value><next><block type=\"device_pause\"><data>{\"commentRefs\":[],\"fieldData\":{}}</data><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">400</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"variables_set\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Restore previous weights</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"(;Ntaw;-?c+g{8@;{SQI\">oldWsound</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";de-l)|7%r5b$IeL_:2+\">oldWrssi</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"sampleScore\" functionid=\"Ur[SWLmDV~N6N|QzF2WP\"><arg name=\"durationMs\" id=\"mx1nu03k9e45djk4nq53\" type=\"number\"></arg></mutation><field name=\"function_name\">sampleScore</field><comment pinned=\"false\" h=\"80\" w=\"160\">=== Sample hybrid score over given duration ===</comment><value name=\"mx1nu03k9e45djk4nq53\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">durationMs</field></block></value><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"U.SWQ:ll)GzF@;anb5SR\">maxRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-128</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"]I)L9(zK?]bOg4[ad{%#\">t0</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><next><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"]I)L9(zK?]bOg4[ad{%#\">t0</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">durationMs</field></block></value></block></value><statement name=\"DO\"><block type=\"variables_set\"><field name=\"VAR\" id=\"{pDBWA?bYmHA=6ffrZg2\">s</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{pDBWA?bYmHA=6ffrZg2\">s</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"fn5Z~!e9bR`{$7ShN{Fo\">maxSound</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"fn5Z~!e9bR`{$7ShN{Fo\">maxSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{pDBWA?bYmHA=6ffrZg2\">s</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"U.SWQ:ll)GzF@;anb5SR\">maxRssi</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"U.SWQ:ll)GzF@;anb5SR\">maxRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field></block></value></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_map\"><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"fn5Z~!e9bR`{$7ShN{Fo\">maxSound</field></block></value><value name=\"fromLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"fromHigh\"><shadow type=\"math_number\"><field name=\"NUM\">255</field></shadow></value><value name=\"toLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"toHigh\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_map\"><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"U.SWQ:ll)GzF@;anb5SR\">maxRssi</field></block></value><value name=\"fromLow\"><shadow type=\"math_number\"><field name=\"NUM\">-95</field></shadow></value><value name=\"fromHigh\"><shadow type=\"math_number\"><field name=\"NUM\">-40</field></shadow></value><value name=\"toLow\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"toHigh\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"IIe|wns;f~^UGCW6/AJ=\">normSound</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"gzIAyvE%aVhhp`r}]cpw\">normRssi</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field></block></value></block></value></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"missionSuccess\" functionid=\"{tv0`z@heWwi=K97(MC!\"></mutation><field name=\"function_name\">missionSuccess</field><statement name=\"STACK\"><block type=\"cutebot_stopcar\"><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Extra sanity check on sound: if too low, back off &amp; retry once</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_sound_level\"></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"y$$%*Q}f7}t.(Z8VkE:+\">SOUND_THRESHOLD</field></block></value></block></value><statement name=\"DO0\"><block type=\"MotorRun\"><value name=\"lspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-25</field></shadow></value><value name=\"rspeed\"><shadow type=\"math_number_minmax\"><mutation min=\"-100\" max=\"100\" precision=\"0\"></mutation><field name=\"SLIDER\">-25</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">400</field></shadow></value><next><block type=\"cutebot_stopcar\"><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"startRescueRoutine\" functionid=\"L9)+nc5~AGYN$yQM?~Y{\"></mutation></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"true\"></mutation></block></next></block></next></block></next></block></next></block></statement><next><block type=\"controls_repeat_ext\"><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">3</field></shadow></value><statement name=\"DO\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">GREEN</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Heart</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x000000</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value></block></next></block></next></block></next></block></next></block></statement><next><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"cxe$J~zhO#l3VFne!Fqr\"></mutation></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"10\" y=\"10\"><mutation name=\"resetSystem\" functionid=\"cxe$J~zhO#l3VFne!Fqr\"></mutation><field name=\"function_name\">resetSystem</field><data>3</data><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"x)?P!*kQ*btFCrr[F:jz\">isRescuing</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"6+E?:H12lp}B,k]}*Kj:\">hasAckedVictim</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\";LA!V7k=y)l})-mv2?fe\"></mutation></block></next></block></next></block></next></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let isDistressMode = false\" numlines=\"1\" declaredvars=\"isDistressMode\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">====== STATE VARIABLES ======\nAm I the victim?</comment><next><block type=\"variables_set\"><field name=\"VAR\" id=\"GdA+W9SB6$.oIB$%DF2}\">RADIO_GROUP</field><data>4</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">17</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_device_serial_number\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"y$$%*Q}f7}t.(Z8VkE:+\">SOUND_THRESHOLD</field><comment pinned=\"false\" h=\"80\" w=\"160\">====== TUNING CONSTANTS ======\nHow loud to be considered \"crying\"</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">60</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"NOfOh_x_;r@TSj4lhp-A\">RSSI_ARRIVED_THRESH</field><comment pinned=\"false\" h=\"80\" w=\"160\">Strong signal =&gt; very close</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-55</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"b=(_@6G=PnYR@Gy_*5rw\">MAX_SEARCH_TIME</field><comment pinned=\"false\" h=\"80\" w=\"160\">Max search time (ms)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">8000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"v|`^f,K9j}md3[0Cf~NT\">W_SOUND</field><comment pinned=\"false\" h=\"80\" w=\"160\">Default weights for decision (Sound vs Radio)</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.7</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"~3ZUO$Rvy`p9dXALIh{Q\">W_RSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.3</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field><comment pinned=\"false\" h=\"80\" w=\"160\">Victim ID I'm rescuing\nLatest RSSI from target</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-100</field></shadow></value><next><block type=\"radio_set_group\"><data>5</data><value name=\"ID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"255\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"GdA+W9SB6$.oIB$%DF2}\">RADIO_GROUP</field></block></value><next><block type=\"radio_set_transmit_power\"><value name=\"power\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"7\" precision=\"0\"></mutation><field name=\"SLIDER\">7</field></shadow></value><next><block type=\"function_call\"><mutation name=\"calmLights\" functionid=\";LA!V7k=y)l})-mv2?fe\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"radio_on_value_drag\" x=\"2293\" y=\"20\"><data>0</data><value name=\"HANDLER_DRAG_PARAM_name\"><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"HANDLER_DRAG_PARAM_value\"><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"rY``U82f+l}m!$b62n,0\">incomingRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"radio_received_packet\"><value name=\"type\"><shadow type=\"radio_packet_property\"><field name=\"note\">RadioPacketProperty.SignalStrength</field></shadow></value></block></value><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Ignore my own packets by ID (avoid self-trigger)</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</field></block></value></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"return;\" numlines=\"1\"></mutation></block></statement><next><block type=\"controls_if\"><mutation elseif=\"3\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">ALERT</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Victim must not react to alerts (it IS the one in trouble)</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"return;\" numlines=\"1\"></mutation></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">If already rescuing someone, ignore new alerts</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"x)?P!*kQ*btFCrr[F:jz\">isRescuing</field></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"return;\" numlines=\"1\"></mutation></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field><comment pinned=\"false\" h=\"80\" w=\"160\">Become rescuer for this victim</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"6+E?:H12lp}B,k]}*Kj:\">hasAckedVictim</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"function_call\"><mutation name=\"startRescueRoutine\" functionid=\"L9)+nc5~AGYN$yQM?~Y{\"></mutation></block></next></block></next></block></next></block></next></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">BEACON</field></block></value></block></value><statement name=\"DO1\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Only track BEACON from the victim I'm rescuing</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field></block></value></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"HJb#8kKh!Av8KN^jDW*+\">currentRSSI</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"rY``U82f+l}m!$b62n,0\">incomingRSSI</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"C$Rj^jNF)qN:9S#0ROt(\">lastBeaconTime</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"></block></value></block></next></block></statement></block></statement><value name=\"IF2\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">SAFE</field></block></value></block></value><statement name=\"DO2\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Victim says it is safe; rescuer stops</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_negate\"><value name=\"BOOL\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"w/f:@m?(C5Q;hx0GD3rA\">targetId</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"resetSystem\" functionid=\"cxe$J~zhO#l3VFne!Fqr\"></mutation></block></statement></block></statement><value name=\"IF3\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_string\"><field name=\"VALUE\">name</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">ACK</field></block></value></block></value><statement name=\"DO3\"><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">Only victim with that ID cares\nRescuer acknowledged; victim just keeps beeping and does NOT become rescuer</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"^he4T:yl%Yy,gBPLCb7Y\">isDistressMode</field></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">value</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"e+2!X=;fqukEU5)Mmy:{\">MY_SERIAL</field></block></value></block></value></block></value></block></statement></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"3164\" y=\"20\"><mutation name=\"calmLights\" functionid=\";LA!V7k=y)l})-mv2?fe\"></mutation><field name=\"function_name\">calmLights</field><statement name=\"STACK\"><block type=\"cuteBot_colorLight\"><field name=\"light\">cuteBot.RGBLights.ALL</field><comment pinned=\"false\" h=\"80\" w=\"160\">GREEN</comment><value name=\"color\"><shadow type=\"colorNumberPicker\"><field name=\"value\">0x00ff00</field></shadow></value><next><block type=\"basic_show_icon\"><field name=\"i\">IconNames.Happy</field><data>{\"commentRefs\":[],\"fieldData\":{}}</data></block></next></block></statement></block></xml>","main.ts":"// ====== CONFIGURATION ======\nconst RADIO_GROUP = 17;\nconst MY_SERIAL = control.deviceSerialNumber();\n\n// ====== TUNING CONSTANTS ======\nconst SOUND_THRESHOLD = 60; // How loud to be considered \"crying\"\nconst RSSI_ARRIVED_THRESH = -55; // Signal strength indicating we are VERY close (Stop)\nconst MAX_SEARCH_TIME = 6000; // Give up after 6 seconds if not found\n\n// Weights for decision (Sound vs Radio)\nconst W_SOUND = 0.7;\nconst W_RSSI = 0.3;\n\n// ====== STATE VARIABLES ======\nlet isDistressMode = false; // Am I the victim?\nlet isRescuing = false; // Am I currently looking for someone?\n\n// Track the target\nlet targetId = 0;\nlet currentRSSI = -100;\nlet lastBeaconTime = 0;\n\n// Setup\nradio.setGroup(RADIO_GROUP);\nradio.setTransmitPower(7); // Max power\ncalmLights();\n\n// ==========================================\n// === 1. RADIO HANDLER (THE \"EARPLUGS\" FIX)\n// ==========================================\nradio.onReceivedValue(function (name: string, value: number) {\n    // CRITICAL FIX: If I am the victim, IGNORE everything.\n    // I am the one screaming, I cannot rescue anyone.\n    if (isDistressMode) {\n        return;\n    }\n\n    // Capture Signal Strength\n    const incomingRSSI = radio.receivedPacket(RadioPacketProperty.SignalStrength);\n\n    if (name == \"ALERT\") {\n        // Only start rescue if I'm not already busy\n        if (!isRescuing) {\n            targetId = value; // Lock onto this specific ID\n            startRescueRoutine();\n        }\n    }\n    else if (name == \"BEACON\") {\n        // Only listen to the robot I am tracking\n        if (targetId == 0 || value == targetId) {\n            currentRSSI = incomingRSSI;\n            lastBeaconTime = input.runningTime();\n        }\n    }\n    else if (name == \"SAFE\") {\n        // Victim is safe, reset everything\n        if (value == targetId) {\n            resetSystem();\n        }\n    }\n});\n\n// ==========================================\n// === 2. VICTIM LOGIC (ONE-WAY SIGNAL) =====\n// ==========================================\n\n// Monitor orientation in background (Fast Reaction)\ncontrol.inBackground(function () {\n    while (true) {\n        const z = input.acceleration(Dimension.Z);\n\n        // Flip detected (Upside down) -> Become Victim\n        if (z < -600 && !isDistressMode) {\n            becomeVictim();\n        }\n        // Flipped back up -> Become Safe\n        else if (z > 200 && isDistressMode) {\n            becomeSafe();\n        }\n        basic.pause(50);\n    }\n});\n\nfunction becomeVictim() {\n    isDistressMode = true;\n    isRescuing = false; // Stop everything else\n    cuteBot.stopcar();\n\n    // VISUALS\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xff0000); // RED\n    basic.showIcon(IconNames.Sad);\n\n    // RADIO: Send initial Alert\n    radio.sendValue(\"ALERT\", MY_SERIAL);\n\n    // BACKGROUND LOOP: Continuous Beacon & Sound\n    control.runInParallel(function () {\n        while (isDistressMode) {\n            // 1. Send Beacon (for others to track RSSI)\n            radio.sendValue(\"BEACON\", MY_SERIAL);\n\n            // 2. Make Noise\n            soundExpression.sad.play();\n\n            // 3. Occasionally re-send ALERT (in case rescuers missed it)\n            if (Math.randomBoolean()) {\n                radio.sendValue(\"ALERT\", MY_SERIAL);\n            }\n\n            basic.pause(500); // Pulse every 0.5s\n        }\n    });\n}\n\nfunction becomeSafe() {\n    isDistressMode = false;\n    radio.sendValue(\"SAFE\", MY_SERIAL); // Tell rescuers to stop\n    resetSystem();\n}\n\n// ==========================================\n// === 3. RESCUER LOGIC (IMPROVED APPROACH) =\n// ==========================================\n\nfunction startRescueRoutine() {\n    isRescuing = true;\n\n    // Acknowledge Phase\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0xffff00); // YELLOW\n    basic.showIcon(IconNames.Target);\n    basic.pause(500); // Listen for a moment to get initial RSSI\n\n    // --- STEP 1: SCAN ---\n    // Compare Left vs Right to find the strongest signal\n    let leftScore = scanDirection(-35, 35); // Turn Left\n    basic.pause(200);\n    let rightScore = scanDirection(35, -35); // Turn Right\n    basic.pause(200);\n\n    // Turn towards the winner\n    if (leftScore > rightScore) {\n        cuteBot.motors(-35, 35); // Turn Left\n        basic.pause(400);\n    } else {\n        cuteBot.motors(35, -35); // Turn Right\n        basic.pause(400);\n    }\n    cuteBot.stopcar();\n\n    // --- STEP 2: APPROACH (IMPROVED) ---\n    // Drive until we are VERY close (High RSSI) or it gets quiet\n    driveToTarget();\n\n    // Done\n    resetSystem();\n}\n\nfunction driveToTarget() {\n    const startTime = input.runningTime();\n    cuteBot.motors(25, 25); // Slow approach\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x0000ff); // BLUE (Driving)\n\n    while (input.runningTime() - startTime < MAX_SEARCH_TIME) {\n\n        // Safety: If I accidentally flip while driving, stop immediately!\n        if (isDistressMode) {\n            cuteBot.stopcar();\n            return;\n        }\n\n        // CHECK 1: Are we there yet? (RSSI is Strong)\n        // -55 is usually within 10-15cm of the target\n        if (currentRSSI > RSSI_ARRIVED_THRESH && currentRSSI != -100) {\n            // WE FOUND IT!\n            missionSuccess();\n            return;\n        }\n\n        // CHECK 2: Is it getting quiet? (Lost the trail)\n        // We allow a small buffer; if it's quiet for just a moment, keep going.\n        // Only stop if quiet for > 1 second.\n        if (input.soundLevel() < SOUND_THRESHOLD) {\n            // If sound is low, maybe rely purely on RSSI?\n            // For now, we pause briefly to listen better.\n            cuteBot.stopcar();\n            basic.pause(200);\n            if (input.soundLevel() < SOUND_THRESHOLD) {\n                // Still quiet? Maybe we arrived or lost it.\n                break;\n            }\n            cuteBot.motors(25, 25); // Resume\n        }\n\n        // Update RSSI for next loop check\n        // (Radio background handler updates 'currentRSSI' automatically)\n        basic.pause(50);\n    }\n    cuteBot.stopcar();\n}\n\nfunction missionSuccess() {\n    cuteBot.stopcar();\n    // Victory Dance\n    for (let i = 0; i < 3; i++) {\n        cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00); // GREEN\n        basic.showIcon(IconNames.Heart);\n        basic.pause(200);\n        cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x000000); // OFF\n        basic.pause(200);\n    }\n}\n\n// ==========================================\n// === 4. HELPERS ===========================\n// ==========================================\n\n// Turns robot, records max volume and signal, returns a Score\nfunction scanDirection(leftSpeed: number, rightSpeed: number): number {\n    cuteBot.motors(leftSpeed, rightSpeed);\n\n    let maxSound = 0;\n    let maxRssi = -128;\n\n    const t0 = input.runningTime();\n    // Scan for 600ms\n    while (input.runningTime() - t0 < 600) {\n        let s = input.soundLevel();\n        if (s > maxSound) maxSound = s;\n        if (currentRSSI > maxRssi) maxRssi = currentRSSI;\n        basic.pause(20);\n    }\n    cuteBot.stopcar();\n\n    // Normalize and Score\n    // Sound 0-255 -> 0-100\n    // RSSI -90 to -40 -> 0-100\n    let normSound = Math.map(maxSound, 0, 255, 0, 100);\n    let normRssi = Math.map(maxRssi, -95, -40, 0, 100);\n\n    return (normSound * W_SOUND) + (normRssi * W_RSSI);\n}\n\nfunction resetSystem() {\n    isRescuing = false;\n    targetId = 0;\n    calmLights();\n}\n\nfunction calmLights() {\n    cuteBot.colorLight(cuteBot.RGBLights.ALL, 0x00ff00); // Green\n    basic.showIcon(IconNames.Happy);\n}","README.md":"","main.py":"# ============== Radio setup ==============\nRADIO_GROUP = 17\n# Must be same on all bots\nradio.set_group(RADIO_GROUP)\nradio.set_transmit_power(7)\n# Max power\nmyId = control.device_serial_number()\n# ============== Message types ==============\nMSG_ALERT = \"ALERT\"\nMSG_BEACON = \"BEACON\"\nMSG_DONE = \"DONE\"\n# ============== Motion / Scan Constants ==============\nTURN_SPEED = 40\n# Speed for initial scan\nSCAN_MS = 600\n# Duration to listen per side (ms)\nSEEK_MS = 400\n# Duration to turn towards target (ms)\nSETTLE_MS = 100\n# Pause to stabilize (ms)\n# ============== Approach Constants ==============\nSLOW_FORWARD_SPEED = 25\nSOUND_APPROACH_THRESH = 60\n# Stop if quieter than this\nAPPROACH_MAX_MS = 5000\n# Give up after 5 seconds\nQUIET_STOP_MS = 500\n# Stop if quiet for 0.5s\n# ============== Re-scan Constants ==============\nRESCAN_PERIOD_MS = 800\n# Re-check heading every 0.8s\nSCAN_MS_SHORT = 300\nSEEK_MS_SHORT = 250\nAPPROACH_TURN_SPEED = 35\n# ============== Sensor Weights (0–100 scaled) ==============\nSOUND_WEIGHT = 0.7\n# Trust ears more\nRSSI_WEIGHT = 0.3\n# Trust radio less\n# ============== Global State Variables ==============\nisDistressMode = False\nscanning = False\nscanningAnimOn = False\n# Target tracking\ntargetId = 0\ncurrentRSSI = -128\nlastBeaconTime = 0\nBEACON_TIMEOUT_MS = 2000\n# =============================================\n# =========== PART 1: DISTRESS MODE ===========\n# =============================================\n# Orientation monitor – runs forever\n\ndef on_forever():\n    global isDistressMode\n    accelZ = input.acceleration(Dimension.Z)\n    # Flip down → distress\n    # Flip back up → exit distress\n    if accelZ < -600 and not isDistressMode:\n        enterDistressMode()\n    elif accelZ > 200 and isDistressMode:\n        exitDistressMode()\n    basic.pause(50)\nbasic.forever(on_forever)\n\ndef enterDistressMode():\n    global isDistressMode, scanning\n    if isDistressMode:\n        return\n    isDistressMode = True\n    scanning = False\n    # Stop rescuing others if I am hurt\n    cuteBot.stopcar()\n    sadLights()\n    radio.send_value(MSG_ALERT, myId)\n    # Continuous distress loop in background\n    \n    def on_in_background():\n        while isDistressMode:\n            # Broadcast beacon for RSSI tracking\n            radio.send_value(MSG_BEACON, myId)\n            # Play sad sound (non-blocking is nicer, but play is okay)\n            soundExpression.sad.play()\n            # Randomly re-send ALERT packet\n            if Math.random_boolean():\n                radio.send_value(MSG_ALERT, myId)\n            basic.pause(600)\n    control.in_background(on_in_background)\n    \ndef exitDistressMode():\n    global isDistressMode\n    isDistressMode = False\n    radio.send_value(MSG_DONE, myId)\n    calmLights()\n# Manual shake trigger\n\ndef on_gesture_shake():\n    global isDistressMode\n    if not isDistressMode:\n        enterDistressMode()\n        # Force sadness for at least 3 seconds on shake\n        \n        def on_in_background2():\n            basic.pause(3000)\n            if isDistressMode and input.acceleration(Dimension.Z) > -200:\n                exitDistressMode()\n        control.in_background(on_in_background2)\n        \ninput.on_gesture(Gesture.SHAKE, on_gesture_shake)\n\n# =============================================\n# =========== PART 2: RESCUER LOGIC ===========\n# =============================================\n\ndef on_received_value(name, value):\n    global isDistressMode, scanning, currentRSSI, lastBeaconTime, targetId\n    rssi = radio.received_packet(RadioPacketProperty.SIGNAL_STRENGTH)\n    if name == MSG_ALERT:\n        senderId = value\n        if senderId != myId and not isDistressMode and not scanning:\n            # Start rescue!\n            respondToAlert(senderId)\n    elif name == MSG_BEACON:\n        # Only track the robot we are looking for\n        if targetId == 0 or value == targetId:\n            currentRSSI = rssi\n            lastBeaconTime = input.running_time()\n    elif name == MSG_DONE:\n        if value == targetId:\n            # Victim is happy, stop rescue\n            scanning = False\n            targetId = 0\n            cuteBot.stopcar()\n            calmLights()\nradio.on_received_value(on_received_value)\n\ndef respondToAlert(senderId2: number):\n    global scanning, targetId, TURN_SPEED\n    scanning = True\n    targetId = senderId2\n    scanningLights()\n    basic.pause(200)\n    # 1. Scan left/right to find direction\n    leftScore = scanSide(-TURN_SPEED, TURN_SPEED, SCAN_MS)\n    basic.pause(SETTLE_MS)\n    rightScore = scanSide(TURN_SPEED, -TURN_SPEED, SCAN_MS)\n    basic.pause(SETTLE_MS)\n    # 2. Pivot towards winner\n    if leftScore > rightScore:\n        cuteBot.motors(-TURN_SPEED, TURN_SPEED)\n        basic.pause(SEEK_MS)\n    else:\n        cuteBot.motors(TURN_SPEED, -TURN_SPEED)\n        basic.pause(SEEK_MS)\n    cuteBot.stopcar()\n    # 3. Empathize and approach\n    sadLights()\n    soundExpression.sad.play()\n    approachWhileLoudWithRescan()\n    # 4. Reset\n    scanningAnimationStop()\n    scanning = False\n    targetId = 0\n    calmLights()\n# Scan one direction and return a score combining sound & RSSI\ndef scanSide(leftSpeed: number, rightSpeed: number, duration: number):\n    cuteBot.motors(leftSpeed, rightSpeed)\n    soundMax = 0\n    rssiMax = -128\n    t0 = input.running_time()\n    while input.running_time() - t0 < duration:\n        s = input.sound_level()\n        if s > soundMax:\n            soundMax = s\n        if input.running_time() - lastBeaconTime < BEACON_TIMEOUT_MS:\n            if currentRSSI > rssiMax:\n                rssiMax = currentRSSI\n        basic.pause(10)\n    cuteBot.stopcar()\n    soundScore = normSound(soundMax)\n    rssiScore = normRssi(rssiMax)\n    return SOUND_WEIGHT * soundScore + RSSI_WEIGHT * rssiScore\n# Approach loop with periodic re-scan (\"wiggle\")\ndef approachWhileLoudWithRescan():\n    tStart = input.running_time()\n    quietStart = 0\n    lastRescan = input.running_time()\n    cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED)\n    while input.running_time() - tStart < APPROACH_MAX_MS:\n        # Safety: if we get flipped during rescue, enter distress\n        if isDistressMode:\n            cuteBot.stopcar()\n            return\n        # Volume check\n        t = input.sound_level()\n        if t >= SOUND_APPROACH_THRESH:\n            quietStart = 0\n        else:\n            if quietStart == 0:\n                quietStart = input.running_time()\n            if input.running_time() - quietStart >= QUIET_STOP_MS:\n                break\n        # Periodic re-scan to adjust heading\n        if input.running_time() - lastRescan >= RESCAN_PERIOD_MS:\n            cuteBot.stopcar()\n            briefRescanAndAdjust()\n            cuteBot.motors(SLOW_FORWARD_SPEED, SLOW_FORWARD_SPEED)\n            lastRescan = input.running_time()\n        basic.pause(20)\n    cuteBot.stopcar()\ndef briefRescanAndAdjust():\n    global APPROACH_TURN_SPEED\n    scanningLights()\n    # Quick left/right check\n    left = scanSide(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED, SCAN_MS_SHORT)\n    basic.pause(50)\n    right = scanSide(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED, SCAN_MS_SHORT)\n    if left > right:\n        cuteBot.motors(-APPROACH_TURN_SPEED, APPROACH_TURN_SPEED)\n        basic.pause(SEEK_MS_SHORT)\n    else:\n        cuteBot.motors(APPROACH_TURN_SPEED, -APPROACH_TURN_SPEED)\n        basic.pause(SEEK_MS_SHORT)\n    cuteBot.stopcar()\n    sadLights()\n# ============== Normalization Helpers ==============\ndef normSound(v: number):\n    if v < 0:\n        v = 0\n    if v > 255:\n        v = 255\n    return Math.round(v * 100 / 255)\ndef normRssi(rssi2: number):\n    MIN = -95\n    MAX = -45\n    if rssi2 < MIN:\n        rssi2 = MIN\n    if rssi2 > MAX:\n        rssi2 = MAX\n    return Math.round((rssi2 - MIN) * 100 / (MAX - MIN))\n# ============== LED / Display Control ==============\ndef calmLights():\n    scanningAnimationStop()\n    cuteBot.color_light(cuteBot.RGBLights.ALL, 0x00ff00)\n    basic.show_icon(IconNames.HAPPY)\ndef sadLights():\n    scanningAnimationStop()\n    cuteBot.color_light(cuteBot.RGBLights.ALL, 0xff0000)\n    basic.show_icon(IconNames.SAD)\ndef scanningLights():\n    cuteBot.color_light(cuteBot.RGBLights.ALL, 0xffff00)\n    scanningAnimationStart()\ndef scanningAnimationStart():\n    global scanningAnimOn\n    if scanningAnimOn:\n        return\n    scanningAnimOn = True\n    \n    def on_in_background3():\n        frames = [images.create_image(\"\"\"\n                . . . . .\n                . . # . .\n                . # . # .\n                . . . . .\n                . . . . .\n                \"\"\"),\n            images.create_image(\"\"\"\n                . . . . .\n                . . . . .\n                . . # . .\n                . . . . .\n                . . . . .\n                \"\"\"),\n            images.create_image(\"\"\"\n                . . . . .\n                . . . . .\n                . # . # .\n                . . # . .\n                . . . . .\n                \"\"\")]\n        i = 0\n        while scanningAnimOn:\n            frames[i].show_image(0)\n            i = (i + 1) % len(frames)\n            basic.pause(120)\n        basic.clear_screen()\n    control.in_background(on_in_background3)\n    \ndef scanningAnimationStop():\n    global scanningAnimOn\n    scanningAnimOn = False\n# ============== Main startup ==============\ncalmLights()","pxt.json":"{\n    \"name\": \"p5_test\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\",\n        \"radio-broadcast\": \"*\",\n        \"cutebot\": \"github:elecfreaks/pxt-cutebot#v6.2.4\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"main.py\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}}],"shares":[{"id":"46415-52724-07399-63791","timestamp":1764915557957},{"id":"83209-25341-73957-07339","timestamp":1764915628770}],"lastSaveTime":1764920807220}